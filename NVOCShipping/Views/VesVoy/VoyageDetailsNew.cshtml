@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.full.min.js"></script>
<script type="text/javascript">

    LayoutApp.controller('MyController', function ($scope, $http, Upload, $timeout) {
        $scope.HDArrayIndex = "";
        $scope.HDArrayIndexv = "";

        $(document).ready(function () {
            $('.my-select').select2({
                placeholder: "--Select--",
                allowClear: true,
                width: '100%'
            });

        });

        $scope.Weekdays = [
            { ID: 1, Name: 'Sun' },
            { ID: 2, Name: 'Mon' },
            { ID: 3, Name: 'Tue' },
            { ID: 4, Name: 'Wed' },
            { ID: 5, Name: 'Thu' },
            { ID: 6, Name: 'Fri' },
            { ID: 7, Name: 'Sat' },
        ];

        $scope.WeekdaysA = [
            { ID: 1, Name: 'Sun' },
            { ID: 2, Name: 'Mon' },
            { ID: 3, Name: 'Tue' },
            { ID: 4, Name: 'Wed' },
            { ID: 5, Name: 'Thu' },
            { ID: 6, Name: 'Fri' },
            { ID: 7, Name: 'Sat' },
        ];
        //Vessel DropDown//
        $scope.Vessel = null;
        $scope.fillVessel = function () {

            $http({
                method: 'POST',
                url: '/api/Home/VesselDropDown/',
                data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.Vessel = result.data;
                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        };
        $scope.fillVessel();

        $scope.ServiceList = null;
        $scope.fillServices = function () {
            var Datavalue = {};
            Datavalue.ID = localStorage.getItem("GeoLocationID");
            $http({
                method: 'POST',
                url: '/api/Home/BindServices/',
                data: JSON.stringify(Datavalue),
            }).then(function (result) {
                $timeout(function () {
                    $scope.ServiceList = result.data;
                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        };
        $scope.fillServices();

        $scope.NoteTypesList = null;
        $scope.fillNoteTypesList = function () {
            var Datavalue = {};

            $http({
                method: 'POST',
                url: '/api/Home/BindNoteTypesList/',
                data: {},
            }).then(function (result) {
                $timeout(function () {
                    $scope.NoteTypesList = result.data;
                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        };
        $scope.fillNoteTypesList();

        //$scope.TerminalValues = null;
        //$scope.fillTerminalValues = function () {
        //    $http({
        //        method: 'POST',
        //        url: '/api/CommonAccessApi/TerminalMaster/',
        //        data: {}
        //    }).then(function (result) {
        //        $timeout(function () {
        //            $scope.TerminalValues = result.data;
        //        });
        //    }, function (result) {
        //        if (result.status == 500) {
        //            ShowPopup("Sorry no internet connectivity Application Error.");
        //        }
        //        else if (result.status == 404) {
        //            ShowPopup("Sorry no internet connectivity page not found.");
        //        }
        //        if (result.status > 0) {
        //            var errorMsg = result.status + ': ' + result.data;
        //            ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
        //        }
        //    }).catch(function (result) {
        //        ShowPopup('There has been an error: ' + result);
        //    });
        //};
        //$scope.fillTerminalValues();

        $scope.PortValues = null;
        $scope.fillPortValues = function () {
            $http({
                method: 'POST',
                url: '/api/CommonAccessApi/BindMainPorts/',
                data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.PortValues = result.data;
                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        };
        $scope.fillPortValues();

        $scope.PortChange = function (gRow, index, selectedterminal) {
            var Datavalue = {};

            if (gRow.Port && typeof gRow.Port.ID != undefined)
                Datavalue.ID = gRow.Port.ID
            else
                Datavalue.ID = gRow

            $http({
                method: 'POST',
                url: '/api/Home/BindTerminalByPort/',
                data: JSON.stringify(Datavalue),
                // data: {}
            }).then(function (result) {
                //$scope.TerminalValues = result.data;
                console.log(index);
                $("#ddlTerminal" + index).html("");
                for (var i = 0; i < result.data.length; i++) {

                    $("#ddlTerminal" + index).append($("<option>").text(result.data[i].TerminalName).val(result.data[i].ID).attr("label", result.data[i].TerminalName))

                }
                if (selectedterminal) {
                    $("#ddlTerminal" + index).val(selectedterminal);

                }

                $timeout(function () {
                    // console.log($scope);


                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });

        }

        $scope.TerminalOnload = function (gRow, index) {
            //console.log(gRow[index]);
            // gRow.Terminal[index].ID = $("#ddlTerminal" + index).val();

        }

        $scope.OperatorValue = null;
        $scope.fillSlotOperatorByServices = function (ServiceID) {


            var Datavalue = {};
            Datavalue.ServiceID = ServiceID;
            $http({
                method: 'POST',
                url: '/api/Home/SlotOperatorByServices/',
                data: JSON.stringify(Datavalue)
            }).then(function (result) {

                $timeout(function () {

                    $scope.OperatorValue = result.data;

                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        };


        $scope.LoginRoutePortValues = null;
        $scope.fillLoginRoutePort = function (VoyID) {
            var Datavalue = {};
            Datavalue.ID = VoyID;
            //Datavalue.AgencyID = localStorage.getItem("AgencyID");
            $http({
                method: 'POST',
                url: '/api/Home/BerthingPortDropdown/',
                data: JSON.stringify(Datavalue)
            }).then(function (result) {

                $timeout(function () {

                    $scope.LoginRoutePortValues = result.data;

                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        };

        // operator grid dropdown change
        $("#ddlOperator").change(function () {
            $scope.SlotRefValues = null;
            var Datavalue = {};

            Datavalue.ID = $("#ddlOperator").val();

            $http({
                method: 'POST',
                url: '/api/Home/BindSlotRefByOperator/',
                data: JSON.stringify(Datavalue),
                //  data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.SlotRefValues = result.data;
                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        });


        $(document).ready(function () {

            var queryString = new Array();
            if (window.location.search.split('?').length > 1) {
                var secret_key = CryptoJS.enc.Utf8.parse(localStorage.getItem("SessionKey"));
                var iv = CryptoJS.enc.Utf8.parse(localStorage.getItem("Sessioniv"));
                var bytes = CryptoJS.AES.decrypt(window.location.search.split('?')[1].toString(), secret_key, {
                    iv: iv,
                    mode: CryptoJS.mode.CBC,
                    padding: CryptoJS.pad.Pkcs7
                });

                var params = bytes.toString(CryptoJS.enc.Utf8).split('&');
                //alert(params);
                for (var i = 0; i < params.length; i++) {
                    var key = params[i].split('=')[0];
                    var value = decodeURIComponent(params[i].split('=')[1]);
                    queryString[key] = value;

                }
            }
            if (queryString["VoyID"] != null) {
                $scope.HdRegId = queryString["VoyID"].toString();
                $scope.BindVoyage(queryString["VoyID"].toString());
                $scope.BindVoyageSailingDtls(queryString["VoyID"].toString());
                $scope.BindManifestDtls(queryString["VoyID"].toString());
                $scope.fillLoginRoutePort(queryString["VoyID"].toString());
                $scope.BindBerthingDtls(queryString["VoyID"].toString());
                $scope.BindSendEmailPopUpVoyDtls(queryString["VoyID"].toString());
                $scope.BindBkgPartyDtls(queryString["VoyID"].toString());
                $scope.BindNotesDtls(queryString["VoyID"].toString());

                document.getElementById('btngetschedule').style.visibility = 'hidden';
                // $scope.BkgVoyageOperatorButtonHide(queryString["VoyID"].toString());
                // $scope.BindServiceOperators($scope.ddlService);
            }
        });


        //---------1ST TAB SAILING SCHEDULE------------///

        $scope.GetSchedule = function () {
            var validation = "";

            var ddlService = $('#ddlService').val();
            if (ddlService == "?") {

                validation += "<span style='color:red;'>*</span> <span>Please Select Service </span></br>"
            }
            var ddlVessel = $('#ddlVessel').val();
            if (ddlVessel == "?") {

                validation += "<span style='color:red;'>*</span> <span>Please Select Vessel </span></br>"
            }
            var txtETA = $('#txtETA').val();
            if (txtETA.length == 0) {

                validation += "<span style='color:red;'>*</span> <span>Please Enter ETA </span></br>"

            }
            if (validation != "") {

                ShowPopup(validation);
                return false;
            }

            var Datavalue = {};
            Datavalue.ID = $("#ddlService").val();
            Datavalue.ETA = $("#txtETA").val();
            $http({
                method: 'POST',
                url: "/api/Home/BindServiceSchedule",
                data: JSON.stringify(Datavalue),
            }).then(function (result) {
                $timeout(function () {
                    if (result.data.length > 0) {
                        if (result.data[0].PortID != "") {
                            $scope.DynamicGridSchedule.splice(0, 1);
                        }

                        angular.forEach(result.data, function (value, key) {

                            // console.log(result.data[key]);
                            $scope.DynamicGridSchedule.push({

                                'Port': { ID: result.data[key].PortID },
                                'ArrivalETA': $('#txtETA').val(),
                                'DepETD': $('#txtETA').val(),
                                'ArrivalHH': "00",
                                'ArrivalMM': "00",
                                'DepHH': "00",
                                'DepMM': "00",
                            });
                            $scope.PortChange(result.data[key].PortID, key);
                        });
                        //$scope.BindServiceOperators($("#ddlService").val());
                        document.getElementById("btngetschedule").style.display = "none";
                    }

                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            });
        }

        $scope.DynamicGridSchedule = [{ RID: "", InBoundVoy: "", OutBoundVoy: "", OutBoundVoy: "", Port: "", Terminal: "", ArrivalETA: "", ArrivalDay: "", ArrivalHH: "", ArrivalMM: "", DepETD: "", DepDay: "", DepHH: "", DepMM: "" }];


        $scope.AddSchedule = function (DynamicGridSchedule) {


            $scope.DynamicGridSchedule.push({
                'RID': "",
                'InBoundVoy': "",
                'OutBoundVoy': "",
                'Port': "",
                'Terminal': "",
                'ArrivalETA': "",
                'ArrivalDay': "",
                'ArrivalHH': "",
                'ArrivalMM': "",
                'DepETD': "",
                'DepDay': "",
                'DepHH': "",
                'DepMM': "",

            });

        }


        $scope.RemoveSchedule = function (DynamicGridSchedule, index) {
            $scope.DynamicGridSchedule.splice(index, 1);
        }

        $scope.BindVoyage = function (VoyID) {


            var Datavalue = {}
            var id = VoyID;

            if (id == "" || id == null)
                Datavalue.ID = 0;
            else
                Datavalue.ID = VoyID;

            $http({
                method: 'POST',
                url: '/api/Home/VoyageDetailsEdit/',
                data: JSON.stringify(Datavalue),
            }).then(function (result) {
                $timeout(function () {


                    if (result.data.length > 0) {
                        $scope.ddlVessel = { ID: result.data[0].VesselID };
                        $scope.ddlService = { ID: result.data[0].ServiceID };
                        $scope.txtRotNo = result.data[0].RotationNo
                        document.getElementById('txtETA').value = result.data[0].ETA;
                        $scope.BindServiceOperators(VoyID);
                        $scope.fillSlotOperatorByServices(result.data[0].ServiceID);
                        $scope.HdIsExpImp = result.data[0].IsExpImp;

                    }
                    else {
                        $('#ddlVessel').val('');
                        $('#ddlService').val('');
                        $('#txtRotNo').val('');
                        $('#txtETA').val('');

                    }


                });
            });
            //$scope.back = function () {
            //    window.location = "/Party/CustomerView";
            //}
        }

        $scope.BindVoyageSailingDtls = function (VoyID) {
            var Datavalue = {};
            Datavalue.ID = VoyID;
            $http({
                method: 'POST',
                url: "/api/Home/VoyageSailingDetailsEdit",
                data: JSON.stringify(Datavalue),
            }).then(function (result) {
                $timeout(function () {
                    if (result.data.length > 0) {

                        if (result.data[0].PortID != "") {
                            $scope.DynamicGridSchedule.splice(0, 1);
                        }

                        angular.forEach(result.data, function (value, key) {

                            $scope.DynamicGridSchedule.push({

                                'RID': result.data[key].RID,
                                'InBoundVoy': result.data[key].ImportVoyageCd,
                                'OutBoundVoy': result.data[key].ExportVoyageCd,
                                'Port': { ID: result.data[key].PortID },
                                'Terminal': { ID: result.data[key].TerminalID },
                                'ArrivalETA': result.data[key].ArrivalETA,
                                'ArrivalDay': { ID: result.data[key].DayETA },
                                'ArrivalHH': result.data[key].TmETA,
                                'ArrivalMM': "00",
                                'DepETD': result.data[key].DepETD,
                                'DepDay': { ID: result.data[key].DayETD },
                                'DepHH': result.data[key].TmETD,
                                'DepMM': "00",

                            });
                            $scope.PortChange(result.data[key].PortID, key, result.data[key].TerminalID);

                        });
                    }

                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            });
        }

        $scope.RecordSave = function (data) {
            var validation = "";
            if ($scope.HdIsExpImp != 1) {
                var ddlService = $('#ddlService').val();
                if (ddlService == "?") {

                    validation += "<span style='color:red;'>*</span> <span>Please Select Service </span></br>"
                }
            }

            var ddlVessel = $('#ddlVessel').val();
            if (ddlVessel == "?") {

                validation += "<span style='color:red;'>*</span> <span>Please Select Vessel </span></br>"
            }
            var txtETA = $('#txtETA').val();
            if (txtETA.length == 0) {

                validation += "<span style='color:red;'>*</span> <span>Please Enter ETA </span></br>"

            }
            var OutBoundVoyV = "";
            var InBoundVoyV = "";
            var ETAdate1;
            var ETDdate1;
            var ETAdate2;
            var ETDdate2;
            //var PortV1;
            //var PortV2;
            angular.forEach(data, function (value, key) {

                OutBoundVoyV = data[key].OutBoundVoy;
                InBoundVoyV = data[key].InBoundVoy;
                ETAdate1 = $("#txtArrivalETA" + 0).val();
                ETDdate1 = $("#txtDepETD" + 0).val();
                ETAdate2 = $("#txtArrivalETA" + 1).val();

                //PortV1 = $("#ddlPort option:selected" + key).text();
                //PortV2 = $("#ddlPort option:selected" + key).text();
            });

            if (typeof OutBoundVoyV == "undefined") {
                validation += "<span style='color:red;'>*</span> <span>Please Enter OutBound Voyage  </span></br> "
            }
            if (typeof InBoundVoyV == "undefined") {
                validation += "<span style='color:red;'>*</span> <span>Please Enter InBound Voyage</span ></br > "
            }
            var ETA1 = moment.utc(ETAdate1).local().format('MMM DD YYYY h:mm A');
            var ETD1 = moment.utc(ETDdate1).local().format('MMM DD YYYY h:mm A');
            var ETA2 = moment.utc(ETAdate2).local().format('MMM DD YYYY h:mm A');
            if (Date.parse(ETA1) == Date.parse(ETD1)) {

                validation += "<span style='color:red;'>*</span> <span> ETD Date should be greater than ETA Date  </span></br>"
            }

            if ($scope.HdIsExpImp != 1 && $("#ddlService option:selected").text() != "IMPORT VOYAGE") {
                if (Date.parse(ETA2) <= Date.parse(ETD1)) {

                    validation += "<span style='color:red;'>*</span> <span>Next ETA Date should be greater than Previous ETD Date</span></br>"
                }
                if (Date.parse(ETD1) <= Date.parse(ETA1)) {

                    validation += "<span style='color:red;'>*</span> <span>Starting ETD Date should be greater than Starting ETA Date</span></br>"
                }
            }
            if (validation != "") {

                ShowPopup(validation);
                return false;
            }


            $('#overlay').fadeIn().delay(100).fadeOut();
            var BussData = {}
            var id = $scope.HdRegId;

            if (id == "" || id == null)
                BussData.ID = 0;
            else
                BussData.ID = $scope.HdRegId;

            BussData.ServiceID = $('#ddlService').val();
            BussData.VesselID = $('#ddlVessel').val();
            BussData.RotationNo = $scope.txtRotNo;
            BussData.ETA = $('#txtETA').val();
            BussData.UserID = localStorage.getItem("UserID");
            BussData.GeoLocID = localStorage.getItem("GeoLocationID");
            BussData.AgencyID = localStorage.getItem("AgencyID");
            var ItemsSchedule = []
            console.log(data);

            angular.forEach(data, function (value, key) {

                var intRID = data[key].RID;

                var intArrivalDay = data[key].ArrivalDay;
                var intDepDay = data[key].DepDay;

                if (typeof data[key].RID == "undefined") {
                    intRID = 0;
                }
                if (typeof data[key].ArrivalDay == "undefined" || data[key].ArrivalDay == "" || data[key].ArrivalDay == null ||
                    data[key].ArrivalDay == "?" || data[key].ArrivalDay == "[object Object]") {
                    intArrivalDay = 0;
                }
                if (typeof data[key].DepDay == "undefined" || data[key].DepDay == "" || data[key].DepDay == null ||
                    data[key].DepDay == "?" || data[key].DepDay == "[object Object]") {
                    intDepDay = 0;
                }

                var intTerminalID = $("#ddlTerminal" + key).val();
                var DtArrivalETA = $("#txtArrivalETA" + key).val();
                var DtDepETD = $("#txtDepETD" + key).val();

                ItemsSchedule.push('Insert:' + intRID, data[key].InBoundVoy, data[key].OutBoundVoy, data[key].Port.ID, intTerminalID, DtArrivalETA, intArrivalDay, data[key].ArrivalHH, data[key].ArrivalMM, DtDepETD, intDepDay, data[key].DepHH, data[key].DepMM,
                );
            });
            console.log(ItemsSchedule.toString());
            BussData.ItemsSchedule = ItemsSchedule.toString();

            $http({
                method: 'POST',
                url: "/api/Home/InsertVoyageFirstTab",
                data: JSON.stringify(BussData),
            }).then(function (result) {
                $timeout(function () {
                    if (result.data.length > 0) {

                        ShowPopup(result.data[0].AlertMessage);
                    }

                    setTimeout(function () { location.href = "/VesVoy/VoyageDetailsNewView" }, 2000);

                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }


                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    // $(".modal").hide();
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                // This is set in the event of an error.
                console.log(result);
                ShowPopup('There has been an error: ' + result);
            });

        }

        //---------1ST TAB END ------------///


        //---------2nd TAB Operators ------------///
        $scope.BindServiceOperators = function (VoyageID) {

            var Datavalue = {};

            Datavalue.ID = VoyageID;

            $http({
                method: 'POST',
                url: '/api/Home/VoyageOperatorsEdit/',
                data: JSON.stringify(Datavalue),
            }).then(function (result) {

                $timeout(function () {
                    if (result.data.length > 0) {
                        if (result.data[0].OperatorID != "") {
                            $scope.DynamicGridOperator.splice(0, 1);
                        }

                        angular.forEach(result.data, function (value, key) {

                            $scope.DynamicGridOperator.push({
                                'OID': result.data[key].OID,
                                'OperatorID': result.data[key].OperatorID,
                                'Operator': result.data[key].Operator,
                                'SlotRefID': result.data[key].SlotRefID,
                                'SlotRef': result.data[key].SlotRef,

                            });

                        });
                    }
                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            });
        }


        $scope.BindExistSlotByOperator = function (OprID) {
            $scope.SlotRefValues = null;
            var Datavalue = {};

            Datavalue.ID = OprID;

            $http({
                method: 'POST',
                url: '/api/Home/BindSlotRefByOperator/',
                data: JSON.stringify(Datavalue),
                //  data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.SlotRefValues = result.data;
                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });

        }

        $scope.DynamicGridOperator = [{ OID: "", OperatorID: "", Operator: "", SlotRefID: "", SlotRef: "" }];

        $scope.DynamicGridOperator.splice(0, 1);

        $scope.Selectvalues = function (DynamicGridOperator, index) {
            $scope.HDArrayIndex = index;
            $scope.OID = $scope.DynamicGridOperator[index].OID;
            $scope.Operator = { ID: $scope.DynamicGridOperator[index].OperatorID };
            $scope.BindExistSlotByOperator($scope.DynamicGridOperator[index].OperatorID);
            $scope.SlotRef = { ID: $scope.DynamicGridOperator[index].SlotRefID };

        }
        $scope.AddOperator = function (DynamicGridOperator) {

            var validation = "";

            var ddlOperator = $('#ddlOperator').val();
            if (ddlOperator == "?") {
                validation += "<span style='color:red;'>*</span> <span>Please Select  Operator</span></br>"
            }

            var ddlSlotRef = $('#ddlSlotRef').val();
            if (ddlSlotRef == "?") {
                validation += "<span style='color:red;'>*</span> <span>Please Select  Slot Reference </span></br>"
            }

            for (var i = 0; i < $scope.DynamicGridOperator.length; i++) {

                if ($scope.DynamicGridOperator[i].OperatorID == $('#ddlOperator').val() && $scope.DynamicGridOperator[i].SlotRefID == $('#ddlSlotRef').val()) {

                    validation += "<span style='color:red;'>*</span> <span>Operator/Slot Ref Already Exists </span></br>"
                }

            }

            if (validation != "") {
                ShowPopup(validation);
                return false;
            }

            var OIDValue;

            OIDValue = ($scope.OID == "") ? 0 : $scope.OID;

            var val = {
                'OID': OIDValue,
                'OperatorID': $("#ddlOperator").val(),
                'Operator': $("#ddlOperator option:selected").text(),
                'SlotRefID': $("#ddlSlotRef").val(),
                'SlotRef': $("#ddlSlotRef option:selected").text(),

            };
            if ($scope.HDArrayIndex != null && $scope.HDArrayIndex.length != 0) {

                $scope.DynamicGridOperator[$scope.HDArrayIndex] = val;
            } else {

                $scope.DynamicGridOperator.push(val);
            }

            $("#ddlOperator").val("");
            $("#ddlSlotRef").val("");

            $scope.OID = 0;

        }
        $scope.RemoveOperator = function (DynamicGridOperator, index, OID) {

            var Datavalue = {}
            Datavalue.OID = OID;
            $http({
                method: 'POST',
                url: '/api/Home/VoyageOperatorsDelete/',
                data: JSON.stringify(Datavalue),
            }).then(function (result) {
                $timeout(function () {
                    $scope.DynamicGridOperator.splice(index, OID);
                    //$scope.BindServiceOperators($scope.HdRegId);
                });
            });



        }
        //$scope.RemoveOperator = function (DynamicGridOperator, index) {
        //    $scope.DynamicGridOperator.splice(index, 1);
        //}

        $scope.SaveOperators = function (dataOpr) {
            var validation = "";

            var Datav = "undefined";

            angular.forEach(dataOpr, function (value, key) {
                Datav += dataOpr[key].Operator.ID;

            });
            if (Datav.toString() == "undefined") {
                validation += "<span style='color:red;'>*</span> <span>Please Enter Operator Details</span></br>"
            }
            if (validation != "") {

                ShowPopup(validation);
                return false;
            }


            $('#overlay').fadeIn().delay(100).fadeOut();
            var BussData = {}

            var id = $scope.HdRegId;

            if (id == "" || id == null)
                BussData.ID = 0;
            else
                BussData.ID = $scope.HdRegId;
            BussData.ServiceID = $("#ddlService").val();

            var ItemsO = []
            angular.forEach(dataOpr, function (value, key) {

                var intOID = dataOpr[key].OID;
                if (typeof dataOpr[key].OID == "undefined") {
                    intOID = 0;
                }

                ItemsO.push('Insert:' + intOID, dataOpr[key].OperatorID, dataOpr[key].Operator, dataOpr[key].SlotRefID, dataOpr[key].SlotRef
                );
            });
            BussData.ItemsOpr = ItemsO.toString();
            $http({
                method: 'POST',
                url: "/api/Home/InsertOperatorServices",
                data: JSON.stringify(BussData),
            }).then(function (result) {
                $timeout(function () {
                    // BussData.ID = result.data[0].ID;
                    //alert(result.data[0].ID);
                    if (BussData.ID != "") {
                        ShowPopup("Operator Updated");
                    }
                    else {

                        ShowPopup("Operator Saved Successfully");
                    }
                    //var url = "/VslVoy/ServiceSetupView";
                    //window.location.href = url;

                    setTimeOut(function () {
                        window.location = "/";
                    }, 3000);
                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }


                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    // $(".modal").hide();
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                // This is set in the event of an error.
                console.log(result);
                ShowPopup('There has been an error: ' + result);
            });

        }


        $scope.BkgVoyageOperatorButtonHide = function (VoyageID) {

            var Datavalue = {};

            Datavalue.ID = VoyageID;

            $http({
                method: 'POST',
                url: '/api/Home/BkgVoyageOperatorValidation/',
                data: JSON.stringify(Datavalue),
            }).then(function (result) {

                $timeout(function () {

                    if (result.data.length > 0) {

                        for (var i = 0; i < $scope.DynamicGridOperator.length; i++) {


                            if ($scope.DynamicGridOperator[i].OperatorID == result.data[0].VesOperator) {
                                // alert('test');
                                //$scope.DynamicGridOperator[i].RemoveOpr = true;
                            }
                            else {
                                //$scope.DynamicGridOperator[i].RemoveOpr = false;
                            }
                        }



                        //document.getElementById('BtnActionopr').style.display = "none";

                    }
                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            });
        }

        //---------2ND TAB END ------------///

        //---------3RD TAB Berthing Details ------------///
        $scope.SaveBerthingDtls = function () {
            var validation = "";

            var ddlBerthPort = $('#ddlBerthPort').val();
            if (ddlBerthPort == "?") {

                validation += "<span style='color:red;'>*</span> <span>Please Select Berthing Port </span></br>"
            }

            var txtCutOff = $('#txtCutOff').val();
            if (txtCutOff.length == 0) {

                validation += "<span style='color:red;'>*</span> <span>Please Enter General CutOff </span></br>"

            }
            if (validation != "") {

                ShowPopup(validation);
                return false;
            }


            $('#overlay').fadeIn().delay(100).fadeOut();
            var BussData = {}
            var id = $scope.HdRegId;

            if (id == "" || id == null)
                BussData.ID = 0;
            else
                BussData.ID = $scope.HdRegId;

            BussData.VoyageRouteID = $('#ddlBerthPort').val();

            BussData.DtArrival = $('#txtActDtArrival').val();
            BussData.DtDeparture = $('#txtDateDep').val();
            BussData.DtPilotOnBoard1 = $('#txtPilotOB').val();
            BussData.DtVesselBerth = $('#txtVslBrth').val();
            BussData.DtDischargedCommenced = $('#txtDisCom').val();
            BussData.DtDischargedCompleted = $('#txtDisComplete').val();
            BussData.DtLoadingCommenced = $('#txtLoadCom').val();
            BussData.DtLoadingCompleted = $('#txtLoadComplete').val();
            BussData.DtPilotOnBoard2 = $('#txtPilotOBSail').val();
            BussData.DtGeneralCutOff = $('#txtCutOff').val();
            BussData.VCNNumber = $('#txtVCNNo').val();
            BussData.PortClearance = $('#txtPortClr').val();

            $http({
                method: 'POST',
                url: "/api/Home/InsertBerthingDtls",
                data: JSON.stringify(BussData),
            }).then(function (result) {
                $timeout(function () {
                    //$scope.HDRegId = result.data[0].ID;
                    // BussData.ID = result.data[0].ID;
                    //alert(result.data[0].ID);
                    if (BussData.VoyageRouteID != "") {
                        ShowPopup("Voyage Berthing Details Updated");
                    }
                    else {

                        ShowPopup("Voyage Berthing Details Saved Successfully");
                    }
                    //var url = "/VslVoy/ServiceSetupView";
                    //window.location.href = url;

                    setTimeOut(function () {
                        window.location = "/";
                    }, 3000);
                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }


                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    // $(".modal").hide();
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                // This is set in the event of an error.
                console.log(result);
                ShowPopup('There has been an error: ' + result);
            });

        }
        $scope.BindBerthingDtls = function (VoyageID) {

            var Datavalue = {};

            Datavalue.ID = VoyageID;

            $http({
                method: 'POST',
                url: '/api/Home/BindBerthingDetails/',
                data: JSON.stringify(Datavalue),
                //  data: {}
            }).then(function (result) {
                $timeout(function () {
                    if (result.data.length > 0) {

                        $scope.ddlBerthPort = { ID: result.data[0].VoyageRouteID };
                        $('#txtActDtArrival').val(result.data[0].DtArrival);
                        $('#txtDateDep').val(result.data[0].DtDeparture);
                        $('#txtPilotOB').val(result.data[0].DtPilotOnBoard1);
                        $('#txtVslBrth').val(result.data[0].DtVesselBerth);
                        $('#txtDisCom').val(result.data[0].DtDischargedCommenced);
                        $('#txtDisComplete').val(result.data[0].DtDischargedCompleted);
                        $('#txtLoadCom').val(result.data[0].DtLoadingCommenced);
                        $('#txtLoadComplete').val(result.data[0].DtLoadingCompleted);
                        $('#txtPilotOBSail').val(result.data[0].DtPilotOnBoard2);
                        $('#txtCutOff').val(result.data[0].DtGeneralCutOff);
                        $scope.txtVCNNo = result.data[0].VCNNumber;
                        $scope.txtPortClr = result.data[0].PortClearance;



                    }
                    else {
                        $('#txtActDtArrival').val('');
                        $('#txtDateDep').val('');
                        $('#txtPilotOB').val('');
                        $('#txtVslBrth').val('');
                        $('#txtDisCom').val('');
                        $('#txtLoadCom').val('');
                        $('#txtDisComplete').val('');
                        $('#txtPilotOBSail').val('');
                        $('#txtLoadComplete').val('');
                        $('#txtCutOff').val('');
                        $('#txtVCNNo').val('');
                        $('#txtPortClr').val('');
                    }

                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        }


        $scope.btnModelSendMail = function () {

            $('#SendMail').modal('show');

        }
        $scope.BindSendEmailPopUpVoyDtls = function (VoyageID) {

            var Datavalue = {};

            Datavalue.ID = VoyageID;

            $http({
                method: 'POST',
                url: '/api/Home/SendEmailPopUpVoyDtls/',
                data: JSON.stringify(Datavalue),
                //  data: {}
            }).then(function (result) {
                $timeout(function () {
                    if (result.data.length > 0) {
                        $scope.VslName = result.data[0].VesselName;
                        $scope.VoyageNo = result.data[0].VoyageNo;

                    }



                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        }
        $scope.BindBkgPartyDtls = function (VoyageID) {

            var Datavalue = {};

            Datavalue.ID = VoyageID;

            $http({
                method: 'POST',
                url: '/api/Home/VoyBookingPartyEmailDtls/',
                data: JSON.stringify(Datavalue),
                //  data: {}
            }).then(function (result) {
                $timeout(function () {
                    if (result.data.length > 0) {
                        $scope.GridBkgPartyDtls = result.data;

                    }



                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        }


        $scope.SendMail = function (EmailID) {

            var Email = "";
            Email = EmailID;
            if (Email == "") {
                ShowPopup("Email Not Updated,Please Contact Administration");
            }
        }
        //---------3RD TAB END ------------///

        //---------4th TAB Manifest Details ------------///
        $scope.DynamicManifestDtls = [{ MID: "", EGMNo: "", EGMDate: "", IGMNo: "", IGMDate: "" }];



        $scope.AddManifestDtls = function (DynamicManifestDtls) {


            $scope.DynamicManifestDtls.push({
                'MID': "",
                'EGMNo': "",
                'EGMDate': "",
                'IGMNo': "",
                'IGMDate': "",

            });

        }

        $scope.RemoveManifestDtls = function (DynamicManifestDtls, index) {
            $scope.DynamicManifestDtls.splice(index, 1);
        }


        //$scope.SelectvaluesMd = function (DynamicManifestDtls, index) {
        //    $scope.HDArrayIndex = index;
        //    $scope.MID = $scope.DynamicManifestDtls[index].MID;
        //    $scope.EGMNo = $scope.DynamicManifestDtls[index].EGMNo;
        //    $scope.EGMDate = $scope.DynamicManifestDtls[index].EGMDate;
        //    $scope.IGMNo = $scope.DynamicManifestDtls[index].IGMNo;
        //    $scope.IGMDate = $scope.DynamicManifestDtls[index].IGMDate;
        //}
        // $scope.AddManifestDtls = function (DynamicManifestDtls) {

        //var validation = "";

        //var txtNextPortETA = $('#txtNextPortETA').val();
        //if (txtNextPortETA.length == 0) {

        //    validation += "<span style='color:red;'>*</span> <span>Please Enter NextPortETA</span></br>"
        //}

        //if (validation != "") {
        //    ShowPopup(validation);
        //    return false;
        //}


        //    var MIDValue;

        //    MIDValue = ($scope.MID == "") ? 0 : $scope.MID;

        //    var val = {
        //        'MID': MIDValue,
        //        'EGMNo': $scope.EGMNo,
        //        'EGMDate': $scope.EGMDate,
        //        'IGMNo': $scope.IGMNo,
        //        'IGMDate': $scope.IGMDate

        //    };
        //    if ($scope.HDArrayIndex != null && $scope.HDArrayIndex.length != 0) {

        //        $scope.DynamicManifestDtls[$scope.HDArrayIndex] = val;
        //    } else {

        //        $scope.DynamicManifestDtls.push(val);
        //    }

        //    $scope.EGMNo = "";
        //    $scope.EGMDate = "";
        //    $scope.IGMNo = "";
        //    $scope.IGMDate = "";

        //    $scope.MID = 0;

        //}
        //$scope.RemoveManifestDtls = function (DynamicManifestDtls, index) {
        //    $scope.DynamicManifestDtls.splice(index, 1);
        //}

        $scope.BindManifestDtls = function (VoyageID) {

            var Datavalue = {};

            Datavalue.ID = VoyageID;

            $http({
                method: 'POST',
                url: '/api/Home/ViewManifestDtls/',
                data: JSON.stringify(Datavalue),
            }).then(function (result) {

                $timeout(function () {
                    if (result.data.length > 0) {
                        if (result.data[0].MID != "") {
                            $scope.DynamicManifestDtls.splice(0, 1);
                        }

                        angular.forEach(result.data, function (value, key) {

                            $scope.DynamicManifestDtls.push({
                                'MID': result.data[key].MID,
                                'EGMNo': result.data[key].EGMNo,
                                'EGMDate': result.data[key].EGMDate,
                                'IGMNo': result.data[key].IGMNo,
                                'IGMDate': result.data[key].IGMDate,

                            });

                        });
                    }
                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            });
        }


        $scope.SaveManifestDtls = function (data) {
            var validation = "";

            var IGMNoV = "";
            var IGMDateV = "";
            angular.forEach(data, function (value, key) {

                IGMNoV = data[key].IGMNo;
                IGMDateV = data[key].IGMDate;

            });

            if (IGMNoV == "") {
                validation += "<span style='color:red;'>*</span> <span>Please Enter IGMNo  </span></br> "
            }
            if (IGMDateV == "") {
                validation += "<span style='color:red;'>*</span> <span>Please Enter IGMDate</span ></br > "
            }
            if (validation != "") {

                ShowPopup(validation);
                return false;
                //break;
            }

            $('#overlay').fadeIn().delay(100).fadeOut();
            var BussData = {}

            var id = $scope.HdRegId;

            if (id == "" || id == null)
                BussData.ID = 0;
            else
                BussData.ID = $scope.HdRegId;

            var ItemsM = []
            angular.forEach(data, function (value, key) {

                var intMID = data[key].MID;
                if (typeof data[key].MID == "undefined") {
                    intMID = 0;
                }
                var DtEGMDate = $("#txtEGMDate" + key).val();
                var DtIGMDate = $("#txtIGMDate" + key).val();

                var EGMNoVal = data[key].EGMNo;

                if ($("#txtEGMDate" + key).val() == "") {
                    DtEGMDate = "";
                }
                if ($("#txtIGMDate" + key).val() == "") {
                    DtIGMDate = "";
                }
                if (data[key].EGMNo == "") {
                    EGMNoVal = "";
                }

                ItemsM.push('Insert:' + intMID, EGMNoVal, DtEGMDate, data[key].IGMNo, DtIGMDate
                );
            });
            BussData.Itemsv = ItemsM.toString();
            $http({
                method: 'POST',
                url: "/api/Home/InsertManifestDtls",
                data: JSON.stringify(BussData),
            }).then(function (result) {
                $timeout(function () {


                    if (result.data.length > 0) {
                        $("#overlay").hide();
                        // ShowPopup("Manifest Details Saved Successfully");
                    }
                    else {

                        $("#overlay").hide();
                        ShowPopup("Manifest Details Saved Successfully");
                    }

                    setTimeOut(function () {
                        window.location = "/";
                    }, 3000);
                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }


                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    // $(".modal").hide();
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                // This is set in the event of an error.
                console.log(result);
                ShowPopup('There has been an error: ' + result);
            });

        }

        //---------4th TAB END ------------///

        //---------5th TAB  ------------///

        $scope.DynamicNotesDtls = [{ NID: "", NotesTypeID: "", NotesType: "", Notes: "" }];


        $scope.DynamicNotesDtls.splice(0, 1);

        $scope.SelectNotes = function (DynamicNotesDtls, index) {

            $scope.HDArrayIndexv = index;
            $scope.NID = $scope.DynamicNotesDtls[index].NID;
            //$scope.NotesTypeID = $scope.DynamicNotesDtls[index].NotesTypeID;
            // $scope.NotesType = $scope.DynamicNotesDtls[index].NotesType;
            //$scope.Notes = $scope.DynamicNotesDtls[index].Notes;
            /* $("#ddlNoteTypes").val($scope.DynamicNotesDtls[index].NotesTypeID);*/
            $("#ddlNoteTypes").select2().val($scope.DynamicNotesDtls[index].NotesTypeID).trigger("change");
            $("#txtNotes").val($scope.DynamicNotesDtls[index].Notes);
        }
        $scope.AddNotes = function (DynamicNotesDtls) {

            var validation = "";


            var ddlNoteTypes = $('#ddlNoteTypes').val();
            if (ddlNoteTypes == "?") {

                validation += "<span style='color:red;'>*</span> <span>Please Select Voyage Notes </span></br>"
            }
            var txtNotes = $('#txtNotes').val();
            if (txtNotes.length == 0) {

                validation += "<span style='color:red;'>*</span> <span>Please Enter Notes</span></br>"
            }
            if (validation != "") {
                ShowPopup(validation);
                return false;
            }


            var NIDValue;

            NIDValue = ($scope.NID == "") ? 0 : $scope.NID;

            var val = {
                'NID': NIDValue,
                'NotesTypeID': $("#ddlNoteTypes").val(),
                'NotesType': $("#ddlNoteTypes option:selected").text(),
                'Notes': $("#txtNotes").val(),


            };
            if ($scope.HDArrayIndexv != null && $scope.HDArrayIndexv.length != 0) {

                $scope.DynamicNotesDtls[$scope.HDArrayIndexv] = val;
            } else {

                $scope.DynamicNotesDtls.push(val);
            }

            //$("#ddlNoteTypes").val("");
            $("#ddlNoteTypes").select2().val(0, "").trigger("change");
            $scope.NotesTypeID = "";
            $scope.Notes = "";
            $scope.NID = 0;

        }

        $scope.RemoveNotes = function (DynamicNotesDtls, index, NID) {

            if (NID == "undefined") {
                $scope.DynamicNotesDtls.splice(index, 1);

            }
            else {
                var Datavalue = {}
                Datavalue.NID = NID;
                $http({
                    method: 'POST',
                    url: '/api/Home/VoyageNotesDelete/',
                    data: JSON.stringify(Datavalue),
                }).then(function (result) {
                    $timeout(function () {
                        $scope.DynamicNotesDtls.splice(index, NID);
                        //$scope.BindServiceOperators($scope.HdRegId);
                    });
                });

            }

        }

        $scope.BindNotesDtls = function (VoyageID) {

            var Datavalue = {};

            Datavalue.ID = VoyageID;

            $http({
                method: 'POST',
                url: '/api/Home/ViewNotesDtls/',
                data: JSON.stringify(Datavalue),
            }).then(function (result) {

                $timeout(function () {
                    if (result.data.length > 0) {
                        if (result.data[0].NID != "") {
                            $scope.DynamicNotesDtls.splice(0, 1);
                        }
                        angular.forEach(result.data, function (value, key) {

                            $scope.DynamicNotesDtls.push({
                                'NID': result.data[key].NID,
                                'NotesType': result.data[key].NotesType,
                                'NotesTypeID': result.data[key].NotesTypeID,
                                'Notes': result.data[key].Notes,


                            });

                        });
                    }
                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            });
        }


        $scope.SaveNotesDtls = function (dataNotes) {
            var validation = "";

            var Datav = "undefined";

            angular.forEach(dataNotes, function (value, key) {
                Datav += dataNotes[key].NotesTypeID.ID;

            });
            if (Datav.toString() == "undefined") {
                validation += "<span style='color:red;'>*</span> <span>Please Enter Voyage Notes</span></br>"
            }
            if (validation != "") {

                ShowPopup(validation);
                return false;
            }


            $('#overlay').fadeIn().delay(100).fadeOut();
            var BussData = {}

            var id = $scope.HdRegId;

            if (id == "" || id == null)
                BussData.ID = 0;
            else
                BussData.ID = $scope.HdRegId;
            BussData.UserID = localStorage.getItem("UserID");
            var ItemsN = []
            angular.forEach(dataNotes, function (value, key) {

                var intNID = dataNotes[key].NID;
                if (typeof dataNotes[key].NID == "undefined") {
                    intNID = 0;
                }

                ItemsN.push('Insert:' + intNID, dataNotes[key].NotesTypeID, dataNotes[key].NotesType, 'Notes:' + dataNotes[key].Notes
                );
            });
            BussData.ItemsNotes = ItemsN.toString();
            $http({
                method: 'POST',
                url: "/api/Home/InsertNotes",
                data: JSON.stringify(BussData),
            }).then(function (result) {
                $timeout(function () {
                    // BussData.ID = result.data[0].ID;
                    //alert(result.data[0].ID);
                    if (BussData.ID != "") {
                        ShowPopup("Notes Updated");
                    }
                    else {

                        ShowPopup("Notes Saved Successfully");
                    }
                    //var url = "/VslVoy/ServiceSetupView";
                    //window.location.href = url;

                    setTimeOut(function () {
                        window.location = "/";
                    }, 3000);
                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }


                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    // $(".modal").hide();
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                // This is set in the event of an error.
                console.log(result);
                ShowPopup('There has been an error: ' + result);
            });

        }
        //---------5th TAB END ------------///


        $scope.onPageTab = function (val) {
            if (val == "2" || val == "3" || val == "4" || val == "5") {
                if (typeof $scope.HdRegId == "undefined") {

                    ShowPopup("Please Fill Sailing Schedule Details First");
                    $('#sailingschedule').removeClass('active');
                    $('#operators').addClass('active');
                    $('#berthingdtls').addClass('active');
                    $('#manifestdtls').addClass('active');
                    $('#notesdtls').addClass('active');
                }

            }
        }

        $scope.UpdateExpImpoutBoundVoyNo = function (val) {

            if (val.InBoundVoy != 0) {

                val.OutBoundVoy = val.InBoundVoy
            }

        }
    });

    function ShowPopup(message) {
        swal(message);
    };


</script>
<style>
    .lable-fond {
        text-align: left !important;
    }

    input[type=checkbox] {
        width: 100% !important;
        height: 17px !important;
    }

    .form-control.txtport {
        width: 134px;
        border-radius: 0;
    }

    .tblservie.table > thead > tr > th {
        text-align: center;
    }

        .tblservie.table > thead > tr > th.headtitle {
            font-size: 15px !important;
        }

    .tblservie.table > thead > tr.bighead > th {
        background-color: #f9f9f9;
        color: #304974;
    }

    .table.tblservie > tbody > tr > td {
        padding: 4px 4px !important;
    }

    .tblservie.table .form-control {
        border-radius: 0;
    }

    .table thead tr th {
        border-right: none;
        border: 2px solid #3049747a;
        padding: 4px 8px !important;
    }

    .table > thead > tr > th, .table > tbody > tr > th, .table > tfoot > tr > th {
        font-size: 13px !important;
    }

    .bmd-form-group .checkbox label, .bmd-form-group .radio label, .bmd-form-group label {
        width: 130px !important;
        font-size: 13px !important;
    }

    .nav.nav-tabs.demtab {
        display: inline-flex
    }

    .nav-tabs.demtab > li {
        width: 113px !important;
    }

    .nav-tabs.demtab li a:after {
        border-bottom: none !important;
    }

    .nav-tabs.demtab li a:before {
        border-top: none !important;
    }

    .nav-tabs.demtab .nav-link.active {
        background-color: #e91e63 !important;
    }

    .bmd-form-group .checkbox label, .bmd-form-group .radio label, .bmd-form-group label {
        font-size: 12px !important;
        line-height: 0 !important;
    }

    .form-check, label {
        line-height: 0 !important;
    }

    .btndet {
        padding: 7px 6px !important;
        margin-top: 30px !important;
    }

    label.chkbox {
        line-height: 1;
    }
    /*input[type=checkbox]
    {

        width: 18px;
        height: 18px;
        cursor:pointer;
    }
    .form-check .form-check-label
    {
        padding-left:0;
    }*/
    .col-md-5.lbl2 {
        width: 100px !important;
    }

    .lblfont {
        width: 100px !important;
    }

    .card-wizard {
        box-shadow: none !important;
        border: 1px solid #ccc;
    }

    .form-group {
        padding-bottom: 5px !important;
    }

    .ml-auto, .mx-auto {
        margin-top: 20px;
    }

    .card .card-body .download {
        margin-top: -24px !important;
        margin-bottom: -18px !important;
    }

        .card .card-body .download .btn {
            padding: 11px 17px;
            font-size: 14px;
        }
</style>
<link href="~/assets/css/common.css" rel="stylesheet" />

<div ng-app="MyApp" ng-controller="MyController">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12 backbtn" style="text-align:right;">
                <a href="/VesVoy/VoyageDetailsNewView" class="btn btn-fill btn-success btn-round btntop">
                    <i class="material-icons">reply</i> Back

                </a>
                @*<button type="submit" ng-click="AddNew();" class="btn btn-fill btn-warning btn-round btntop">
                        <i class="material-icons">edit</i>

                    </button>*@
            </div>
        </div>
        <div class="row">

            <div class="col-md-12">
                <div class="card ">
                    <div class="card-header card-header-primary card-header-text">
                        <div class="card-text">
                            <h4 class="card-title">Voyage Details </h4>
                        </div>
                    </div>
                    <div class="card-body ">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <label class="lable-fond">Service</label>
                                            <select id="ddlService" ng-model="ddlService" class="form-control my-select" ng-options="item.ServiceName for item in ServiceList track by item.ID"></select>
                                        </div>

                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <label class="lable-fond">Vessel</label>
                                            <select id="ddlVessel" ng-model="ddlVessel" class="form-control my-select" ng-options="item.VesselName for item in Vessel track by item.ID"></select>
                                        </div>

                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <label class="lable-fond">Rotation No</label>

                                            <input id="txtRotNo" type="text" ng-model="txtRotNo" class="form-control" />
                                        </div>

                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <label class="lable-fond">ETA</label>
                                            <input type="datetime-local" id="txtETA" ng-model="txtETA" class="form-control" />
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 txtright">
                                <button type="submit" id="btngetschedule" ng-click="GetSchedule();" class="btn btn-fill btn-primary">
                                    Get Schedule
                                </button>

                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="nav-tabs-navigation">
                                    <div class="nav-tabs-wrapper">

                                        <ul class="nav nav-tabs demtab" data-tabs="tabs" style="width:100%; margin-top:22px!important;">
                                            <li class="nav-item">
                                                <a class="nav-link active" ng-click="onPageTab(1);" id="sailingschedule" href="#SailingSchedule" data-toggle="tab">
                                                    Sailing Schedule
                                                    <div class="ripple-container"></div>
                                                </a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link" ng-click="onPageTab(2);" id="operators" href="#Operators" data-toggle="tab">
                                                    Operator Details
                                                    <div class="ripple-container"></div>
                                                </a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link" ng-click="onPageTab(3);" id="berthingdtls" href="#BerthingDtls" data-toggle="tab">
                                                    Berthing Details
                                                    <div class="ripple-container"></div>
                                                </a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link" ng-click="onPageTab(4);" id="manifestdtls" href="#ManifestDtls" data-toggle="tab">
                                                    Manifest Details
                                                    <div class="ripple-container"></div>
                                                </a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link" ng-click="onPageTab(5);" id="notesdtls" href="#NotesDtls" data-toggle="tab">
                                                    Voyage <br /> Notes
                                                    <div class="ripple-container"></div>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="tab-content" style="padding:0;">
                                    <div class="tab-pane active" id="SailingSchedule">


                                        <div class="row">
                                            <div class="col-md-12" style="margin-top: 35px;">
                                                <div class="material-datatables" style="overflow-y:scroll;height:400px;">

                                                    <table class="table tblservie table-striped table-bordered table-hover" cellspacing="0" width="100%" style="width:100%">
                                                        <thead>

                                                            <tr class="bighead">
                                                                @*<th rowspan="2">Action</th>*@
                                                                <th rowspan="2">S.No</th>
                                                                <th rowspan="2">Inbound Voyage</th>
                                                                <th rowspan="2">Outbound Voyage</th>
                                                                <th rowspan="2">Ports</th>
                                                                <th rowspan="2">Terminal</th>
                                                                <th colspan="4">Arrival</th>
                                                                <th colspan="4">Departure</th>
                                                            </tr>
                                                            <tr class="bighead">
                                                                <th>ETA</th>
                                                                <th>Day</th>
                                                                <th>HH</th>
                                                                <th>MM</th>
                                                                <th>ETD</th>
                                                                <th>Day</th>
                                                                <th>HH</th>
                                                                <th>MM</th>
                                                            </tr>

                                                        </thead>

                                                        <tbody>
                                                            <tr ng-repeat="iRow in DynamicGridSchedule">
                                                                @*<td class="td-actions text-right">
                                                                    <button type="button" rel="tooltip" ng-if="$last" ng-click="AddSchedule(iRow)" class="btn btn-primary btn-round" data-original-title="" title="">
                                                                        <i class="material-icons">add</i>
                                                                    </button>
                                                                    <button type="button" rel="tooltip" ng-if="!$last" ng-click="RemoveSchedule(DynamicGridSchedule,$index)" class="btn btn-danger btn-round" data-original-title="" title="">
                                                                        <i class="material-icons">delete</i>
                                                                    </button>*@

                                                                <td>
                                                                    {{$index+1}}
                                                                </td>
                                                                <td>
                                                                    <input type="text" ng-model="iRow.InBoundVoy" id="txtInBoundVoy" ng-change="UpdateExpImpoutBoundVoyNo(iRow)" class="form-control" />
                                                                </td>
                                                                <td>
                                                                    <input type="text" ng-model="iRow.OutBoundVoy" id="txtOutBoundVoy" class="form-control" />
                                                                </td>
                                                                <td>
                                                                    <select class="form-control" ng-model="iRow.Port" id="ddlPort{{$index}}" ng-options="item.PortName for item in PortValues track by item.ID" ng-change="PortChange(iRow,$index);" required></select>
                                                                    @*<select class="form-control" ng-model="iRow.Port" ng-options="item.PortName for item in PortValues track by item.ID"  required></select>*@
                                                                </td>
                                                                <td>
                                                                    @*<select class="form-control" ng-model="iRow.Terminal" ng-options="item.TerminalName for item in TerminalValues track by item.ID" required></select>*@
                                                                    <select class="form-control" ng-model="iRow.Terminal" id="ddlTerminal{{$index}}" ng-change="TerminalOnload(iRow,$index);" required></select>
                                                                </td>

                                                                <td>
                                                                    <input type="datetime-local" date-format="dd-mm-yyyy" value="{{iRow.ArrivalETA}}" ng-model="iRow.ArrivalETA" id="txtArrivalETA{{$index}}" class="form-control" />
                                                                </td>
                                                                <td>
                                                                    <select class="form-control" ng-model="iRow.ArrivalDay" id="ddlArrivalDay" ng-options="item.Name for item in Weekdays track by item.ID" required></select>
                                                                </td>
                                                                <td>
                                                                    <input type="text" ng-model="iRow.ArrivalHH" id="txtArrivalHH" class="form-control" />
                                                                </td>
                                                                <td>
                                                                    <input type="text" ng-model="iRow.ArrivalMM" id="txtArrivalMM" class="form-control" />
                                                                </td>
                                                                <td>
                                                                    <input type="datetime-local" date-format="dd-mm-yyyy" value="{{iRow.DepETD}}" ng-model="iRow.DepETD" id="txtDepETD{{$index}}" class="form-control" />
                                                                </td>
                                                                <td>
                                                                    <select class="form-control" ng-model="iRow.DepDay" id="ddlDepDay" ng-options="item.Name for item in WeekdaysA track by item.ID" required></select>
                                                                </td>
                                                                <td>
                                                                    <input type="text" ng-model="iRow.DepHH" id="txtDepHH" class="form-control" />
                                                                </td>
                                                                <td>
                                                                    <input type="text" ng-model="iRow.DepMM" id="txtDepMM" class="form-control" />
                                                                </td>
                                                                <td style="display:none;"><input type="hidden" id="HdRID" ng-model="iRow.RID" /></td>
                                                            </tr>

                                                        </tbody>
                                                    </table>

                                                </div>
                                            </div>

                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 txtright">
                                                <button type="submit" ng-click="RecordSave(DynamicGridSchedule);" class="btn btn-fill btn-success">
                                                    <i class="material-icons">save</i>
                                                    SUBMIT
                                                </button>
                                                <input type="hidden" id="HdRegID" ng-model="HdRegID" />
                                                <input type="hidden" id="HdIsExpImp" ng-model="HdIsExpImp" />

                                            </div>
                                            <div class="clearfix"></div>
                                        </div>
                                    </div>

                                    <div class="tab-pane" id="Operators">

                                        <div class="row">

                                            <div class="col-md-12">
                                                <div class="material-datatables">

                                                    <table class="table table-striped table-no-bordered table-hover" cellspacing="0" width="60%" style="width:60%">
                                                        <thead>
                                                            <tr>
                                                            </tr>
                                                            <tr class="bighead">
                                                                <th></th>
                                                                <th> Operator</th>
                                                                <th>Slot Reference</th>

                                                                <th class="disabled-sorting text-right actwid">Action</th>
                                                            </tr>
                                                        </thead>

                                                        <tbody style="margin-top:20px!important;">
                                                            <tr class="bighead">
                                                                <td></td>
                                                                <td class="chg">
                                                                    <input type="hidden" id="HDIDv" class="form-control" ng-model="OID" />
                                                                    <input type="hidden" id="HDArrayIndex" class="form-control" ng-model="HDArrayIndex" />
                                                                    <select id="ddlOperator" ng-model="Operator" class="form-control" ng-options="item.Operator for item in OperatorValue track by item.ID"></select>

                                                                </td>
                                                                <td class="chgcode">
                                                                    <select id="ddlSlotRef" ng-model="SlotRef" class="form-control" ng-options="item.SlotRefCode for item in SlotRefValues track by item.ID"></select>
                                                                </td>

                                                                <td class="td-actions text-right entrygrid">
                                                                    <button type="button" rel="tooltip" ng-click="AddOperator(gRow)" class="btn btn-primary btn-round" data-original-title="" title="">
                                                                        <i class="material-icons">add</i>
                                                                    </button>

                                                                </td>
                                                            </tr>
                                                        </tbody>

                                                        <thead>
                                                            <tr class="bighead">
                                                                <th>S.No</th>
                                                                <th> Operator</th>
                                                                <th>Slot Reference</th>

                                                                <th class="disabled-sorting text-right">Actions</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>


                                                            <tr class="gridbody1" ng-repeat="gRow in DynamicGridOperator">
                                                                <td>{{$index+1}}</td>

                                                                <td>
                                                                    {{gRow.Operator}}

                                                                    <input type="hidden" id="HDOperatorID" class="form-control" ng-model="gRow.OperatorID" />
                                                                </td>
                                                                <td>
                                                                    {{gRow.SlotRef}}

                                                                    <input type="hidden" id="HDSlotRefID" class="form-control" ng-model="gRow.SlotRefID" />
                                                                </td>



                                                                <td id="BtnActionopr" class="td-actions text-right bindgrid">
                                                                    <button @*--ng-show="gRow.RemoveOpr"*@ type="button" rel="tooltip" ng-click="RemoveOperator(DynamicGridOperator,$index,gRow.OID)" class="btn btn-danger btn-round" data-original-title="" title="">
                                                                        <i class="material-icons">delete</i>
                                                                    </button>
                                                                    <button @*ng-show="gRow.SelectOpr"*@ type="button" rel="tooltip" ng-click="Selectvalues(DynamicGridOperator,$index)" class="btn btn-success btn-round" data-original-title="" title="">
                                                                        <i class="material-icons">edit</i>
                                                                    </button>

                                                                    <input type="hidden" id="HOID" class="form-control" ng-model="gRow.OID" />
                                                                </td>

                                                            </tr>


                                                        </tbody>
                                                    </table>

                                                    @*<div id="notFoundDiv" ng-show="(CustomerRec|filter:CountryCode).length==0" style="color: red; font-weight: bold">No Records Found</div>*@
                                                </div>
                                            </div>


                                        </div>


                                        <div class="row">
                                            <div class="col-md-12 txtright">
                                                <button type="submit" ng-click="SaveOperators(DynamicGridOperator);" class="btn btn-fill btn-success">
                                                    <i class="material-icons">save</i>
                                                    Save
                                                </button>

                                            </div>
                                            <div class="clearfix"></div>
                                        </div>

                                    </div>

                                    <div class="tab-pane" id="BerthingDtls">

                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="col-md-12">
                                                            <div class="row">
                                                                <div class="col-md-12" style="border-bottom:1px solid #ccc;padding-bottom:6px;">
                                                                    <div class="form-group">
                                                                        <div class="row">
                                                                            <div class="col-md-3 lbl2"><label class="lable-fond" style="font-weight:bold!important;">Berthing Details For Port</label></div>
                                                                            <div class="col-md-1">:</div>
                                                                            <div class="col-md-6">
                                                                                <select class="form-control my-select" ng-model="ddlBerthPort" id="ddlBerthPort" ng-options="item.Name for item in LoginRoutePortValues track by item.ID" required></select>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-12">
                                                                    <div class="row">
                                                                        <div class="col-md-6 padlr0">
                                                                            <div class="col-md-12">
                                                                                <div class="form-group">
                                                                                    <div class="row">
                                                                                        <div class="col-md-4 lbl2"><label class="lable-fond">General Cut-Off</label></div>
                                                                                        <div class="col-md-1">:</div>
                                                                                        <div class="col-md-7">
                                                                                            <input type="datetime-local" autocomplete="off" id="txtCutOff" ng-model="txtCutOff" class="form-control">
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="col-md-12">
                                                                                <div class="form-group">
                                                                                    <div class="row">
                                                                                        <div class="col-md-4 lbl2"><label class="lable-fond">Actual Date Of Arrival</label></div>
                                                                                        <div class="col-md-1">:</div>
                                                                                        <div class="col-md-7">
                                                                                            <input type="datetime-local" autocomplete="off" id="txtActDtArrival" ng-model="txtActDtArrival" class="form-control">
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="col-md-12">
                                                                                <div class="form-group">
                                                                                    <div class="row">
                                                                                        <div class="col-md-4 lbl2"><label class="lable-fond">Pilot On-Board(Arrival)</label></div>
                                                                                        <div class="col-md-1">:</div>
                                                                                        <div class="col-md-7">
                                                                                            <input type="datetime-local" autocomplete="off" id="txtPilotOB" ng-model="txtPilotOB" class="form-control">
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="col-md-12">
                                                                                <div class="form-group">
                                                                                    <div class="row">
                                                                                        <div class="col-md-4 lbl2"><label class="lable-fond">Vessel Birth </label></div>
                                                                                        <div class="col-md-1">:</div>
                                                                                        <div class="col-md-7">
                                                                                            <input type="datetime-local" autocomplete="off" id="txtVslBrth" ng-model="txtVslBrth" class="form-control">
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="col-md-12">
                                                                                <div class="form-group">
                                                                                    <div class="row">
                                                                                        <div class="col-md-4 lbl2"><label class="lable-fond">Discharged Comm </label></div>
                                                                                        <div class="col-md-1">:</div>
                                                                                        <div class="col-md-7">
                                                                                            <input type="datetime-local" autocomplete="off" id="txtDisCom" ng-model="txtDisCom" class="form-control">
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>

                                                                            <div class="col-md-12">
                                                                                <div class="form-group">
                                                                                    <div class="row">
                                                                                        <div class="col-md-4 lbl2"><label class="lable-fond">Discharged Completed </label></div>
                                                                                        <div class="col-md-1">:</div>
                                                                                        <div class="col-md-7">
                                                                                            <input type="datetime-local" autocomplete="off" id="txtDisComplete" ng-model="txtDisComplete" class="form-control">
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>

                                                                            <div class="col-md-12">
                                                                                <div class="form-group">
                                                                                    <div class="row">
                                                                                        <div class="col-md-4 lbl2"><label class="lable-fond">Loading Commenced </label></div>
                                                                                        <div class="col-md-1">:</div>
                                                                                        <div class="col-md-7">
                                                                                            <input type="datetime-local" autocomplete="off" id="txtLoadCom" ng-model="txtLoadCom" class="form-control">
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>

                                                                            <div class="col-md-12">
                                                                                <div class="form-group">
                                                                                    <div class="row">
                                                                                        <div class="col-md-4 lbl2"><label class="lable-fond">Loading Completed </label></div>
                                                                                        <div class="col-md-1">:</div>
                                                                                        <div class="col-md-7">
                                                                                            <input type="datetime-local" autocomplete="off" id="txtLoadComplete" ng-model="txtLoadComplete" class="form-control">
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="col-md-12">
                                                                                <div class="form-group">
                                                                                    <div class="row">
                                                                                        <div class="col-md-4 lbl2"><label class="lable-fond">Pilot On-Board(Sailing)</label></div>
                                                                                        <div class="col-md-1">:</div>
                                                                                        <div class="col-md-7">
                                                                                            <input type="datetime-local" autocomplete="off" id="txtPilotOBSail" ng-model="txtPilotOBSail" class="form-control">
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="col-md-12">
                                                                                <div class="form-group">
                                                                                    <div class="row">
                                                                                        <div class="col-md-4 lbl2"><label class="lable-fond">Actual Date Of Departure</label></div>
                                                                                        <div class="col-md-1">:</div>
                                                                                        <div class="col-md-7">
                                                                                            <input type="datetime-local" autocomplete="off" id="txtDateDep" ng-model="txtDateDep" class="form-control">
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-6">
                                                                            <div class="col-md-12">
                                                                                <div class="form-group">
                                                                                    <div class="row">
                                                                                        <div class="col-md-4 lbl2"><label class="lable-fond">VCN Number</label></div>
                                                                                        <div class="col-md-1">:</div>
                                                                                        <div class="col-md-7">
                                                                                            <input type="text" autocomplete="off" id="txtVCNNo" ng-model="txtVCNNo" class="form-control">
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>

                                                                            <div class="col-md-12">
                                                                                <div class="form-group">
                                                                                    <div class="row">
                                                                                        <div class="col-md-4 lbl2"><label class="lable-fond">Port Clearance</label></div>
                                                                                        <div class="col-md-1">:</div>
                                                                                        <div class="col-md-7">
                                                                                            <input type="text" autocomplete="off" id="txtPortClr" ng-model="txtPortClr" class="form-control">
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>





                                                            </div>
                                                        </div>



                                                    </div>

                                                </div>
                                            </div>

                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 txtright">
                                                <a href="#" class="btn btn-default" ng-click="btnModelSendMail();">SEND EMAIL</a>
                                            </div>

                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 txtright">
                                                <button type="submit" class="btn btn-fill btn-success" ng-click="SaveBerthingDtls();">
                                                    <i class="material-icons">save</i>
                                                    Save
                                                </button>
                                            </div>



                                        </div>

                                    </div>


                                    <div class="tab-pane" id="ManifestDtls">

                                        <!--<div class="row">

                                        <div class="col-md-12">
                                            <div class="material-datatables">

                                                <table class="table table-striped table-no-bordered table-hover" cellspacing="0" width="100%" style="width:100%">
                                                    <thead>
                                                        <tr>
                                                        </tr>
                                                        <tr class="bighead">
                                                            <th></th>
                                                            <th> EGMNo</th>
                                                            <th>EGM Date </th>
                                                            <th> IGMNo</th>
                                                            <th>IGM Date </th>
                                                            <th class="disabled-sorting text-right actwid">Action</th>
                                                        </tr>
                                                    </thead>

                                                    <tbody style="margin-top:20px!important;">
                                                        <tr class="bighead">
                                                            <td></td>
                                                            <td class="chg">
                                                                <input type="hidden" id="HDIDv" class="form-control" ng-model="MID" />
                                                                <input type="hidden" id="HDArrayIndex" class="form-control" ng-model="HDArrayIndex" />
                                                                <input type="text" id="txtEGMNo" class="form-control" ng-model="EGMNo" />

                                                            </td>
                                                            <td>
                                                                <input type="text" id="txtEGMDate" class="form-control datepicker" ng-model="EGMDate" />
                                                            </td>
                                                            <td>
                                                                <input type="text" id="txtIGMNo" class="form-control " ng-model="IGMNo" />
                                                            </td>
                                                            <td>
                                                                <input type="text" id="txtIGMDate" class="form-control datepicker" ng-model="IGMDate" />
                                                            </td>

                                                            <td class="td-actions text-right entrygrid">
                                                                <button type="button" rel="tooltip" ng-click="AddManifestDtls(gRow)" class="btn btn-primary btn-round" data-original-title="" title="">
                                                                    <i class="material-icons">add</i>
                                                                </button>

                                                            </td>
                                                        </tr>
                                                    </tbody>

                                                    <thead>
                                                        <tr class="gridhead1">
                                                            <th>S.No</th>
                                                            <th> EGMNo</th>
                                                            <th>EGM Date </th>
                                                            <th> IGMNo</th>
                                                            <th>IGM Date </th>

                                                            <th class="disabled-sorting text-right">Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>


                                                        <tr class="gridbody1" ng-repeat="gRow in DynamicManifestDtls">
                                                            <td>{{$index+1}}</td>

                                                            <td>
                                                                {{gRow.EGMNo}}

                                                            </td>
                                                            <td>
                                                                {{gRow.EGMDate}}

                                                            </td>

                                                            <td>
                                                                {{gRow.IGMNo}}

                                                            </td>
                                                            <td>
                                                                {{gRow.IGMDate}}

                                                            </td>



                                                            <td class="td-actions text-right bindgrid">
                                                                <button type="button" rel="tooltip" ng-click="RemoveManifestDtls(DynamicManifestDtls,$index)" class="btn btn-danger btn-round" data-original-title="" title="">
                                                                    <i class="material-icons">delete</i>
                                                                </button>
                                                                <button type="button" rel="tooltip" ng-click="SelectvaluesMd(DynamicManifestDtls,$index)" class="btn btn-success btn-round" data-original-title="" title="">
                                                                    <i class="material-icons">edit</i>
                                                                </button>

                                                                <input type="hidden" id="HMID" class="form-control" ng-model="gRow.MID" />
                                                            </td>

                                                        </tr>


                                                    </tbody>
                                                </table>-->
                                        @*<div id="notFoundDiv" ng-show="(CustomerRec|filter:CountryCode).length==0" style="color: red; font-weight: bold">No Records Found</div>*@
                                        <!--</div>
                                            </div>


                                        </div>-->

                                        <div class="row">
                                            <div class="col-md-12" style="margin-top: 35px;">
                                                <div class="material-datatables">

                                                    <table class="table tblservie table-striped table-bordered table-hover" cellspacing="0" width="100%" style="width:100%">
                                                        <thead>
                                                            <tr>

                                                                <th> EGMNo</th>
                                                                <th>EGM Date </th>
                                                                <th> IGMNo</th>
                                                                <th>IGM Date </th>
                                                                <th class="disabled-sorting text-right actwid">Action</th>
                                                            </tr>
                                                        </thead>

                                                        <tbody>

                                                            <tr ng-repeat="gRow in DynamicManifestDtls">

                                                                <td class="chg">
                                                                    <input type="hidden" id="HDIDv" class="form-control" ng-model="MID" />
                                                                    @*<input type="hidden" id="HDArrayIndex" class="form-control" ng-model="HDArrayIndex" />*@
                                                                    <input type="text" id="txtEGMNo" class="form-control" ng-model="EGMNo" />

                                                                </td>
                                                                <td>

                                                                    <input type="date" id="txtEGMDate{{$index}}" date-format="dd-mm-yyyy" value="{{gRow.EGMDate}}" class="form-control" ng-model="gRow.EGMDate" />
                                                                </td>
                                                                <td>
                                                                    <input type="text" id="txtIGMNo" class="form-control " ng-model="gRow.IGMNo" />
                                                                </td>
                                                                <td>
                                                                    <input type="date" id="txtIGMDate{{$index}}" date-format="dd-mm-yyyy" value="{{gRow.IGMDate}}" class="form-control" ng-model="gRow.IGMDate" />
                                                                </td>


                                                                <td class="td-actions text-right">
                                                                    <button type="button" rel="tooltip" ng-if="$last" ng-click="AddManifestDtls(gRow)" class="btn btn-primary btn-round" data-original-title="" title="">
                                                                        <i class="material-icons">add</i>
                                                                    </button>
                                                                    <button type="button" rel="tooltip" ng-if="!$last" ng-click="RemoveManifestDtls(DynamicManifestDtls,$index)" class="btn btn-danger btn-round" data-original-title="" title="">
                                                                        <i class="material-icons">delete</i>
                                                                    </button>

                                                                </td>
                                                            </tr>

                                                        </tbody>
                                                    </table>

                                                </div>
                                            </div>

                                        </div>

                                        <div class="row">
                                            <div class="col-md-12 txtright">
                                                <button type="submit" ng-click="SaveManifestDtls(DynamicManifestDtls);" class="btn btn-fill btn-success">
                                                    <i class="material-icons">save</i>
                                                    Save
                                                </button>

                                            </div>
                                            <div class="clearfix"></div>
                                        </div>

                                    </div>

                                    <div class="tab-pane" id="NotesDtls">



                                        <div class="row">

                                            <div class="col-md-12">
                                                <div class="material-datatables">

                                                    <table class="table table-striped table-no-bordered table-hover" cellspacing="0" width="100%" style="width:100%">
                                                        <thead>
                                                            <tr>
                                                            </tr>
                                                            <tr class="bighead">
                                                                <th></th>
                                                                <th> Voyage Notes</th>
                                                                <th>Notes </th>

                                                                <th class="disabled-sorting text-right actwid">Action</th>
                                                            </tr>
                                                        </thead>

                                                        <tbody style="margin-top:20px!important;">
                                                            <tr class="bighead">
                                                                <td></td>
                                                                <td class="chg">
                                                                    <input type="hidden" id="HDIDv" class="form-control" ng-model="NID" />
                                                                    <input type="hidden" id="HDArrayIndexv" class="form-control" ng-model="HDArrayIndexv" />
                                                                    <select id="ddlNoteTypes" ng-model="NotesTypeID" class="form-control my-select" ng-options="item.NotesTypeValues for item in NoteTypesList track by item.ID"></select>

                                                                </td>
                                                                <td>
                                                                    <input type="text" id="txtNotes" class="form-control" ng-model="Notes" />
                                                                </td>

                                                                <td class="td-actions text-right entrygrid">
                                                                    <button type="button" rel="tooltip" ng-click="AddNotes(gRow)" class="btn btn-primary btn-round" data-original-title="" title="">
                                                                        <i class="material-icons">add</i>
                                                                    </button>

                                                                </td>
                                                            </tr>
                                                        </tbody>

                                                        <thead>
                                                            <tr class="gridhead1">
                                                                <th>S.No</th>
                                                                <th> Voyage Notes</th>
                                                                <th>Notes </th>

                                                                <th class="disabled-sorting text-right">Actions</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>


                                                            <tr class="gridbody1" ng-repeat="iRow in DynamicNotesDtls">
                                                                <td>{{$index+1}}</td>

                                                                <td>
                                                                    {{iRow.NotesType}}
                                                                    <input type="hidden" id="HDNotesTypeID" class="form-control" ng-model="iRow.NotesTypeID" />
                                                                </td>
                                                                <td>
                                                                    {{iRow.Notes}}

                                                                </td>



                                                                <td class="td-actions text-right bindgrid">
                                                                    <button type="button" rel="tooltip" ng-click="RemoveNotes(DynamicNotesDtls,$index,iRow.NID)" class="btn btn-danger btn-round" data-original-title="" title="">
                                                                        <i class="material-icons">delete</i>
                                                                    </button>
                                                                    <button type="button" rel="tooltip" ng-click="SelectNotes(DynamicNotesDtls,$index)" class="btn btn-success btn-round" data-original-title="" title="">
                                                                        <i class="material-icons">edit</i>
                                                                    </button>

                                                                    <input type="hidden" id="HMID" class="form-control" ng-model="gRow.NID" />
                                                                </td>

                                                            </tr>


                                                        </tbody>
                                                    </table>
                                                    <div id="notFoundDiv" ng-show="(CustomerRec|filter:CountryCode).length==0" style="color: red; font-weight: bold">No Records Found</div>
                                                </div>
                                            </div>


                                        </div>

                                        <div class="row">
                                            <div class="col-md-12 txtright">
                                                <button type="submit" ng-click="SaveNotesDtls(DynamicNotesDtls);" class="btn btn-fill btn-success">
                                                    <i class="material-icons">save</i>
                                                    Save
                                                </button>

                                            </div>
                                            <div class="clearfix"></div>
                                        </div>

                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

            </div>
        </div>

        <div class="modal" id="SendMail" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content" style="margin:0 auto; width:900px;">

                    <!-- Modal Header -->
                    <div class="modal-header">
                        <h4 class="modal-title" style="font-size:18px;"></h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <!-- Modal body -->
                    <div class="modal-body" style="padding-bottom:0;border-bottom: 1px solid #ccc;margin-bottom:6px;">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group" style="margin-top:0;">
                                    <div class="row">
                                        <div class="col-md-6" style="border: 1px solid #ccc; background-color: #eeeeee59; border-top: 5px solid #ebc354; ">
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <label>Vessel Name  : </label> <span ng-bind="VslName"></span>
                                                </div>

                                            </div>


                                        </div>
                                        <div class="col-md-6" style="border: 1px solid #ccc; background-color: #eeeeee59; border-top: 5px solid #ebc354; ">
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <label>Voyage No  :</label>
                                                    <span ng-bind="VoyageNo"></span>
                                                </div>

                                            </div>

                                        </div>


                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div class="material-datatables">

                                <table class="table table-striped table-no-bordered table-hover" cellspacing="0" width="100%" style="width:100%">
                                    <thead>
                                        <tr>
                                            <th>S.No</th>
                                            <th>Booking/BL NO</th>
                                            <th>Booking Party</th>
                                            <th> Customer Email ID</th>

                                            <th class="disabled-sorting text-right">Actions</th>
                                        </tr>
                                    </thead>

                                    <tbody>
                                        <tr ng-repeat="i in GridBkgPartyDtls | filter : paginate | orderBy:'-Statusv'">
                                            <td>{{$index+1}}</td>
                                            <td>{{i.BookingNo}}</td>
                                            <td>{{i.BkgParty}}</td>
                                            <td>{{i.Email}}</td>

                                            <td class="td-actions text-right">

                                                <button type="button" ng-click="SendMail(i.Email);" rel="tooltip" class="btn btn-default" data-original-title="" title="">
                                                    Send Email
                                                </button>

                                            </td>
                                        </tr>

                                    </tbody>
                                </table>
                                <div id="notFoundDiv" ng-show="(GridBkgPartyDtls|filter:BookingNo).length==0" style="color: red; font-weight: bold">No Records Found</div>
                            </div>
                        </div>
                    </div>



                </div>



            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        // Initialise the wizard
        demo.initMaterialWizard();
        setTimeout(function () {
            $('.card.card-wizard').addClass('active');
        }, 600);
    });
</script>
<script>

</script>