@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.full.min.js"></script>


<script type="text/javascript">

    $(document).ready(function () {
        $('.my-select').select2({
            placeholder: "--Select--",
            allowClear: true,
            width: '100%'
        });

    });
    LayoutApp.controller('MyController', function ($scope, $http, $timeout) {


        $('#overlay').fadeIn().delay(300).fadeOut();
        $scope.HDArrayIndex = "";

        $scope.StatusBindValues = [

            { 'name': 'Active', 'ID': 1 },
            { 'name': 'InActive ', 'ID': 2 }
        ];
        $scope.FreeUnitsList = [
            { 'Name': '--select--', 'ID': 0 },
            { 'Name': 'TEUS', 'ID': 1 },
            { 'Name': 'UNITS ', 'ID': 2 }
        ];
        
        $scope.Countrylist = null;
        $scope.fillCountry = function () {
            $http({
                method: 'POST',
                url: '/api/Home/BindCountries/',
                data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.Countrylist = result.data;

                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });

        };
        $scope.fillCountry();

        $("#ddlCountry").change(function () {
            $scope.GeoLocationListByCtry = null;
            var Datavalue = {};

            Datavalue.ID = $("#ddlCountry").val();
            $http({
                method: 'POST',
                url: '/api/SalesApi/GeoLocByCountry/',
                data: JSON.stringify(Datavalue),
                // data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.GeoLocationListByCtry = result.data;
                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        });

        $scope.ExistGeoLocBind = function (CtryID) {
            $scope.GeoLocationListByCtry = null;
            var Datavalue = {};

            Datavalue.ID = CtryID;
            $http({
                method: 'POST',
                url: '/api/SalesApi/GeoLocByCountry/',
                data: JSON.stringify(Datavalue),
                // data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.GeoLocationListByCtry = result.data;
                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        };

        $("#ddlGeoLoc").change(function () {

            var Datavalue = {};
            Datavalue.ID = $("#ddlGeoLoc").val();
            $http({
                method: 'POST',
                url: '/api/ContainerApi/ListDepotByGeoLoc/',
                data: JSON.stringify(Datavalue)
            }).then(function (result) {
                $timeout(function () {
                    $scope.DepotValue = result.data;

                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });

        });

        $scope.ExistEmptyYardBind = function (GeoLocID) {

            var Datavalue = {};
            Datavalue.ID = GeoLocID;
            $http({
                method: 'POST',
                url: '/api/ContainerApi/ListDepotByGeoLoc/',
                data: JSON.stringify(Datavalue)
            }).then(function (result) {
                $timeout(function () {
                    $scope.DepotValue = result.data;

                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });

        };

        $scope.CntrSizeTypes = null;
        $scope.fillCntrSizeTypes = function () {
            $http({
                method: 'POST',
                url: '/api/ContainerApi/CntrTypeSize/',
                data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.CntrSizeTypes = result.data;

                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected. Please reconnect and try again.");
                }
            });

        };
        $scope.fillCntrSizeTypes();

        $scope.ChargeCodeAllvalues = null;
        $scope.fillChargecodeValues = function () {
            $http({
                method: 'POST',
                url: '/api/CommonAccessApi/ChargeCode/',
                data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.ChargeCodeAllvalues = result.data;

                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        };
        $scope.fillChargecodeValues();

        $scope.ChageOwnerAllValues = null;
        $scope.fillChageOwnerAllValues = function () {
            var Datavalue = {};
            Datavalue.ID = "11"; //GeneralMaster Table seqNo
            $http({
                method: 'POST',
                url: '/api/CommonAccessApi/ModuleValues/',
                data: JSON.stringify(Datavalue)
            }).then(function (result) {
                $timeout(function () {
                    $scope.ChageOwnerAllValues = result.data;

                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        };
        $scope.fillChageOwnerAllValues();

        $scope.ChargeTypeAllValues = null;
        $scope.fillChargeTypeAllValues = function () {
            var Datavalue = {};
            Datavalue.ID = "34"; //GeneralMaster Table seqNo
            $http({
                method: 'POST',
                url: '/api/CommonAccessApi/ModuleValues/',
                data: JSON.stringify(Datavalue)
            }).then(function (result) {
                $timeout(function () {
                    $scope.ChargeTypeAllValues = result.data;

                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        };
        $scope.fillChargeTypeAllValues();

        $scope.CurrencyValue = null;
        $scope.fillCurrencyValues = function () {
            $http({
                method: 'POST',
                url: '/api/CommonAccessApi/CurrencyValues/',
                data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.CurrencyValue = result.data;

                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        };
        $scope.fillCurrencyValues();

      
        $scope.DepotMasterValues = null;
        $scope.fillDepotValues = function () {
            $http({
                method: 'POST',
                url: '/api/CommonAccessApi/DepotMaster/',
                data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.DepotMasterValues = result.data;

                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        };
        $scope.fillDepotValues();

        
        $scope.DynamicGridPortCost = [{ EID: "", ChargeID: "", CurrencyID: "", PCT20: "", PCT40: "", PHQCT: "" }];

        $scope.DynamicGridSlab = [{ TID: "", SlabFrom: "", SlabTo: "", CT20: "", CT40: "",HQCT: "" }];
       // $scope.DynamicGrid.splice(0, 1);

        $scope.Add = function (gRow, index)
        {

            var SlbV = parseFloat(gRow.SlabTo) + 1;
            $scope.DynamicGridSlab.push({
                'TID': "",
                'SlabFrom':SlbV,
                'SlabTo':"",
                'CT20': "",
                'CT40': "",
                'HQCT': ""
            });

        }

        $scope.RemoveRent = function (DynamicGridSlab, index,TID,gRow) {
            var BussData = {}
             BussData.TID = TID;
             //alert(BussData.CID);
            var ff = $scope.DynamicGridSlab[index - 1].SlabTo;
            $scope.DynamicGridSlab[index + 1].SlabFrom = parseInt(ff) + 1;
            console.log($scope.DynamicGridSlab);
            $scope.DynamicGridSlab.splice(index, 1);


        }


        $scope.AddPortCost = function (gRow, index) {


            $scope.DynamicGridPortCost.push({
                'EID': "",
                'ChargeID': "",
                'CurrencyID': "",
                'PCT20': "",
                'PCT40': "",
                'PHQCT': ""
            });

        }

        $scope.RemovePortCost = function (DynamicGridSlab, index, EID, gRow) {
            var BussData = {}
            BussData.EID = EID;
            //alert(BussData.CID);
            var ff = $scope.DynamicGridPortCost[index - 1].SlabTo;
            $scope.DynamicGridPortCost[index + 1].SlabFrom = parseInt(ff) + 1;
            console.log($scope.DynamicGridSlab);
            $scope.DynamicGridPortCost.splice(index, 1);

        
        }
        // --VALIDATION Begin----//


        $scope.ExistingTariffValidation = function (data,data1) {


            var BussData = {}
            var Items = []
            var Items1 = []
            if ($scope.HdEYID == "")
                BussData.ID = 0;
            else
                BussData.ID = $scope.HdEYID;

            BussData.CountryID = $('#ddlCountry').val();
            BussData.GeoLocID = $('#ddlGeoLoc').val();
            BussData.EmptyYardID = $('#ddlEmptyYard').val();
            BussData.CostPerCurrID = $('#ddlCurr').val();
            BussData.CostPerManHr = $scope.txtCostManhr;
            BussData.FreeUnits = $scope.txtFreeUnits;
            BussData.UnitsPerID = $('#ddlFreeUnitsMonth').val();
            BussData.ValidFrom = $('#txtDtValidFrom').val();
            BussData.ValidTill = $('#txtDtValidTill').val();
            BussData.Status = $('#ddlStatus').val();
            BussData.UserID = localStorage.getItem("UserID");


            angular.forEach(data, function (value, key) {
                var intTID = data[key].TID;
                if (typeof data[key].TID == "undefined") {
                    intTID = 0;
                }

                Items.push('Insert:' + intTID, data[key].SlabFrom, data[key].SlabTo, data[key].CT20, data[key].CT40, data[key].HQCT);

            });
            angular.forEach(data1, function (value, key) {
                var intEID = data1[key].EID;
                if (typeof data1[key].EID == "undefined") {
                    intEID = 0;
                }

                Items1.push('Insert:' + intEID, data1[key].ChargeID.ID, data1[key].CurrencyID.ID, data1[key].PCT20, data1[key].PCT40, data1[key].PHQCT);

            });

            BussData.Itemsv1 = Items.toString();
            BussData.Itemsv2 = Items1.toString();
            $http({
                method: 'POST',
                url: "/api/SalesApi/EmptyYardTariffValidation",
                data: JSON.stringify(BussData),

            }).then(function (response) {
                $timeout(function () {


                    $scope.Result = response.data;

                    if (BussData.ID == "0" && $scope.Result.length >= "1") {

                        ShowPopup("Tariff Combination Already Exists");
                        return false;

                    }

                    else {


                        $http({
                            method: 'POST',
                            url: "/api/SalesApi/InsertEmptyYardCosts",
                            data: JSON.stringify(BussData),
                        }).then(function (result) {
                            $timeout(function () {
                                // $scope.HdEYID = result.data[0].ID;

                                if (result.data.length > 0) {
                                    $('#overlay').hide();
                                    ShowPopup("EmptyYard Costs Saved Successfully");
                                    var url = "/Sales/EmptyYardCntrCostView";
                                    window.setTimeout(window.location.href = url, 1000000);
                                }
                                else {
                                    $('#overlay').hide();
                                    ShowPopup("Error,Not Saved");
                                }
                                setTimeOut(function () {
                                    window.location = "/";
                                }, 3000);
                            });
                        }, function (result) {
                            if (result.status == 500) {
                                ShowPopup("Sorry no internet connectivity Application Error.");
                            }
                            else if (result.status == 404) {
                                ShowPopup("Sorry no internet connectivity page not found.");
                            }
                            if (result.status > 0) {
                                var errorMsg = result.status + ': ' + result.data;
                                ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                            }
                        }).catch(function (result) {

                            ShowPopup('There has been an error: ' + result);
                        });

                    }


                });
            }, function (response) {
                if (response.status > 0) {
                    var errorMsg = response.status + ': ' + response.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            });
        }

        // --VALIDATION end ----//


        $scope.EYSave = function (data,data1) {
          var validation = "";


            var ddlCountry = $('#ddlCountry').val();
            if (ddlCountry == "?") {
                validation += "<span style='color:red;'>*</span> <span>Please Select Country</span></br>"
            }
            var ddlGeoLoc = $('#ddlGeoLoc').val();
            if (ddlGeoLoc == "?") {
                validation += "<span style='color:red;'>*</span> <span>Please Select Geo-Location</span></br>"
          }
            var ddlEmptyYard = $('#ddlEmptyYard').val();
            if (ddlEmptyYard == "?") {
                validation += "<span style='color:red;'>*</span> <span>Please Select Empty Yard</span></br>"
          }
            var ddlCurr = $('#ddlCurr').val();
            if (ddlCurr == "?") {
                validation += "<span style='color:red;'>*</span> <span>Please Select CostManHr Currency</span></br>"
          }
            var txtCostManhr = $('#txtCostManhr').val();
            if (txtCostManhr.length == 0) {
                validation += "<span style='color:red;'>*</span> <span>Please Enter CostMan Hr</span></br>"
            }
           
            var txtDtValidFrom = $('#txtDtValidFrom').val();
            if (txtDtValidFrom.length == 0) {
                validation += "<span style='color:red;'>*</span> <span>Please Enter Valid From Date</span></br>"
            }
            var txtDtValidTill = $('#txtDtValidTill').val();
            if (txtDtValidTill.length == 0) {
                validation += "<span style='color:red;'>*</span> <span>Please Enter Valid Till Date</span></br>"
            }
            var ddlStatus = $('#ddlStatus').val();
            if (ddlStatus == "?") {
                validation += "<span style='color:red;'>*</span> <span>Please Select Status</span></br>"
            }
            var slabfromV = "";
            var slabtoV = "";
            var ct20v = "";
            var ct40v = "";
            var ctHQv = "";
            angular.forEach(data, function (value, key) {
       
                slabfromV = data[key].SlabFrom;
                slabtoV = data[key].SlabTo;
                ct20v = data[key].CT20;
                ct40v = data[key].CT40;
                ctHQv = data[key].HQCT;
         
                if (slabfromV == "") {
                    validation += "<span style='color:red;'>*</span> <span>Please Enter SlabFrom</span></br> "
                    }
                if (slabtoV == "") {
                    validation += "<span style='color:red;'>*</span> <span>Please Enter SlabTo</span></br> "
                }
                if (ct20v == "") {
                    validation += "<span style='color:red;'>*</span> <span>Please Enter Slab 20'</span></br> "
                }
                if (ct40v == "") {
                    validation += "<span style='color:red;'>*</span> <span>Please Enter Slab 40'</span></br> "
                }
                if (ctHQv == "") {
                    validation += "<span style='color:red;'>*</span> <span>Please Enter Slab HQ'</span></br> "
                }
                
            });

            var ChargeIDv = "";
            var CurrIDv = "";
            var Pct20v = "";
            var Pct40v = "";
            var PctHQv = "";

            angular.forEach(data1, function (value, key) {

                ChargeIDv = data1[key].ChargeID;
                CurrIDv = data1[key].CurrencyID;
                Pct20v = data1[key].PCT20;
                Pct40v = data1[key].PCT40;
                PctHQv = data1[key].PHQCT;

                if (ChargeIDv == "") {
                    validation += "<span style='color:red;'>*</span> <span>Please Select Charges</span></br> "
                }
                if (CurrIDv == "") {
                    validation += "<span style='color:red;'>*</span> <span>Please Select Currency</span></br> "
                }
                if (Pct20v == "") {
                    validation += "<span style='color:red;'>*</span> <span>Please Enter Cost 20'</span></br> "
                }
                if (Pct40v == "") {
                    validation += "<span style='color:red;'>*</span> <span>Please Enter Cost 40'</span></br> "
                }
                if (PctHQv == "") {
                    validation += "<span style='color:red;'>*</span> <span>Please Enter Cost HQ'</span></br> "
                }

            });

            if (validation != "") {
                ShowPopup(validation);
                return false;
            }

            $('#overlay').fadeIn().delay(100).fadeOut();
            ///---- save function in ----//

            $scope.ExistingTariffValidation(data,data1);

            ///---- save function in ----//

        }


        $(document).ready(function () {

            var queryString = new Array();
            if (window.location.search.split('?').length > 1) {
                var secret_key = CryptoJS.enc.Utf8.parse(localStorage.getItem("SessionKey"));
                var iv = CryptoJS.enc.Utf8.parse(localStorage.getItem("Sessioniv"));
                var bytes = CryptoJS.AES.decrypt(window.location.search.split('?')[1].toString(), secret_key, {
                    iv: iv,
                    mode: CryptoJS.mode.CBC,
                    padding: CryptoJS.pad.Pkcs7
                });

                var params = bytes.toString(CryptoJS.enc.Utf8).split('&');
                //alert(params);
                for (var i = 0; i < params.length; i++) {
                    var key = params[i].split('=')[0];
                    var value = decodeURIComponent(params[i].split('=')[1]);
                    queryString[key] = value;

                }
            }
            if (queryString["EYTariffID"] != null)
              {
                $scope.HdEYID = queryString["EYTariffID"].toString();
                $scope.BindEmptyYard(queryString["EYTariffID"].toString());
                $scope.BindEmptyYardSlab(queryString["EYTariffID"].toString());
                $scope.BindEmptyYardPortCost(queryString["EYTariffID"].toString());
            }
         });

    
        $scope.BindEmptyYard = function (EYTariffID) {

                var Datavalue = {};
            var id = EYTariffID;
                if (id == "" || id == null)
                Datavalue.ID = 0;
            else
                    Datavalue.ID = EYTariffID;


                $http({
                    method: 'POST',
                    url: '/api/SalesApi/EmptyYardTariffEdit/',
                    data: JSON.stringify(Datavalue),
                }).then(function (result) {
                    $timeout(function () {

                        if (result.data.length >0) {
                            $scope.ddlCountry = { CountryID: result.data[0].CountryID };
                            $scope.ExistGeoLocBind(result.data[0].CountryID);
                            $scope.ddlGeoLoc = { ID: result.data[0].GeoLocID };
                            $scope.ExistEmptyYardBind(result.data[0].GeoLocID);
                            $scope.ddlEmptyYard = { ID: result.data[0].EmptyYardID };
                            $scope.txtCostManhr = result.data[0].CostPerManHr;
                            $scope.ddlCurr = { ID: result.data[0].CostPerCurrID };
                            $scope.txtFreeUnits = result.data[0].FreeUnits;

                            $scope.ddlFreeUnitsMonth = { ID: result.data[0].UnitsPerID };

                            document.getElementById("txtDtValidFrom").value = result.data[0].ValidFrom;
                         
                            document.getElementById("txtDtValidTill").value = result.data[0].ValidTill;
                        
                            $scope.ddlStatus = { ID: result.data[0].Status };
                        }
                       

                    });
                    }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
                });


            }

        $scope.BindEmptyYardSlab = function (EYTariffID) {

            var BussData = {}

            BussData.ID = EYTariffID;


            $http({
                method: 'POST',
                url: "/api/SalesApi/EmptyYardTariffSlabEdit",
                data: JSON.stringify(BussData),
            }).then(function (result)
            {

                $timeout(function () {


                    if (result.data.length > 0) {

                        if (result.data[0].TID != "") {
                            $scope.DynamicGridSlab.splice(0, 1);
                        }

                        angular.forEach(result.data, function (value, key) {

                            $scope.DynamicGridSlab.push({
                                'TID': result.data[key].TID,
                                'SlabFrom': result.data[key].SlabFrom,
                                'SlabTo': result.data[key].SlabTo,
                                'CT20': result.data[key].CT20,
                                'CT40': result.data[key].CT40,
                                'HQCT': result.data[key].HQCT,
                            });

                        });
                    }
                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            });

        }

        $scope.BindEmptyYardPortCost = function (EYTariffID) {

            var BussData = {}

            BussData.ID = EYTariffID;


            $http({
                method: 'POST',
                url: "/api/SalesApi/EmptyYardTariffPortCostEdit",
                data: JSON.stringify(BussData),
            }).then(function (result) {

                $timeout(function () {


                    if (result.data.length > 0) {

                        if (result.data[0].ChargeID != "") {
                            $scope.DynamicGridPortCost.splice(0, 1);
                        }

                        angular.forEach(result.data, function (value, key) {

                            $scope.DynamicGridPortCost.push({
                                'EID': result.data[key].EID,
                                'ChargeID': { ID: result.data[key].ChargeID },
                                'CurrencyID': { ID: result.data[key].CurrencyID },
                                'SlabTo': result.data[key].SlabTo,
                                'PCT20': result.data[key].PCT20,
                                'PCT40': result.data[key].PCT40,
                                'PHQCT': result.data[key].PHQCT,
                            });

                        });
                    }
                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            });

        }
        $scope.ClickCopyTraiff = function () {

            $scope.HdEYID = 0;
            ShowPopup('Copy Tariff successfully');
        }
    });

    function ShowPopup(message) {
        swal(message);
    };

</script>

<div ng-app="MyApp" ng-controller="MyController">

    <div id="overlay" style="display:none;">
        <div class="loadcontainer">
            <div class="spinner"></div>
            <p>Loading Please Wait</p>
        </div>
    </div>
    <div class="container-fluid">
        @*<div class="row">
            <div class="col-md-12 backbtn" style="text-align:right;">
                <a href="/Sales/EmptyYardCntrCostView" type="submit" class="btn btn-fill btn-success btn-round btntop">
                    <i class="material-icons">reply</i> Back

                </a>

            </div>
        </div>*@
        <div class="row">
            <div class="col-md-12">
                <div class="card ">
                    <div class="card-header card-header-primary card-header-text">

                        <div class="card-text">
                            <h4 class="card-title">Empty Yard Container Cost</h4>
                        </div>
                        <div class="row">
                            <div class="col-md-12 download" style="text-align:right;">
                                <button type="submit" id="btnCopyTraiff" ng-click="ClickCopyTraiff();" class="btn btn-fill btn-success">
                                    <i class="material-icons">
                                        content_copy
                                    </i>
                                    Copy Tariff
                                </button>

                            </div>
                            <div>

                            </div>
                        </div>

                    </div>
                    <div class="card-body ">
                        <div class="row">

                            <div class="col-md-3">
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <label>Country <span style="color:red; font-size:20px;">*</span></label>
                                            <select class="form-control my-select" ng-model="ddlCountry" id="ddlCountry" ng-options="item.CountryName for item in Countrylist track by item.CountryID" required></select>

                                        </div>

                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <label>Geo-Location<span style="color:red; font-size:20px;">*</span></label>
                                            <select class="form-control my-select" ng-model="ddlGeoLoc" id="ddlGeoLoc" ng-options="item.GeoLocations for item in GeoLocationListByCtry track by item.ID" required>
                                            </select>

                                        </div>

                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <label>Empty Yard<span style="color:red; font-size:20px;">*</span></label>
                                            <select class="form-control my-select" ng-model="ddlEmptyYard" id="ddlEmptyYard" ng-options="item.Depot for item in DepotValue track by item.ID" required>
                                            </select>

                                        </div>

                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <label>Cost / Man Hr in<span style="color:red; font-size:20px;">*</span> </label>
                                            <select class="form-control my-select" ng-model="ddlCurr" id="ddlCurr" ng-options="item.Currency for item in CurrencyValue track by item.ID" required>
                                            </select>
                                        </div>

                                    </div>
                                </div>
                            </div>

                            <div class="col-md-3">
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <label>Cost / Man Hr<span style="color:red; font-size:20px;">*</span> </label>
                                            <input type="text" id="txtCostManhr" autocomplete="off" ng-model="txtCostManhr" class="form-control">
                                        </div>

                                    </div>
                                </div>
                            </div>


                            <div class="col-md-3">
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <label>Valid From <span style="color:red; font-size:20px;">*</span> </label>

                                            <input type="date" id="txtDtValidFrom" autocomplete="off" ng-model="txtDtValidFrom" class="form-control">

                                        </div>

                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <label>Valid Till <span style="color:red; font-size:20px;">*</span> </label>

                                            <input type="date" id="txtDtValidTill" autocomplete="off" ng-model="txtDtValidTill" class="form-control">

                                        </div>

                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <label>Status<span style="color:red; font-size:20px;">*</span> </label>
                                            <select class="form-control my-select" id="ddlStatus" ng-model="ddlStatus" options="{ allowClear: true }" ng-options="item.name for item in StatusBindValues track by item.ID">
                                            </select>

                                        </div>

                                    </div>
                                </div>
                            </div>

                            <div class="col-md-3">
                                <div class="form-group">
                                    <div class="row">

                                        <div class="col-md-12">
                                            <label>	Free units / Month</label>
                                            <div class="row">

                                                <div class="col-md-6 padr6">
                                                    <input type="text" id="txtFreeUnits" autocomplete="off" ng-model="txtFreeUnits" class="form-control">
                                                </div>
                                                <div class="col-md-6 padl0">
                                                    <select class="form-control my-select" ng-model="ddlFreeUnitsMonth" id="ddlFreeUnitsMonth" ng-options="item.Name for item in FreeUnitsList track by item.ID" required>
                                                    </select>
                                                </div>
                                            </div>


                                        </div>

                                    </div>
                                </div>
                            </div>


                        </div>


                        <div class="col-md-12">
                            <h5 style="text-decoration: underline;" class="cardtitle">Storage Charges Slab</h5>
                           
                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <div class="material-datatables">



                                    <table class="table table-striped table-no-bordered table-hover" cellspacing="0" width="100%" style="width:100%">
                                        <thead>
                                            <tr>
                                                <th>S.No</th>
                                                <th>Slab From</th>
                                                <th>Slab To</th>
                                                <th>20'</th>
                                                <th>40'</th>
                                                <th>HQ'</th>
                                                <th class="disabled-sorting text-right actwid">Actions</th>
                                            </tr>
                                        </thead>

                                        <tbody>
                                            <tr ng-repeat="gRow in DynamicGridSlab">
                                                <td>{{$index+1}}</td>

                                                <td>
                                                    <input type="text" id="txtSlabFrom" class="form-control" ng-model="gRow.SlabFrom" />
                                                </td>

                                                <td>
                                                    <input type="text" id="txtSlabTo" class="form-control" ng-model="gRow.SlabTo" />
                                                </td>
                                                <td><input type="text" id="txtCT20" class="form-control" ng-model="gRow.CT20" /></td>
                                                <td><input type="text" id="txtCT40" class="form-control" ng-model="gRow.CT40" /></td>
                                                <td><input type="text" id="txtHQCT" class="form-control" ng-model="gRow.HQCT" /></td>
                                                <td style="display:none;"><input type="hidden" id="HDID" class="form-control" ng-model="gRow.TID" /></td>



                                                <td class="td-actions text-right actwid">
                                                    <button type="button" rel="tooltip" ng-if="$last" ng-click="Add(gRow,$index)" class="btn btn-primary btn-round" data-original-title="" title="">
                                                        <i class="material-icons">add</i>
                                                    </button>
                                                    <button type="button" rel="tooltip" ng-if="!$last" ng-click="RemoveRent(DynamicGrid,$index,gRow.TID,gRow)" class="btn btn-danger btn-round" data-original-title="" title="">
                                                        <i class="material-icons">delete</i>
                                                    </button>
                                                    <input type="hidden" ng-model="HdTID" id="HdTID" />
                                                </td>
                                            </tr>

                                        </tbody>
                                    </table>

                                </div>
                            </div>
                        </div>

                        <div class="col-md-12" >
                           
                            <h5 style="text-decoration: underline;" class="cardtitle">Port Cost</h5>

                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <div class="material-datatables">



                                    <table class="table table-striped table-no-bordered table-hover" cellspacing="0" width="100%" style="width:100%">
                                        <thead>
                                            <tr>
                                                <th>S.No</th>
                                                <th>Cost Head</th>
                                                <th>Currency</th>
                                                <th>20'</th>
                                                <th>40'</th>
                                                <th>HQ'</th>
                                                <th class="disabled-sorting text-right actwid">Actions</th>
                                            </tr>
                                        </thead>

                                        <tbody>
                                            <tr ng-repeat="i in DynamicGridPortCost">
                                                <td>{{$index+1}}</td>

                                                <td>
                                                    <select class="form-control" ng-model="i.ChargeID" id="ddlCharges" ng-options="item.ChargeCode for item in ChargeCodeAllvalues track by item.ID">   </select>
                                                </td>

                                                <td>
                                                    <select class="form-control" ng-model="i.CurrencyID" id="ddlCurrency" ng-options="item.Currency for item in CurrencyValue track by item.ID">
                                                    </select>
                                                </td>
                                                <td><input type="text" id="txtPCT20" class="form-control amtrgt" ng-model="i.PCT20" /></td>
                                                <td><input type="text" id="txtPCT40" class="form-control amtrgt" ng-model="i.PCT40" /></td>
                                                <td><input type="text" id="txtPHQCT" class="form-control amtrgt" ng-model="i.PHQCT" /></td>
                                                <td style="display:none;"><input type="hidden" id="HDID" class="form-control" ng-model="i.EID" /></td>



                                                <td class="td-actions text-right actwid">
                                                    <button type="button" rel="tooltip" ng-if="$last" ng-click="AddPortCost(i,$index)" class="btn btn-primary btn-round" data-original-title="" title="">
                                                        <i class="material-icons">add</i>
                                                    </button>
                                                    <button type="button" rel="tooltip" ng-if="!$last" ng-click="RemovePortCost(DynamicGridPortCost,$index,i.EID,gRow)" class="btn btn-danger btn-round" data-original-title="" title="">
                                                        <i class="material-icons">delete</i>
                                                    </button>
                                                    <input type="hidden" ng-model="HdEID" id="HdEID" />
                                                </td>
                                            </tr>

                                        </tbody>
                                    </table>

                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="ml-auto">
                                <button type="submit" class="btn btn-fill btn-success" ng-click="EYSave(DynamicGridSlab,DynamicGridPortCost);">
                                    <i class="material-icons">save</i>
                                    Save
                                </button>
                              
                                <input type="hidden" id="HdEYID" ng-model="HdEYID" />
                            </div>
                            <div class="clearfix"></div>
                        </div>
                    </div>

                </div>

            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        // initialise Datetimepicker and Sliders
        $('.datepicker').datetimepicker({
            format: 'DD/MM/YYYY',

        });
    });
</script>

