@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.full.min.js"></script>
<script type="text/javascript">

    LayoutApp.controller('MyController', function ($scope, $http, $timeout) {

        $scope.TextBoxDisabled = true;
        $('#overlay').fadeIn().delay(300).fadeOut();
        $scope.HDArrayIndex = "";
        $(document).ready(function () {
            $('.my-select').select2({
                placeholder: "--Select--",
                allowClear: true,
                width: '100%'
            });
        });
        $scope.BLNumbers = null;
        $scope.fillBLNumber = function () {

            $http({
                method: 'POST',
                url: '/api/DocumentApi/BOLBLNoVlaue/',
                data: {}
            }).then(function (result) {
                $timeout(function () {

                    $scope.BLNumbers = result.data;

                });
            });
        };
        $scope.fillBLNumber();


        $scope.CurrencyValue = null;
        $scope.fillCurrencyValues = function () {
            $http({
                method: 'POST',
                url: '/api/CommonAccessApi/CurrencyValues/',
                data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.CurrencyValue = result.data;

                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        };
        $scope.fillCurrencyValues();


        $scope.CollectionModeAllValues = null;
        $scope.fillCollectionModeAllValues = function () {
            var Datavalue = {};
            Datavalue.ID = "9"; //GeneralMaster Table seqNo
            $http({
                method: 'POST',
                url: '/api/CommonAccessApi/ModuleValues/',
                data: JSON.stringify(Datavalue)
            }).then(function (result) {
                $timeout(function () {
                    $scope.CollectionModeAllValues = result.data;

                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        };
        $scope.fillCollectionModeAllValues();

        $scope.BLChargesModeAllValues = null;
        $scope.fillBLChargesModeAllValues = function () {
            var Datavalue = {};
            Datavalue.ID = "40"; //GeneralMaster Table seqNo
            $http({
                method: 'POST',
                url: '/api/CommonAccessApi/ModuleValues/',
                data: JSON.stringify(Datavalue)
            }).then(function (result) {
                $timeout(function () {
                    $scope.BLChargesModeAllValues = result.data;

                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        };
        $scope.fillBLChargesModeAllValues();


        $scope.ChageOwnerAllValues = null;
        $scope.fillChageOwnerAllValues = function () {
            var Datavalue = {};
            Datavalue.ID = "11"; //GeneralMaster Table seqNo
            $http({
                method: 'POST',
                url: '/api/CommonAccessApi/ModuleValues/',
                data: JSON.stringify(Datavalue)
            }).then(function (result) {
                $timeout(function () {
                    $scope.ChageOwnerAllValues = result.data;

                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        };
        $scope.fillChageOwnerAllValues();


        $scope.CntrTypesvalues = null;
        $scope.fillCntrTypeValues = function () {
            $http({
                method: 'POST',
                url: '/api/CommonAccessApi/CntrTypeValues/',
                data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.CntrTypesvalues = result.data;

                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        };
        $scope.fillCntrTypeValues();

        $scope.ChargeCodeAllvalues = null;
        $scope.fillChargecodeValues = function () {
            $http({
                method: 'POST',
                url: '/api/CommonAccessApi/ChargeCode/',
                data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.ChargeCodeAllvalues = result.data;

                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        };
        $scope.fillChargecodeValues();

        $("#ddlBLNumber").change(function () {
            $("#overlay").show();
            var BussData = {}
            BussData.BLID = $("#ddlBLNumber").val();
            $http({
                method: 'POST',
                url: "/api/DocumentApi/PrincipalChargeCorrector",
                data: JSON.stringify(BussData),
            }).then(function (result) {
                if (result.data.length > 0) {
                    $scope.PrincipalChargeCodeRec = result.data;
                    $scope.disableShow = true;

                    $("#overlay").hide();
                }
                else {
                    $("#overlay").hide();
                }
            });

            $http({
                method: 'POST',
                url: "/api/DocumentApi/BkgIDGetvalue",
                data: JSON.stringify(BussData),
            }).then(function (result) {
                $scope.HDBKgID = result.data[0].BKgID;
            });
        });


        $scope.PrincipalEdit = function (gRow) {


            $scope.QtyEnableView = true;
            $scope.HDArrayIndex = gRow.RID;
            $scope.ddlCntrType = { ID: gRow.CntrType };
            $scope.txtQty = gRow.Qty;
            $scope.ddlChargeCode = { ID: gRow.ChargeCodeID };
            $scope.ddlCurrency = { ID: gRow.CurrencyID };
            $scope.ddlCurrencyUpdate = { ID: gRow.CurrencyID };
            $scope.ddlCollectionModeEdit = { ID: gRow.PaymentModeID };
            $scope.ddlCollectionMode = { ID: gRow.PaymentModeID };
            $scope.txtManifestRate = gRow.ManifRate;
            $scope.txtManifestRateEdit = gRow.ManifRate;
            $scope.txtCustomerRate = gRow.CustomerRate;
            $scope.txtCustomerRateEdit = gRow.CustomerRate;
            $scope.ddlChargeOwnerEdit = { ID: gRow.OwnershipID };
            $scope.ddlChargeOwner = { ID: gRow.OwnershipID };
            $scope.txtBillingAmt = gRow.BillAmount;
            $scope.ddlChargeType = { ID: gRow.TariffTypeID };
            $scope.ddlChargeTypeEdit = { ID: gRow.TariffTypeID };



        }
        $scope.PrincipalChargeCodeEdit = [{
            CorrectionTypes: "", RID: "",
            CntrTypes: "", Qty: "", ChargeCode: "", Currency: "", CurrencyID: "", NewCurrency: "", NewCurrencyID: "", PaymentMode: "", ManifRate: "", NewManifRate: "",
            CustomerRate: "", NewCustomerRate: "", PaymentModeID: "", OwnershipID: "", Ownership: "", BillAmount: "", CntrType: "", ChargeCodeID: "", TariffType: "", TariffTypeID: "", NewTariffType: "", NewTariffTypeID: ""
        }];
        $scope.PrincipalChargeCodeEdit.splice(0, 1);


        $scope.UpdateDetails = function () {

            var val = {
                'CorrectionTypes': 'Update',
                'RID': $scope.HDArrayIndex,
                'TariffType': $("#ddlChargeType option:selected").text(),
                'TariffTypeID': $("#ddlChargeType").val(),
                'NewTariffType': $("#ddlChargeTypeEdit option:selected").text(),
                'NewTariffTypeID': $("#ddlChargeTypeEdit").val(),

                'CntrTypes': $("#ddlCntrType option:selected").text(),
                'CntrType': $("#ddlCntrType").val(),
                'Qty': $scope.txtQty,
                'ChargeCode': $("#ddlChargeCode option:selected").text(),
                'ChargeCodeID': $("#ddlChargeCode").val(),
                'Currency': $("#ddlCurrency option:selected").text(),
                'CurrencyID': $("#ddlCurrency").val(),
                'NewCurrency': $("#ddlCurrencyUpdate option:selected").text(),
                'NewCurrencyID': $("#ddlCurrencyUpdate").val(),
                'PaymentMode': $("#ddlCollectionMode option:selected").text(),
                'PaymentModeID': $("#ddlCollectionMode").val(),
                'NewPaymentMode': $("#ddlCollectionModeEdit option:selected").text(),
                'NewPaymentModeID': $("#ddlCollectionModeEdit").val(),
                'ManifRate': $scope.txtManifestRate,
                'NewManifRate': $scope.txtManifestRateEdit,
                'CustomerRate': $scope.txtCustomerRate,
                'NewCustomerRate': $scope.txtCustomerRateEdit,
                'OwnershipID': $("#ddlChargeOwner").val(),
                'Ownership': $("#ddlChargeOwner option:selected").text(),
                'BillAmount': $scope.txtBillingAmt,
                'TariffTypeID': $("#ddlChargeType").val(),
                'TariffType': $("#ddlChargeType option:selected").text(),
                'NewTariffTypeID': $("#ddlChargeTypeEdit").val(),
                'NewTariffType': $("#ddlChargeTypeEdit option:selected").text(),
            }

            $scope.PrincipalChargeCodeEdit.push(val);
            console.log($scope.PrincipalChargeCodeEdit);

            $("#ddlChargeType").val("");
            $("#ddlChargeTypeEdit").val("");
            $("#ddlCntrType").val("");
            $("#ddlChargeCode").val(null);
            $("#ddlCurrency").val("");
            $("#ddlCurrencyUpdate").val("");
            $("#ddlCollectionMode").val("");
            $("#ddlCollectionModeEdit").val("");
            $("#ddlChargeOwner").val("");
            $("#ddlChargeOwnerEdit").val("");
            $("#ddlChargeType").val("");
            $("#ddlChargeTypeEdit").val("");

            $scope.txtManifestRate = "";
            $scope.txtManifestRateEdit = "";
            $scope.txtCustomerRate = "";
            $scope.txtCustomerRateEdit = "";
            $scope.txtBillingAmt = "";
            $scope.txtQty = "";
            $scope.HDArrayIndex = 0;


        }

        $scope.RecordSave = function (Data) {

            console.log(Data);
            var validation = "";
            var ddlBLNumber = $('#ddlBLNumber').val();
            if (ddlBLNumber == "?") {
                validation += "<span style='color:red;'>*</span> <span>Please Select BLNumber</span></br>"
            }
            if (validation != "") {
                ShowPopup(validation);
                return false;
            }
            $("#overlay").show();
            var BussData = {}
            var Items = []

            BussData.BLID = $("#ddlBLNumber").val();
            BussData.BLNumber = $("#ddlBLNumber option:selected").text();
            BussData.CorrectionNo = $("#ddlBLNumber option:selected").text();
            BussData.Status = 1;
            BussData.BkgID = $scope.HDBKgID;
            BussData.AgencyID = localStorage.getItem("AgencyID");
            var RRIDv
          
            angular.forEach(Data, function (value, key) {

                Items.push('Insert:' + Data[key].RID,
                    Data[key].CntrType,
                    Data[key].ChargeCodeID,
                    Data[key].CurrencyID,
                    Data[key].NewCurrencyID,
                    Data[key].PaymentModeID,
                    Data[key].NewPaymentModeID,
                    Data[key].ManifRate,
                    Data[key].NewManifRate,
                    Data[key].CustomerRate,
                    Data[key].NewCustomerRate,
                    Data[key].BillAmount,
                    Data[key].Qty,
                    Data[key].OwnershipID,
                    Data[key].TariffTypeID,
                    Data[key].NewTariffTypeID,
                    Data[key].CorrectionTypes
                );
            });
            BussData.Itemsv = Items.toString();

            $http({
                method: 'POST',
                url: "/api/DocumentApi/ChargeCorrectorInsert/",
                data: JSON.stringify(BussData),
            }).then(function (result) {
                if (result.data.length > 0) {
                    ShowPopup(result.data[0].AlertMessage);
                    $("#overlay").hide();
                    setTimeout(function () { location.href = "/Document/BLChargeCorrectorSearch" }, 3000);
                    return false;
                }
                else {
                    $("#overlay").hide();
                }
            });
        }

        $(document).ready(function () {

            var queryString = new Array();
            if (window.location.search.split('?').length > 1) {
                var params = window.location.search.split('?')[1].split('&');
                for (var i = 0; i < params.length; i++) {
                    var key = params[i].split('=')[0];
                    var value = decodeURIComponent(params[i].split('=')[1]);
                    queryString[key] = value;
                }
            }
            if (queryString["CMRegID"] != null) {

                $scope.HDID = queryString["CMRegID"].toString();
                $scope.fillCorrectionExistingValue($scope.HDID);
                $scope.BLExistingCorrectionCharge($scope.HDID);
                $("#overlay").hide();
            }
        });

        $scope.fillCorrectionExistingValue = function (cmID) {

            var Datavalue = {};
            Datavalue.CMID = cmID;
            $http({
                method: 'POST',
                url: '/api/DocumentApi/CorrectionExsitingValues',
                data: JSON.stringify(Datavalue),

            }).then(function (result) {
                $timeout(function () {
                    $scope.ddlBLNumber = { ID: result.data[0].BLID };
                    $scope.BindCorrectionNo = result.data[0].CorrectionNo;
                    if (result.data[0].Status == "2") {
                        document.getElementById("btnSave").disabled = true;
                        document.getElementById("btnSave").style.cursor = 'not-allowed';
                        document.getElementById("btnReject").disabled = true;
                        document.getElementById("btnReject").style.cursor = 'not-allowed';
                        document.getElementById("btnApproval").disabled = true;
                        document.getElementById("btnApproval").style.cursor = 'not-allowed';
                        $scope.disableShow = false;
                        document.getElementById("AddChargeDetails").disabled = true;
                        document.getElementById("AddChargeDetails").style.cursor = 'not-allowed';
                        document.getElementById("UpdateDetails").disabled = true;
                        document.getElementById("UpdateDetails").style.cursor = 'not-allowed';

                    }
                    else {

                        document.getElementById("btnSave").disabled = false;
                        document.getElementById("btnSave").style.cursor = 'allowed';
                        document.getElementById("btnReject").disabled = false;
                        document.getElementById("btnReject").style.cursor = 'allowed';
                        document.getElementById("btnApproval").disabled = false;
                        document.getElementById("btnApproval").style.cursor = 'allowed';
                        document.getElementById("AddChargeDetails").disabled = false;
                        document.getElementById("AddChargeDetails").style.cursor = 'allowed';
                        document.getElementById("UpdateDetails").disabled = false;
                        document.getElementById("UpdateDetails").style.cursor = 'allowed';
                        $scope.disableShow = true;
                    }
                    //$scope
                    $scope.BLExistingCharge(result.data[0].BLID);

                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            });

        }

        $scope.BLExistingCharge = function (BLIDv) {


            var BussData = {}
            BussData.BLID = BLIDv;
            $http({
                method: 'POST',
                url: "/api/DocumentApi/PrincipalChargeCorrector",
                data: JSON.stringify(BussData),
            }).then(function (result) {

                $scope.PrincipalChargeCodeRec = result.data;
            });
        }
        $scope.BLExistingCorrectionCharge = function (CMIDv) {
            var BussData = {}
            BussData.CMID = CMIDv;
            $http({
                method: 'POST',
                url: "/api/DocumentApi/BLCorrectionExsitingChargeValues",
                data: JSON.stringify(BussData),
            }).then(function (result) {

                $scope.PrincipalChargeCodeEdit = result.data;
            });
        }

        $scope.onclickTextBox = function () {

            $scope.txtBillingAmt = parseFloat($scope.txtCustomerRateEdit) * parseFloat($scope.txtQty);
        }

        $scope.AddNew = function () {

            window.location = "/Document/BLChargeCorrector"
        }

        $scope.back = function () {

            window.location = "/Document/BLChargeCorrectorSearch"
        }

        $scope.BLChargeApproval = function () {
            var BussData = {}
            BussData.CID = $scope.HDID;
            BussData.BLID = $("#ddlBLNumber").val();
            $http({
                method: 'POST',
                url: "/api/DocumentApi/BLCorrectionApproval",
                data: JSON.stringify(BussData),
            }).then(function (result) {
                $timeout(function () {
                    if (result.data.length > 0) {
                        document.getElementById("btnSave").disabled = true;
                        document.getElementById("btnSave").style.cursor = 'not-allowed';
                        document.getElementById("btnReject").disabled = true;
                        document.getElementById("btnReject").style.cursor = 'not-allowed';
                        document.getElementById("btnApproval").disabled = true;
                        document.getElementById("btnApproval").style.cursor = 'not-allowed';

                        $scope.disableShow = false;
                        $scope.disableShow = false;

                        document.getElementById("AddChargeDetails").disabled = true;
                        document.getElementById("AddChargeDetails").style.cursor = 'not-allowed';
                        document.getElementById("UpdateDetails").disabled = true;
                        document.getElementById("UpdateDetails").style.cursor = 'not-allowed';
                        ShowPopup(result.data[0].AlertMessage);


                    }

                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            });

        }

        $scope.btnDleteCorrection = function (gRow) {

            var BussData = {}
            BussData.ID = gRow;
            $http({
                method: 'POST',
                url: '/api/DocumentAPi/BLChargeCorrcetiorDelete/',
                data: JSON.stringify(BussData),
            }).then(function (result) {
                if (result.data.length > 0) {
                    $scope.BLExistingCorrectionCharge($scope.HDID);
                    ShowPopup(result.data[0].AlertMessage);
                }
            });
        }


        $scope.BLChargeReject = function () {
            var BussData = {}
            BussData.BLID = $("#ddlBLNumber").val();
            $http({
                method: 'POST',
                url: "/api/DocumentApi/BLCorrectionReject",
                data: JSON.stringify(BussData),
            }).then(function (result) {
                $timeout(function () {
                    if (result.data.length > 0) {
                        document.getElementById("btnSave").disabled = true;
                        document.getElementById("btnSave").style.cursor = 'not-allowed';
                        document.getElementById("btnReject").disabled = true;
                        document.getElementById("btnReject").style.cursor = 'not-allowed';
                        document.getElementById("btnApproval").disabled = true;
                        document.getElementById("btnApproval").style.cursor = 'not-allowed';
                        $scope.disableShow = false;
                        document.getElementById("AddChargeDetails").disabled = true;
                        document.getElementById("AddChargeDetails").style.cursor = 'not-allowed';
                        document.getElementById("UpdateDetails").disabled = true;
                        document.getElementById("UpdateDetails").style.cursor = 'not-allowed';
                        ShowPopup(result.data[0].AlertMessage);
                    }

                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            });

        }

        $scope.addChargeDetails = function () {

            var val = {
                'CorrectionTypes': 'Insert',
                'RID': 0,
                'TariffType': $("#ddlChargeType option:selected").text(),
                'TariffTypeID': $("#ddlChargeType").val(),
                'NewTariffType': $("#ddlChargeTypeEdit option:selected").text(),
                'NewTariffTypeID': $("#ddlChargeTypeEdit").val(),
                'CntrTypes': $("#ddlCntrType option:selected").text(),
                'CntrType': $("#ddlCntrType").val(),
                'Qty': $scope.txtQty,
                'ChargeCode': $("#ddlChargeCode option:selected").text(),
                'ChargeCodeID': $("#ddlChargeCode").val(),
                'Currency': $("#ddlCurrencyUpdate option:selected").text(),
                'CurrencyID': $("#ddlCurrencyUpdate").val(),
                'NewCurrency': $("#ddlCurrencyUpdate option:selected").text(),
                'NewCurrencyID': $("#ddlCurrencyUpdate").val(),
                'PaymentMode': $("#ddlCollectionModeEdit option:selected").text(),
                'PaymentModeID': $("#ddlCollectionModeEdit").val(),
                'NewPaymentMode': $("#ddlCollectionModeEdit option:selected").text(),
                'NewPaymentModeID': $("#ddlCollectionModeEdit").val(),
                'ManifRate': $scope.txtManifestRate,
                'NewManifRate': $scope.txtManifestRateEdit,
                'CustomerRate': $scope.txtCustomerRate,
                'NewCustomerRate': $scope.txtCustomerRateEdit,
                'OwnershipID': $("#ddlChargeOwnerEdit").val(),
                'Ownership': $("#ddlChargeOwnerEdit option:selected").text(),
                'BillAmount': $scope.txtBillingAmt,
            }

            $scope.PrincipalChargeCodeEdit.push(val);

            $("#ddlChargeType").val("");
            $("#ddlChargeTypeEdit").val("");
            $("#ddlCntrType").val("");
            $("#ddlChargeCode").val(null);
            $("#ddlCurrency").val("");
            $("#ddlCurrencyUpdate").val("");
            $("#ddlCollectionMode").val("");
            $("#ddlCollectionModeEdit").val("");
            $("#ddlChargeOwner").val("");
            $("#ddlChargeOwnerEdit").val("");
            $scope.txtManifestRate = "";
            $scope.txtManifestRateEdit = "";
            $scope.txtCustomerRate = "";
            $scope.txtCustomerRateEdit = "";
            $scope.txtBillingAmt = "";
            $scope.txtQty = "";
            $scope.HDArrayIndex = 0;




        }
        $scope.SelectBreakupView = function (ChargeID) {
            var BussData = {}
            BussData.BLID = $("#ddlBLNumber").val();
            BussData.ChargeCodeID = $("#ddlChargeCode").val();


            $http({
                method: 'POST',
                url: "/api/DocumentApi/AgencyChargeCorrectorBrackup",
                data: JSON.stringify(BussData),
            }).then(function (result) {
                $scope.DynamicGridBrackup = result.data;

            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            });
            $('#demoModalView').modal('show');
        }

        $scope.OnclickDetailUpdate = function (Data) {

            $("#overlay").show();
            var BussData = {};
            var Items = [];
            var AmountTotalT = 0;
            var ManifestTotalT = 0;
            var AmountTotal = 0;
            var ManifestTotal = 0;

            BussData.BLID = $("#ddlBLNumber").val();

            angular.forEach(Data, function (value, key) {
                AmountTotal = parseFloat(Data[key].BillAmount);
                ManifestTotal = parseFloat(Data[key].ManifRate);
                AmountTotalT += parseFloat(Data[key].BillAmount);
                ManifestTotalT += parseFloat(Data[key].ManifRate);

                Items.push('Insert:' + Data[key].ID,
                    Data[key].BKgID,
                    Data[key].ChargeCodeID,
                    Data[key].CurrencyID,
                    Data[key].ContainerID,
                    Data[key].BillAmount,
                    Data[key].ManifRate
                );
            });
            BussData.Itemsv = Items.toString();

            $http({
                method: 'POST',
                url: "/api/DocumentApi/ChargeCorrectorBrackupSave/",
                data: JSON.stringify(BussData),
            }).then(function (result) {
                if (result.data.length > 0) {
                    //$scope.Save = result.data;


                    $scope.txtCustomerRateEdit = AmountTotal;
                    $scope.txtManifestRateEdit = ManifestTotal;
                    $scope.txtBillingAmt = AmountTotal;
                    ShowPopup(result.data[0].AlertMessage);
                    $("#overlay").hide();;
                    return false;
                }
                else {
                    $("#overlay").hide();
                }
            });
        }

        $scope.ClearDetails = function () {


            $("#ddlChargeType").val("");
            $("#ddlChargeTypeEdit").val('');
            $("#ddlCntrType").val("");
            $("#ddlChargeCode").val(null);
            $("#ddlCurrency").val("");
            $("#ddlCurrencyUpdate").val("");
            $("#ddlCollectionMode").val("");
            $("#ddlCollectionModeEdit").val("");
            $("#ddlChargeOwner").val("");
            $("#ddlChargeOwnerEdit").val("");
            $scope.txtManifestRate = "";
            $scope.txtManifestRateEdit = "";
            $scope.txtCustomerRate = "";
            $scope.txtCustomerRateEdit = "";
            $scope.txtBillingAmt = "";
            $scope.txtQty = "";
            $scope.HDArrayIndex = 0;

        }

        $scope.btnChargeOpen = function () {

            $scope.TextBoxDisabled = false;

            $("#ddlChargeType").val("");
            $("#ddlChargeTypeEdit").val('');
            $("#ddlCntrType").val("");
            $("#ddlChargeCode").val(null);
            $("#ddlCurrency").val("");
            $("#ddlCurrencyUpdate").val("");
            $("#ddlCollectionMode").val("");
            $("#ddlCollectionModeEdit").val("");
            $("#ddlChargeOwner").val("");
            $("#ddlChargeOwnerEdit").val("");
            $scope.txtManifestRate = "";
            $scope.txtManifestRateEdit = "";
            $scope.txtCustomerRate = "";
            $scope.txtCustomerRateEdit = "";
            $scope.txtBillingAmt = "";
            $scope.txtQty = "";
            $scope.HDArrayIndex = 0;
        }

    });

    function ShowPopup(message) {
        swal(message);
    };

</script>
<style>
    .chargedtls label {
        font-size: 13px !important;
    }
    /* .chargedtls
        {
            border:1px solid #ccc;
        }*/

    .card .pickupdiv .table tr td {
        font-size: 12px;
        border: 1px solid #ccc;
        padding-top: 1px;
        padding-bottom: 1px;
        /* font-weight: 600;*/
        background-color: #f0f8ff78;
        color: #333;
    }

    .card .pickupdiv .table tr th {
        position: sticky;
        top: 0;
        z-index: 1;
        background-color: #21277a;
    }

    .btncharge {
        padding: 8px 18px;
        margin: -4px 1px;
    }

    .form-control[disabled], .form-group .form-control[disabled], fieldset[disabled] .form-control, fieldset[disabled] .form-group .form-control {
        background-color: #eee;
    }
</style>
<div ng-app="MyApp" ng-controller="MyController">

    <div id="overlay" style="display:none;">
        <div class="loadcontainer">
            <div class="spinner"></div>
            <p>Loading Please Wait</p>
        </div>
    </div>



    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12 backbtn" style="text-align:right;">
                <button type="submit" ng-click="back();" class="btn btn-fill btn-success btn-round btntop">
                    <i class="material-icons">reply</i> Back

                </button>
                @*<button type="submit" ng-click="AddNew();" class="btn btn-fill btn-warning btn-round btntop">
                        <i class="material-icons">edit</i>

                    </button>*@
            </div>
        </div>
        <div class="row">

            <div class="col-md-12">
                <div class="card ">
                    <div class="card-header card-header-primary card-header-text">
                        <div class="card-text">
                            <h4 class="card-title">BL Charge Corrector - Rate</h4>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row" style="border:1px solid #ccc;">
                            <div class="col-md-7" style="border-right: 1px solid #ccc; text-align: center; padding-top:24px;">
                                <button class="btn btn-success" id="btnSave" ng-click="RecordSave(PrincipalChargeCodeEdit);"><i class="fa fa-save"></i> Save</button>
                                <button class="btn btn-default" id="btnApproval" style="background-color: #20498e;" ng-click="BLChargeApproval();"><i class="fa fa-thumbs-up"></i> Approve</button>
                                <a href="#" class="btn btn-default" id="btnReject" ng-click="BLChargeReject();" style="background-color: #f7948d;"><i class="fa fa-thumbs-down"></i> Rejected</a>
                            </div>

                            <div class="col-md-5">
                                <div class="row">
                                    <div class="col-md-12" style="border-bottom:1px solid #ccc;">
                                        <div class="form-group">
                                            <div class="row">
                                                <div class="col-md-4">BL Number:</div>
                                                <div class="col-md-7 padlr0">
                                                    <select class="form-control my-select" id="ddlBLNumber" ng-model="ddlBLNumber" ng-options="item.BLNumber for item in BLNumbers track by item.ID"></select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <div class="row">
                                                <div class="col-md-4">BL Corrcetion No:</div>
                                                <div class="col-md-7 padlr0">
                                                    <label ng-bind="BindCorrectionNo"></label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                            </div>

                        </div>

                        <div class="row" style="margin-top:20px;">
                            <div class="col-md-12 padlr0">
                                <h5 class="cardtitle">Current Charge Details</h5>
                            </div>
                            <div class="col-md-12 padlr0" style="border:1px solid #ccc;">
                                <div class="row pickupdiv">
                                    <div class="col-md-12">
                                        <div class="material-datatables" style="overflow:auto;height:200px;">

                                            <table class="table table-striped table-no-bordered table-hover" cellspacing="0" width="100%" style="width:100%">
                                                <thead>
                                                    <tr>
                                                        <th>S.No</th>

                                                        <th>Equip Type</th>
                                                        <th>Charge Description</th>
                                                        <th>Currency</th>
                                                        <th>Per Payment Mode</th>
                                                        <th>per Manifest Rate</th>
                                                        <th>Customer Rate</th>
                                                        <th>Quantity</th>
                                                        <th>Billing Amt</th>
                                                        @*<th class="disabled-sorting text-right actwid">Breakup</th>*@
                                                        <th class="disabled-sorting text-right actwid">Actions</th>
                                                    </tr>
                                                </thead>

                                                <tbody>
                                                    <tr ng-repeat="gRow in PrincipalChargeCodeRec">
                                                        <td>{{$index+1}}</td>

                                                        <td>{{gRow.CntrTypes}}</td>
                                                        <td>{{gRow.ChargeCode}}</td>
                                                        <td>{{gRow.Currency}}</td>
                                                        <td>{{gRow.PaymentMode}}</td>
                                                        <td>{{gRow.ManifRate}}</td>
                                                        <td>{{gRow.CustomerRate}}</td>
                                                        <td>{{gRow.Qty}}</td>
                                                        <td>{{gRow.BillAmount}}</td>

                                                        <td class="td-actions text-right actwid">
                                                            <button type="button" rel="tooltip" ng-show="disableShow" ng-click="PrincipalEdit(gRow)" class="btn btn-primary btn-round" data-original-title="" title="">
                                                                <i class="material-icons">edit</i>
                                                            </button>

                                                        </td>
                                                    </tr>

                                                </tbody>
                                            </table>

                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="row" style="margin-top:20px;">
                            <div class="col-md-12 chargedtls">
                                <div class="row" style="border:1px solid #ccc;">
                                    <div class="col-md-12" style="border-bottom:1px solid #ccc;">
                                        <div class="row">

                                            <div class="col-md-3" style="border-right: 1px solid #cccc;">
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <label>Charge Type</label>
                                                            <select class="form-control" ng-disabled="TextBoxDisabled" id="ddlChargeType" ng-model="ddlChargeType" ng-options="item.GeneralName for item in BLChargesModeAllValues track by item.ID"></select>
                                                        </div>
                                                        <div class="col-md-6 padl0">
                                                            <label>&nbsp;</label>
                                                            <select class="form-control" id="ddlChargeTypeEdit" ng-model="ddlChargeTypeEdit" ng-options="item.GeneralName for item in BLChargesModeAllValues track by item.ID"></select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-md-3" style="border-right: 1px solid #cccc;">
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <label>Container Type</label>
                                                            <input type="hidden" id="HDArrayIndex" class="form-control" ng-model="HDArrayIndex" />
                                                            <select class="form-control" ng-disabled="TextBoxDisabled" id="ddlCntrType" ng-model="ddlCntrType" ng-options="item.CntrTypes for item in CntrTypesvalues track by item.ID"></select>
                                                        </div>
                                                        <div class="col-md-6 padl0">
                                                            <label>Quantity</label>
                                                            <input class="form-control" ng-disabled="TextBoxDisabled" id="txtQty" ng-model="txtQty" />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3" style="border-right: 1px solid #cccc;">
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <label>Charge</label>
                                                            <select class="form-control" id="ddlChargeCode" ng-model="ddlChargeCode" ng-options="item.ChargeCode for item in ChargeCodeAllvalues track by item.ID"></select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-md-3" style="border-right: 1px solid #cccc;">
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <label>Currency</label>
                                                            <select class="form-control" ng-disabled="TextBoxDisabled" id="ddlCurrency" ng-model="ddlCurrency" ng-options="item.Currency for item in CurrencyValue track by item.ID"></select>
                                                        </div>
                                                        <div class="col-md-6 padl0">
                                                            <label>&nbsp;</label>
                                                            <select class="form-control" id="ddlCurrencyUpdate" ng-model="ddlCurrencyUpdate" ng-options="item.Currency for item in CurrencyValue track by item.ID"></select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3" style="border-right: 1px solid #cccc;">
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <label>Collection Mode</label>
                                                            <select class="form-control" ng-disabled="TextBoxDisabled" id="ddlCollectionMode" ng-model="ddlCollectionMode" ng-options="item.GeneralName for item in CollectionModeAllValues track by item.ID"></select>
                                                        </div>
                                                        <div class="col-md-6 padl0">
                                                            <label>&nbsp;</label>
                                                            <select class="form-control" id="ddlCollectionModeEdit" ng-model="ddlCollectionModeEdit" ng-options="item.GeneralName for item in CollectionModeAllValues track by item.ID"></select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-12">
                                        <div class="row">
                                            <div class="col-md-3" style="border-right: 1px solid #cccc;">
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <label>Manifest Rate</label>
                                                            <input class="form-control" ng-disabled="TextBoxDisabled" id="txtManifestRate" ng-model="txtManifestRate" />
                                                        </div>
                                                        <div class="col-md-6 padl0">
                                                            <label>&nbsp;</label>
                                                            <input class="form-control" ng-disabled="TextBoxDisabled" id="txtManifestRateEdit" ng-model="txtManifestRateEdit" />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-md-3" style="border-right: 1px solid #cccc;">
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <label>Customer Rate</label>
                                                            <input class="form-control" ng-disabled="TextBoxDisabled" id="txtCustomerRate" ng-model="txtCustomerRate" />
                                                        </div>
                                                        <div class="col-md-6 padl0">
                                                            <label>&nbsp;</label>
                                                            <input class="form-control" ng-disabled="TextBoxDisabled" id="txtCustomerRateEdit" ng-change="onclickTextBox();" ng-model="txtCustomerRateEdit" />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-md-3" style="border-right: 1px solid #cccc;">
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <label>Billing Amount</label>
                                                            <input class="form-control" ng-disabled="TextBoxDisabled" id="txtBillingAmt" ng-model="txtBillingAmt" />
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-md-3" style="border-right: 1px solid #cccc;">
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <label>Charge Owner</label>
                                                            <select class="form-control" ng-disabled="TextBoxDisabled" id="ddlChargeOwner" ng-model="ddlChargeOwner" ng-options="item.GeneralName for item in ChageOwnerAllValues track by item.ID"></select>
                                                        </div>
                                                        <div class="col-md-6 padl0">
                                                            <label>&nbsp;</label>
                                                            <select class="form-control" id="ddlChargeOwnerEdit" ng-model="ddlChargeOwnerEdit" ng-options="item.GeneralName for item in ChageOwnerAllValues track by item.ID"></select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>





                                </div>
                            </div>
                        </div>
                        <div class="row" style="border: 1px solid #ccc; margin-top:15px;">
                            <div class="col-md-12" style="text-align:right;">

                                <input type="hidden" ng-model="HDBkgID" id="HDBkgID" />
                                <a href="#" class="btn btn-primary btn-info" id="ChargeOPen" ng-click="btnChargeOpen(HDID)"><i class="fa fa-plus"></i> New Charge Add</a>
                                <a href="#" class="btn btn-primary btn-round" id="BrackupchargeID" ng-click="SelectBreakupView(HDID)"><i class="fa fa-plus"></i> Breakup</a>
                                <a href="#" class="btn btn-success" id="AddChargeDetails" ng-click="addChargeDetails();"><i class="fa fa-plus"></i> Add</a>
                                <a href="#" class="btn btn-warning" id="UpdateDetails" ng-click="UpdateDetails(PrincipalChargeCodeEdit,$index);"><i class="fa fa-edit"></i> Update</a>
                                <a href="#" class="btn btn-warning" id="UpdateDetails" ng-click="ClearDetails();"><i class="fa fa-edit"></i> Clear</a>
                            </div>
                        </div>
                        <input type="hidden" id="HDID" ng-model="HDID" />
                        <input type="hidden" id="HdEID" ng-model="HdEID" />
                        <div class="row">
                            <div class="col-md-12 padlr0" style="border:1px solid #ccc; margin-top:20px;">
                                <div class="col-md-12 pickupdiv padlr0">
                                    <div class="col-md-12">
                                        <h5 class="cardtitle">Charge Correction Details</h5>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="material-datatables" style="overflow:auto;height:200px;">

                                            <table class="table table-striped table-no-bordered table-hover" cellspacing="0" width="100%" style="width:100%">
                                                <thead>
                                                    <tr>
                                                        <th>S.No</th>
                                                        <th>Charge Type</th>
                                                        <th>Charge Type New</th>
                                                        <th>Equip Type</th>
                                                        <th>Quantity</th>
                                                        <th>Charge Description</th>
                                                        <th>CUR-OLD</th>
                                                        <th>CUR-NEW</th>
                                                        <th>Collection Mode</th>
                                                        <th>Collection Mode-New</th>
                                                        <th>Per Manifest Rate</th>
                                                        <th>Per Manifest - new</th>
                                                        <th>Customer Rate</th>
                                                        <th>Customer Rate-new</th>
                                                        <th>Bill Amount</th>
                                                        <th>Charge Owner</th>
                                                        <th class="disabled-sorting text-right actwid">Actions</th>
                                                    </tr>
                                                </thead>

                                                <tbody>
                                                    <tr ng-repeat="gRow in PrincipalChargeCodeEdit">
                                                        <td>1</td>
                                                        <td>{{gRow.TariffType}}</td>
                                                        <td>{{gRow.NewTariffType}}</td>
                                                        <td>{{gRow.CntrTypes}}</td>
                                                        <td>{{gRow.Qty}}</td>
                                                        <td>{{gRow.ChargeCode}}</td>
                                                        <td>{{gRow.Currency}}</td>
                                                        <td>{{gRow.NewCurrency}}</td>
                                                        <td>{{gRow.PaymentMode}}</td>
                                                        <td>{{gRow.NewPaymentMode}}</td>
                                                        <td>{{gRow.ManifRate}}</td>
                                                        <td>{{gRow.NewManifRate}}</td>
                                                        <td>{{gRow.CustomerRate}}</td>
                                                        <td>{{gRow.NewCustomerRate}}</td>
                                                        <td>{{gRow.BillAmount}}</td>
                                                        <td>{{gRow.Ownership}}</td>
                                                        <td class="td-actions text-right actwid">
                                                            <button type="button" rel="tooltip" id="btndeleted" ng-show="disableShow" ng-click="btnDleteCorrection(gRow.RID)" class="btn btn-primary btn-round" data-original-title="" title="">
                                                                <i class="material-icons">delete</i>
                                                            </button>

                                                        </td>
                                                    </tr>

                                                </tbody>
                                            </table>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </div>


    <div class="modal fade" id="demoModalView" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="width:1020px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>

                </div>
                <div class="modal-body">
                    <div class="row popup">
                        <div class="col-md-12" style="text-align:center;">

                            <div class="card-header card-header-primary card-header-text" style=" margin-bottom: 20px;">
                                <div class="card-text">
                                    <h4 class="card-title" style="font-weight:bold;">BREAK UP SUMMARY</h4>
                                </div>
                            </div>

                            <div class="col-md-12">
                                <div class="material-datatables">

                                    <table class="table table-striped table-no-bordered table-hover" cellspacing="0" width="100%" style="width:100%">
                                        <thead>
                                            <tr>
                                                <th>SNo</th>
                                                <th>CONTAINER NO</th>
                                                <th>CHRGE DESCRITION</th>
                                                <th>CNTR TYPE</th>
                                                <th>CURRENCY</th>

                                                <th>MANIFEST AMOUNT</th>
                                                <th>CUSTOMER AMOUNT</th>

                                                @*<th class="disabled-sorting text-right actwid">Actions</th>*@
                                            </tr>
                                        </thead>

                                        <tbody>
                                            <tr ng-repeat="gRow in DynamicGridBrackup">
                                                <td>{{$index+1}}</td>
                                                <td>{{gRow.CntrNo}}</td>
                                                <td>{{gRow.ChargeCode}}</td>
                                                <td>{{gRow.CntrType}}</td>
                                                <td>{{gRow.Currency}}</td>
                                                <td><input type="text" id="txtReqRate" autocomplete="off" class="form-control" ng-model="gRow.ManifRate" /></td>
                                                <td><input type="text" id="txtCusRate" autocomplete="off" class="form-control" ng-model="gRow.BillAmount" /></td>
                                                @*<td class="td-actions text-right actwid">
                                                        <button type="button" rel="tooltip" ng-if="$last" ng-click="MUCChargesAdd(gRow)" class="btn btn-primary btn-round" data-original-title="" title="">
                                                            <i class="material-icons">add</i>
                                                        </button>
                                                        <button type="button" rel="tooltip" ng-if="!$last" ng-click="MUCChargesDelete(DynamicGridBrackup,$index,gRow.TCID)" class="btn btn-danger btn-round" data-original-title="" title="">
                                                            <i class="material-icons">delete</i>
                                                        </button>
                                                    </td>*@
                                            </tr>
                                            <tr>
                                                <td colspan="6"></td>
                                                <td><span ng-bind="TotalMCHCharges"> </span> </td>
                                            </tr>
                                        </tbody>
                                    </table>

                                </div>



                            </div>

                            <div class="col-md-12">

                                <button type="submit" id="btnudate" ng-click="OnclickDetailUpdate(DynamicGridBrackup);" class="btn btn-fill btn-primary btnupdate btntop">
                                    <i class="material-icons"></i>
                                    Update
                                </button>

                            </div>
                        </div>



                    </div>
                </div>




            </div>
        </div>
    </div>
</div>
