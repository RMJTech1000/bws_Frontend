@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link rel="stylesheet" href="~/assets/css/InvoiceStyle.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.4/css/select2.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.4/js/select2.full.min.js"></script>






<script type="text/javascript">

    LayoutApp.controller('MyController', function ($scope, $http, $timeout) {

        $('#overlay').fadeIn().delay(300).fadeOut();

        $(document).ready(function () {
            $('.my-select').select2({
                placeholder: "--Select--",
                allowClear: true,
                width: '100%'
            });
        });

        $scope.BasicBindValues = [
            { 'name': '--select--', 'ID': 0 },
            { 'name': 'BL', 'ID': 1 },
            { 'name': 'Container', 'ID': 2 }
        ];

        $scope.CreditTypesValues = [
            { 'name': '--select--', 'ID': 0 },
            { 'name': 'Against Invoice', 'ID': 1 },
            { 'name': 'Direct CN', 'ID': 2 }
        ];



        document.getElementById('txtInvDate').value = new Date().toISOString().slice(0, 10);

        document.getElementById('txtInvDueDate').value= new Date().toISOString().slice(0, 10);



        $scope.BLChargeGridValueBind = [{

            BCID: "", ChargeCodeID: "", ChargeCodeDesc: "", ChargeCodeDescEdit:"", CurrencyID: "", Currency: "", ROE: "", BasicId: "", Basic: "", CntrTypeID: "", CntrTypes:"", PerUnitAmt:"",Qty:"",
            Amount: "", LocAmount: "", TaxPercentage: "", IsFinal: "", IsInvFinal: "", IsMiscCharge:""
        }];

        $scope.ChargeCodeAllvalues = null;
        $scope.fillChargecodeValues = function () {
            $http({
                method: 'POST',
                url: '/api/CommonAccessApi/ChargeCodeAgent/',
                data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.ChargeCodeAllvalues = result.data;

                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        };
        $scope.fillChargecodeValues();

        $scope.CurrencyValue = null;
        $scope.fillCurrencyValues = function () {
            $http({
                method: 'POST',
                url: '/api/CommonAccessApi/CurrencyValues/',
                data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.CurrencyValue = result.data;

                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        };
        $scope.fillCurrencyValues();

        $scope.ModuleAllvalues = null;
        $scope.fillModuleValues = function ()
        {
            var Datavalue = {};
            Datavalue.ID = "7"; //GeneralMaster Table seqNo
            $http({
                method: 'POST',
                url: '/api/CommonAccessApi/ModuleValues/',
                data: JSON.stringify(Datavalue)
            }).then(function (result) {
                $timeout(function () {
                    $scope.ModuleAllvalues = result.data;
                   // $scope.ddlBLParty = { ID: result.data[0].ID };



                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        };
        $scope.fillModuleValues();

        $scope.CntrTypesvalues = null;
        $scope.fillCntrTypeValues = function () {
            $http({
                method: 'POST',
                url: '/api/CommonAccessApi/CntrTypeValues/',
                data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.CntrTypesvalues = result.data;


                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        };
        $scope.fillCntrTypeValues();
        $scope.CustomerMasterAllvalues = null;
        $scope.fillCustomerMasterValues = function () {
            var Datavalue = {};
            Datavalue.AgencyID = localStorage.getItem("AgencyID");
            $http({
                method: 'POST',
                url: '/api/InvoiceApi/InvCustomerMaster/',
                data: JSON.stringify(Datavalue)
            }).then(function (result) {
                $timeout(function () {
                    $scope.CustomerMasterAllvalues = result.data;



                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        };
        $scope.fillCustomerMasterValues();

        $scope.PartyInvoiceBank = function () {

            $scope.InvBankALL = null;
            var BussData = {};
            BussData.AgentID = localStorage.getItem("AgencyID");
            $http({
                method: 'POST',
                url: '/api/InvoiceApi/PartyInvBank/',
                data: JSON.stringify(BussData),
                // data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.InvBankALL = result.data;
                    $scope.ddlBank = { ID: $scope.InvBankALL[0].ID }
                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        }

        $scope.PartyInvoiceBank();

        $("#ddlParty").change(function ()
        {
            $scope.BranchfillAll = null;
            var BussData = {};
            BussData.CusID = $("#ddlParty").val();
            $http({
                method: 'POST',
                url: '/api/InvoiceApi/InvCustomerBranch/',
                data: JSON.stringify(BussData),
                // data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.BranchfillAll = result.data;
                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
            $scope.PartyInvoiceCurrency(BussData.CusID);
        });

        $scope.PartyInvoiceCurrency = function (CusID)
        {

            $scope.InvCurrencyALL = null;
            var BussData = {};
            BussData.PartyID = CusID;
            $http({
                method: 'POST',
                url: '/api/InvoiceApi/PartyInvCurrecny/',
                data: JSON.stringify(BussData),
                // data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.InvCurrencyALL = result.data;
                    $scope.ddlBillCurrency = { ID: $scope.InvCurrencyALL[0].ID };
                    $scope.ExemptFromTax = result.data[0].ExemptFromTax;
                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        }

        $("#ddlBranch").change(function () {

            var BussData = {};
            BussData.CID = $("#ddlBranch").val();
            $http({
                method: 'POST',
                url: '/api/InvoiceApi/InvCusBranchvalues/',
                data: JSON.stringify(BussData),
                // data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.txtaddress = result.data[0].Address;
                    $scope.txtPartyTaxNo = result.data[0].CusGSTNo;
                    $scope.txtCusLocation = result.data[0].CusStateName;
                    $scope.HDCusLocationID = result.data[0].CusStateId;


                  //  $scope.BranchfillAll = result.data;
                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        });

        $scope.TaxDetails = function ()
        {

            var BussDate = {};
            BussDate.CountryID = 53;
            $http({
                method: 'POST',
                url: '/api/InvoiceApi/InvTaxDetails',
                data: JSON.stringify(BussDate),

            }).then(function (result) {
                $timeout(function () {

                    $scope.InvTaxValueBind = result.data;

                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            });

        }
        $scope.TaxDetails();

        $(document).ready(function ()
        {
            var queryString = new Array();
            if (window.location.search.split('?').length > 1) {
                var params = window.location.search.split('?')[1].split('&');
                for (var i = 0; i < params.length; i++) {
                    var key = params[i].split('=')[0];
                    var value = decodeURIComponent(params[i].split('=')[1]);
                    queryString[key] = value;
                }
            }

            if (queryString["InvID"] != null)
            {
                $scope.HDInvID = queryString["InvID"].toString();
                //$scope.RegId = queryString["BkgRegID"].toString();
                //$scope.HDBLID = queryString["BLIDReg"].toString();
                //$scope.BLTypes = queryString["BLTypes"].toString();
                //$scope.ModuleID = queryString["Module"].toString();
                //$scope.ExistingBLValues(queryString["BLIDReg"].toString(), queryString["BkgRegID"].toString());
                $scope.InvoiceDetalsValues(queryString["InvID"].toString());
                $scope.FillInvoiceChargeDetailsNew(queryString["InvID"].toString());
               // $scope.InvoiceBLChargeValues(queryString["InvID"].toString());
                $scope.InvoiceTaxDetails(queryString["InvID"].toString());


            }
        });

        $scope.ExistingBLValues = function () {
            var BussDate = {};
            BussDate.AgentID = localStorage.getItem("AgencyID");
            $http({
                method: 'POST',
                url: '/api/StandalonInvoice/BLAgentLocation',
                data: JSON.stringify(BussDate),

            }).then(function (result) {
                $timeout(function () {

                    $scope.txtLocation = result.data[0].AgentLocation;
                    $scope.txtAgentGstNo = result.data[0].AgentTax;
                    $scope.HDAgentLocID = result.data[0].AgentStateID;

                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            });

        }
        $scope.ExistingBLValues();

        $scope.gridRowAdd = function (gRow) {

        $scope.BLChargeGridValueBind.push({
                'BLCHID': "",
                'ChargeCodeID': "",
                'ChargeCode': "",
                'infoChID': "",
                'infoCh': "",
                'Basic': "",
                'BasicID': "",
                'CntrTypeID': "",
                'CntrTypes': "",
                'CommodityTypeID': "",
                'CommodityTypes': "",
                'CurrencyID': "",
                'Currency': "",
                'Amt': "",
                'IsMiscCharge': "0"



            });
        }

        $scope.AccountPagingDR = function () {

            var BLID = $scope.RegId;
            var url = "/Invoice/Invoice?BLRegID=" + encodeURIComponent(BLID);
            window.location.href = url;

        }


        $scope.TaxCalculation = function () {

            $scope.IGSTAmt = 0;
            $scope.CGSTAmt = 0;
            $scope.SGSTAmt = 0;

            $scope.TotalAmount = 0;
            $scope.TaxAmount = 0;
            console.log($scope.BLChargeGridValueBind);
            angular.forEach($scope.BLChargeGridValueBind, function (value, key)
            {

                if ($scope.BLChargeGridValueBind[key].IsFinal == true && $scope.BLChargeGridValueBind[key].IsInvFinal == "0") {

                    var InvLocAmt = 0;
                    var InvTaxAmt = 0;
                    var NarrationID = 0;
                    NarrationID = $scope.BLChargeGridValueBind[key].ChargeCodeID.ID;
                    InvLocAmt = parseFloat($scope.BLChargeGridValueBind[key].LocAmount);
                    InvTaxAmt = ((parseFloat($scope.BLChargeGridValueBind[key].LocAmount)) * (parseFloat($scope.BLChargeGridValueBind[key].TaxPercentage)) / 100);

                    $scope.TotalAmount += parseFloat(InvLocAmt);
                    $scope.TaxAmount += parseFloat(InvTaxAmt);

                    if ($scope.HDAgentLocID == $scope.HDCusLocationID) {

                        $scope.CGSTAmt += parseFloat(InvTaxAmt) / 2;
                        $scope.SGSTAmt += parseFloat(InvTaxAmt) / 2;

                    }
                    else {
                        $scope.IGSTAmt += parseFloat(InvTaxAmt);

                    }

                 

                }
                angular.forEach($scope.InvTaxValueBind, function (value, key)
                {
                    if (key == "0") {
                        $scope.InvTaxValueBind[key].Amount = $scope.CGSTAmt;
                    }
                    if (key == "1") {
                        $scope.InvTaxValueBind[key].Amount = $scope.SGSTAmt;
                    }
                    if (key == "2") {
                        $scope.InvTaxValueBind[key].Amount = $scope.IGSTAmt;
                    }

                });
            });

            $scope.InvoiceTotal = parseFloat($scope.TotalAmount) + parseFloat($scope.TaxAmount);
        }

        $scope.Recordsave = function (data)
        {
            var validation = "";
            var txtInvDate = $('#txtInvDate').val();
            if (txtInvDate.length == 0) {
                validation += "<span style='color:red;'>*</span> <span>Please Enter Invoice Date</span></br>"
            }
            var txtInvDueDate = $('#txtInvDueDate').val();
            if (txtInvDueDate.length == 0) {
                validation += "<span style='color:red;'>*</span> <span>Please Invoice Due ToDate</span></br>"
            }

            var ddlPartyTypes = $('#ddlBLParty').val();
            if (ddlPartyTypes == "?") {
                validation += "<span style='color:red;'>*</span> <span>Please select Types</span></br>"
            }
            var ddlParty = $('#ddlParty').val();
            if (ddlParty == "?") {
                validation += "<span style='color:red;'>*</span> <span>Please Select Invoice Party Name</span></br>"
            }

            var ddlBranch = $('#ddlBranch').val();
            if (ddlBranch == "?") {
                validation += "<span style='color:red;'>*</span> <span>Please Select Invoice Party Branch</span></br>"
            }

            var ddlBranch = $('#ddlBank').val();
            if (ddlBranch == "?") {
                validation += "<span style='color:red;'>*</span> <span>Please Select Bank Details</span></br>"
            }
            var ddlBillCurrency = $('#ddlBillCurrency').val();
            if (ddlBillCurrency == "?") {
                validation += "<span style='color:red;'>*</span> <span>Please Select Billing Currency</span></br>"
            }

            var ddlCreditNoteType = $("#ddlCreditNoteType").val();
            if (ddlCreditNoteType == "?") {
                validation += "<span style='color:red;'>*</span> <span>Please Select Credit Note Type</span></br>"
            }



            if (validation != "") {
                ShowPopup(validation);
                return false;
            }
            $('#overlay').fadeIn().show();

            var BussData = {}
            var Items = []
            angular.forEach(data, function (value, key)
            {

                if (data[key].IsFinal == true && data[key].IsInvFinal == "0")
                {
                    var TaxAmt = 0;
                    var InvBCID = 0;
                    TaxAmt = (parseFloat(data[key].LocAmount) * parseFloat(data[key].TaxPercentage)) / 100;
                    if (data[key].BCID == "" || typeof data[key].BCID == "undefined")
                        InvBCID = 0;
                    else
                        InvBCID = data[key].BCID;
                    Items.push('Insert:' +
                        InvBCID,
                        data[key].ChargeCodeID.ID,
                        data[key].ChargeCodeDescEdit,
                        data[key].CurrencyID.ID,
                        data[key].ROE,
                        data[key].BasicId.ID,
                        data[key].CntrTypeID.ID,
                        data[key].PerUnitAmt,
                        data[key].Qty,
                        data[key].Amount,
                        data[key].LocAmount,
                        data[key].TaxPercentage,
                        TaxAmt
                    );
                }
            });
            BussData.Items = Items.toString();
            BussData.ID = 0;
            BussData.BLID = 0;
            BussData.BkgID = 0;
            BussData.InvoiceNo = $scope.txtInvNo;
            BussData.InvDate = $("#txtInvDate").val();
            BussData.InvTypes = 2;
            BussData.InvTax = $scope.TaxAmount;
            BussData.InvAmount = $scope.TotalAmount;
            BussData.InvTotal = $scope.InvoiceTotal;
            BussData.GeoLocID = localStorage.getItem("GeoLocationID");;
            BussData.IsActive = 0;
            BussData.BLTypes = 3;

            if ($("#ddlCreditNoteType").val() == "1")
                BussData.DrID = $("#ddlInvoice").val();
            else
                BussData.DrID = 0;

            BussData.TaxNo = $scope.txtPartyTaxNo;
            BussData.Address = $scope.txtaddress;
            BussData.CurrencyID = $("#ddlBillCurrency").val();
            BussData.StateCode = $scope.txtCusLocation;
            BussData.InvDueDate = $("#txtInvDueDate").val();
            BussData.Location = $scope.txtCusLocation;
            BussData.BranchID = $("#ddlBranch").val();
            BussData.Branch = $("#ddlBranch option:selected").text();
            BussData.PartyTypes = $("#ddlBLParty").val();
            BussData.StrPartyTypes = $("#ddlBLParty option:selected").text();
            BussData.PartyID = $("#ddlParty").val();
            BussData.PartyName = $("#ddlParty option:selected").text();
            BussData.InvStatus = "1";
            BussData.GSTState = $scope.HDCusLocationID;
            BussData.DeffRoundoff = 0;
            BussData.Roundoff = 0;
            BussData.CreditType = 0;
            BussData.intBank = $("#ddlBank").val();
            BussData.CountryID = localStorage.getItem("CountryID");
            BussData.UserID = localStorage.getItem("UserID");
            BussData.AgentId = localStorage.getItem("AgencyID");
            BussData.SessionFinYear = localStorage.getItem("SessionFinYear");
            BussData.AgentCode = localStorage.getItem("DocumentSuffix");
            BussData.AgentStateID = $scope.HDAgentLocID;
            BussData.CustStateID = $scope.HDCusLocationID;
            BussData.TaxExemption = $("#ExemptFromTax").val();
            BussData.SecurityDepositID = $scope.CheckSecurityDeposit;
            BussData.CreditNoteType = $("#ddlCreditNoteType").val();
            BussData.Remarks = $scope.Remarks;

            $http({
                method: 'POST',
                url: '/api/StandalonInvoice/InvoiceInsertCR',
                data: JSON.stringify(BussData),

            }).then(function (result) {
                $timeout(function () {

                    $scope.BLChargeGridValueBind.length = 0;
                    $scope.HDInvID = result.data[0].ID;
                    $('#overlay').fadeIn().hide();
                    ShowPopup(result.data[0].AlertSuccess);
                    url = "/StandaloneBilling/StandaloneBillingView";
                    window.location.href = url;


                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {

                ShowPopup('There has been an error: ' + result);
            });



        }

        $scope.InvoiceDetalsValues = function (ID) {
            var BussDate = {};
            BussDate.ID = ID;
            $http({
                method: 'POST',
                url: '/api/StandalonInvoice/ExistingInvoiceValue',
                data: JSON.stringify(BussDate),

            }).then(function (result)
            {

                $timeout(function () {
                    $scope.txtInvNo = result.data[0].InvoiceNo;
                    document.getElementById('txtInvDate').value = result.data[0].InvDate;
                    document.getElementById('txtInvDueDate').value = result.data[0].InvDueDate;
                   // $scope.txtInvDueDate = result.data[0].InvDueDate;
                    $scope.ddlBLParty = { ID: result.data[0].PartyTypes };
                    $scope.ddlParty = { ID: result.data[0].PartyID };
                    $scope.ExistInvoicePartyBranch(result.data[0].PartyID);
                    $scope.PartyInvoiceCurrency(result.data[0].PartyID);
                    $scope.BLInvoiceNo($scope.HDInvID);
                    $scope.txtPartyTaxNo = result.data[0].TaxNo;
                    $scope.txtaddress = result.data[0].Address;
                    $scope.txtCusLocation = result.data[0].StateCode;
                    $scope.ddlBranch = { ID: result.data[0].BranchID };
                  
                    $scope.InvoiceTotal = result.data[0].InvTotal;
                    $scope.TotalAmount = result.data[0].InvAmount;
                    $scope.TaxAmount = result.data[0].InvTax;
                    $scope.ddlBank = { ID: result.data[0].intBank };
                    $scope.ddlBillCurrency = { ID: result.data[0].CurrencyID };
                    $scope.ddlInvoice = { ID: result.data[0].DrID };
                    $scope.Remarks = result.data[0].Remarks;
                    document.getElementById("btnSave").disabled = true;
                    document.getElementById("btnSave").style.cursor = 'not-allowed';



                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            });

        }

        $scope.ExistInvoicePartyBranch = function (PartyID) {

            $scope.BranchfillAll = null;
            var BussData = {};
            BussData.CusID = PartyID;
            $http({
                method: 'POST',
                url: '/api/InvoiceApi/InvCustomerBranch/',
                data: JSON.stringify(BussData),
                // data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.BranchfillAll = result.data;
                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });

        }

        $scope.InvoiceTaxDetails = function (InvID) {

            var BussDate = {};
            BussDate.InvID = InvID;
            BussDate.CountryID = 53;
            $http({
                method: 'POST',
                url: '/api/StandalonInvoice/InvExistingTaxDetails',
                data: JSON.stringify(BussDate),

            }).then(function (result) {
                $timeout(function () {

                    $scope.InvTaxValueBind = result.data;

                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            });

        }

        $scope.back = function () {

            var BLId = $scope.RegId;
            var url = "/StandaloneBilling/StandaloneBillingView";
            window.location.href = url;
        }

        $scope.btnPrint = function () {
            window.location.href = '@Url.Action("InvoicePDF", "InvoicePDF")';
        }

        $scope.ChargeCodeValuedisplay = function (gRow) {
            gRow.ChargeCodeDescEdit = gRow.ChargeCodeID.ChargeCode;
            var BussData = {};
            BussData.ChargeCodeID = gRow.ChargeCodeID.ID;
            BussData.CountryID = 53;
            console.log(BussData);
            $http({
                method: 'POST',
                url: '/api/InvoiceApi/TaxDetails',
                data: JSON.stringify(BussData),

            }).then(function (result) {
                if (result.data.length > 0) {
                    gRow.TaxPercentage = result.data[0].TaxPercentage;
                    gRow.IsInvFinal = 0;
                }
                else {
                    gRow.TaxPercentage = 0;
                    gRow.IsInvFinal = 0;
                }

            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            });
        }

        $scope.OnClickChangeROE = function (gRow) {

            gRow.LocAmount = (parseFloat(gRow.ROE)) * (parseFloat(gRow.Amount));
            gRow.TaxAmt = ((parseFloat(gRow.LocAmount) * parseFloat(gRow.TaxPercentage)) / 100)

        }
        $scope.onClickQtyRatecalcuation = function (gRow) {
            gRow.Amount = (parseFloat(gRow.Qty) * parseFloat(gRow.PerUnitAmt));
            gRow.LocAmount = (parseFloat(gRow.ROE)) * parseFloat((gRow.Amount));
            gRow.TaxAmt = ((parseFloat(gRow.LocAmount) * parseFloat(gRow.TaxPercentage)) / 100)


        }


        $scope.BLInvoicefill = null;
        $scope.BLInvoiceNo = function (InvID)
        {
            var BussDate = {};
            BussDate.ID = InvID;
            $http({
                method: 'POST',
                url: '/api/StandalonInvoice/BLInvoiceNo',
                data: JSON.stringify(BussDate),

            }).then(function (result) {
                $timeout(function () {
                    $scope.BLInvoicefill = result.data;


                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            });

        }

        $("#ddlInvoice").change(function () {

            $scope.FillInvoiceDetails();
            $scope.FillInvoiceChargeDetails();

        });


        $scope.FillInvoiceDetails = function () {

            var BussDate = {};
            BussDate.ID = $("#ddlInvoice").val();
            $http({
                method: 'POST',
                url: '/api/StandalonInvoice/ExistingInvoiceValue',
                data: JSON.stringify(BussDate),

            }).then(function (result) {

                $timeout(function () {
                    //$scope.txtInvNo = result.data[0].InvoiceNo;
                    //document.getElementById('txtInvDate').value = result.data[0].InvDate;
                    //document.getElementById('txtInvDueDate').value = result.data[0].InvDueDate;
                    // $scope.txtInvDueDate = result.data[0].InvDueDate;
                    //$scope.ddlBLParty = { ID: result.data[0].PartyTypes };
                    $scope.ddlParty = { ID: result.data[0].PartyID };
                    $scope.ExistInvoicePartyBranch(result.data[0].PartyID);
                    $scope.PartyInvoiceCurrency(result.data[0].PartyID);
                    $scope.txtPartyTaxNo = result.data[0].TaxNo;
                    $scope.txtaddress = result.data[0].Address;
                    $scope.txtCusLocation = result.data[0].StateCode;
                    $scope.BranchDisplay(result.data[0].BranchID);
                    $scope.ddlBranch = { ID: result.data[0].BranchID };
                   // $scope.TotalAmount = result.data[0].InvAmount;
                   // $scope.TaxAmount = result.data[0].InvTax;
                   // $scope.InvoiceTotal = result.data[0].InvTotal;
                    $scope.ddlBank = result.data[0].intBank;
                    $scope.ddlBillCurrency = { ID: result.data[0].CurrencyID };




                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            });

        }
        $scope.FillInvoiceChargeDetails = function ()
        {
            var BussDate = {};
            BussDate.BkgID = $scope.RegId;
            BussDate.BLID = $scope.HDBLID;
            BussDate.InvID = $("#ddlInvoice").val();
            BussDate.InvTypes = "1";
            $http({
                method: 'POST',
                url: '/api/InvoiceApi/InvBLChargesExistingValueCR',
                data: JSON.stringify(BussDate),

            }).then(function (result) {
                $timeout(function () {

                    $scope.BLChargeGridValueBind.length = 0;
                    angular.forEach(result.data, function (value, key) {

                        $scope.BLChargeGridValueBind.push({

                            'BCID': result.data[key].BLCHID,
                            'ChargeCodeID': { ID: result.data[key].ChargeCodeID },
                            'ChargeCodeDescEdit': result.data[key].ChargeCodeDescEdit,
                            'ChargeCodeDesc': result.data[key].ChargeCodeDesc,
                            'CurrencyID': { ID: result.data[key].CurrencyID },
                            'Currency': result.data[key].Currency,
                            'ROE': result.data[key].ROE,
                            'BasicId': { ID: result.data[key].BasicID },
                            'Basic': result.data[key].Basic,
                            'CntrTypeID': { ID: result.data[key].CntrTypeID },
                            'CntrTypes': result.data[key].CntrTypes,
                            'PerUnitAmt': result.data[key].PerUnitAmt,
                            'Qty': result.data[key].Qty,
                            'Amount': result.data[key].Amount,
                            'LocAmount': result.data[key].LocAmount,
                            'TaxPercentage': result.data[key].TaxPercentage,
                            'IsFinal': result.data[key].IsFinal,
                            'IsInvFinal': result.data[key].IsInvFinal,
                            'IsMiscCharge': result.data[key].IsMiscCharge
                        });

                    });
                    $scope.TaxCalculation();


                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            });

        }
        $scope.FillInvoiceChargeDetailsNew = function (InvID) {

            var BussDate = {};
            BussDate.InvID = InvID;
            BussDate.InvTypes = "2";
            $http({
                method: 'POST',
                url: '/api/StandalonInvoice/InvBLChargesExistingValueCR',
                data: JSON.stringify(BussDate),

            }).then(function (result) {
                $timeout(function () {

                    $scope.BLChargeGridValueBind.length = 0;

                    angular.forEach(result.data, function (value, key) {

                        $scope.BLChargeGridValueBind.push({

                            'BCID': result.data[key].BLCHID,
                            'ChargeCodeID': { ID: result.data[key].ChargeCodeID },
                            'ChargeCodeDescEdit': result.data[key].ChargeCodeDescEdit,
                            'ChargeCodeDesc': result.data[key].ChargeCodeDesc,
                            'CurrencyID': { ID: result.data[key].CurrencyID },
                            'Currency': result.data[key].Currency,
                            'ROE': result.data[key].ROE,
                            'BasicId': { ID: result.data[key].BasicID },
                            'Basic': result.data[key].Basic,
                            'CntrTypeID': { ID: result.data[key].CntrTypeID },
                            'CntrTypes': result.data[key].CntrTypes,
                            'PerUnitAmt': result.data[key].PerUnitAmt,
                            'Qty': result.data[key].Qty,
                            'Amount': result.data[key].Amount,
                            'LocAmount': result.data[key].LocAmount,
                            'TaxPercentage': result.data[key].TaxPercentage,
                            'IsFinal': result.data[key].IsFinal,
                            'IsInvFinal': result.data[key].IsInvFinal,
                            'IsMiscCharge': result.data[key].IsMiscCharge
                        });

                    });
                   // $scope.TaxCalculation();


                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            });

        }

        $scope.CheckBoxHeadChecked = function (checked) {

            $scope.IGSTAmt = 0;
            $scope.CGSTAmt = 0;
            $scope.SGSTAmt = 0;
            $scope.TotalAmount = 0;
            $scope.TaxAmount = 0;

            angular.forEach($scope.BLChargeGridValueBind, function (value, key) {
                $scope.BLChargeGridValueBind[key].IsFinal = checked;
                if ($scope.BLChargeGridValueBind[key].IsFinal == true && $scope.BLChargeGridValueBind[key].IsInvFinal == "0") {
                    var InvLocAmt = 0;
                    var InvTaxAmt = 0;
                    InvLocAmt = parseFloat($scope.BLChargeGridValueBind[key].LocAmount);
                    var NarrationID = 0;
                    NarrationID = $scope.BLChargeGridValueBind[key].ChargeCodeID.ID;
                    InvTaxAmt = ((parseFloat($scope.BLChargeGridValueBind[key].LocAmount)) * (parseFloat($scope.BLChargeGridValueBind[key].TaxPercentage)) / 100);

                    $scope.TotalAmount += parseFloat(InvLocAmt);
                    $scope.TaxAmount += parseFloat(InvTaxAmt);

                    if (NarrationID == 1 || NarrationID == 22 || NarrationID == 27 && $scope.ModuleID == 15) {

                        $scope.IGSTAmt += parseFloat(InvTaxAmt);
                    }
                    else {
                        if ($scope.HDAgentLocID == $scope.HDCusLocationID) {

                            $scope.CGSTAmt += parseFloat(InvTaxAmt) / 2;
                            $scope.SGSTAmt += parseFloat(InvTaxAmt) / 2;

                        }
                        else {
                            $scope.IGSTAmt += parseFloat(InvTaxAmt);

                        }
                    }
                }

            });

            angular.forEach($scope.InvTaxValueBind, function (value, key) {
                if (key == "0") {
                    $scope.InvTaxValueBind[key].Amount = $scope.CGSTAmt;
                }
                if (key == "1") {
                    $scope.InvTaxValueBind[key].Amount = $scope.SGSTAmt;
                }
                if (key == "2") {
                    $scope.InvTaxValueBind[key].Amount = $scope.IGSTAmt;
                }
            });


            $scope.InvoiceTotal = parseFloat($scope.TotalAmount) + parseFloat($scope.TaxAmount);

        }


        $scope.BranchDisplay = function (BranchID) {

            var BussData = {};
            BussData.CID = BranchID;
            $http({
                method: 'POST',
                url: '/api/InvoiceApi/InvCusBranchvalues/',
                data: JSON.stringify(BussData),
                // data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.txtaddress = result.data[0].Address;
                    $scope.txtPartyTaxNo = result.data[0].CusGSTNo;
                    $scope.txtCusLocation = result.data[0].CusStateName;
                    $scope.HDCusLocationID = result.data[0].CusStateId;


                    //  $scope.BranchfillAll = result.data;
                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        }
    });

    function ShowPopup(message) {
        swal(message);
    };


</script>
<style>

    /* select {
            width: 160px;
            padding: 5px;
            font-size: 12px;
            line-height: 1;
            border: 0;
            border-radius: 5px;
            height: 34px;
            background: url(http://cdn1.iconfinder.com/data/icons/cc_mono_icon_set/blacks/16x16/br_down.png) no-repeat right #ddd;
            -webkit-appearance: none;
            background-position-x: 140px;
        }
    */

    .card legend .leg {
        font-size: 15px;
        color: #69b8d6;
        background-color: #20498e;
        text-transform: capitalize !important;
        color: #fff;
        padding: 4px 14px;
        text-align: left;
    }

        .card legend .leg span {
            font-size: 14px;
            color: #ffffff;
        }

    .cusjob {
        margin-top: -48px;
        margin-left: 216px;
        color: #fff;
    }

    .table .td-actions .btn {
        padding: 2px;
        background-color: #636565;
    }

    .material-icons {
        font-size: 15px !important;
        padding: 1px !important;
    }

    .btn.btn-primary {
        background-color: #0585b5;
        border-color: #0585b5;
    }

    .form-group {
        padding-bottom: 0 !important;
    }
</style>
<div ng-app="MyApp" ng-controller="MyController">


    <div id="overlay" style="display:none;">
        <div class="loadcontainer">
            <div class="spinner"></div>
            <p>Loading Please Wait</p>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12 backbtn" style="text-align:right;">
            <a href="#" type="submit" ng-click="back();" class="btn btn-fill btnback btn-success btn-round btntop">
                <i class="material-icons">reply</i> Back
            </a>
            @*<a href="#" type="submit" class="btn btn-fill btnedit btn-warning btn-round btntop">
                    <i class="material-icons">edit</i>
                </a>*@
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header card-header-primary card-header-icon">
                    <div class="card-icon">
                        Credit Note Invoice
                    </div>
                </div>
                <div class="card-body">
                    <fieldset>
                        <legend>
                            <div class="row">
                                <div class="col-md-4 leg">Billing Information</div>
                                <div class="col-md-5 leg"><span></span></div>
                                <div class="col-md-3 leg">BL No : <span><span ng-bind="BLNo"></span></span></div>
                            </div>
                        </legend>

                    </fieldset>
                    <div class="row inventry">
                        <div class="col-md-12 padlr0" style="padding-top:7px; padding-bottom:7px;">


                            <div class="col-md-12">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <div class="row" style="margin-right:0">
                                                <div class="col-md-4 lbl"><label class="lable-fond">Invoice No</label></div>
                                                <div class="col-md-1">:</div>
                                                <div class="col-md-6"><input class="form-control" id="txtInvNo" readonly ng-model="txtInvNo" ng-bind="InvoiceNo" /></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <div class="row">
                                                <div class="col-md-4 lbl2"><label class="lable-fond">Invoice Date</label></div>
                                                <div class="col-md-1">:</div>
                                                <div class="col-md-5">
                                                    <input type="date" class="form-control" ng-bind="txtInvDate" id="txtInvDate" autocomplete="off" />

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <div class="row">
                                                <div class="col-md-4 lbl3"><label class="lable-fond">Invoice Due Date</label></div>
                                                <div class="col-md-1">:</div>
                                                <div class="col-md-5">
                                                    <input type="date" class="form-control" id="txtInvDueDate" autocomplete="off" />

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-12">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <div class="row">
                                                <div class="col-md-4 lbl"><label class="lable-fond">BL Types</label></div>
                                                <div class="col-md-1">:</div>
                                                <div class="col-md-5">
                                                    <select class="form-control" id="ddlBLParty" ng-model="ddlBLParty" ng-options="item.GeneralName for item in ModuleAllvalues track by item.ID">
                                                    </select>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <div class="row">
                                                <div class="col-md-4 lbl3"><label class="lable-fond">BLNo</label></div>
                                                <div class="col-md-1">:</div>
                                                <div class="col-md-5"> <input type="text" class="txtbox form-control" id="txtBLNo" ng-model="txtBLNo"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <div class="row">
                                                <div class="col-md-4 lbl3"><label class="lable-fond">Vessel/Voyage</label></div>
                                                <div class="col-md-1">:</div>
                                                <div class="col-md-5"> <input type="text" class="txtbox form-control" id="txtVslVoy" ng-model="txtVslVoy"></div>
                                            </div>
                                        </div>
                                    </div>



                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="row">

                                    <div class="col-md-4">

                                        <div class="form-group">
                                            <div class="row">
                                                <div class="col-md-4 lbl"><label class="lable-fond">Party</label></div>
                                                <div class="col-md-1">:</div>
                                                <div class="col-md-5">
                                                    <select class="form-control my-select" id="ddlParty" ng-model="ddlParty" ng-options="item.CustomerName for item in CustomerMasterAllvalues track by item.ID">
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <div class="row">
                                                <div class="col-md-4 lbl2"><label class="lable-fond">Party Branch</label></div>
                                                <div class="col-md-1">:</div>
                                                <div class="col-md-5">
                                                    <select class="form-control  my-select" id="ddlBranch" ng-model="ddlBranch" ng-options="item.Branch for item in BranchfillAll track by item.ID">
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4" style="margin-top:0px;">
                                        <div class="form-group">
                                            <div class="row">
                                                <div class="col-md-4 lbl3"><label class="lable-fond">Party TaxNo</label></div>
                                                <div class="col-md-1">:</div>
                                                <div class="col-md-5"><input type="text" class="txtbox form-control" id="txtPartyTaxNo" ng-model="txtPartyTaxNo"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="row">


                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <div class="row">
                                                <div class="col-md-4 lbl"><label class="lable-fond">Address</label></div>
                                                <div class="col-md-1">:</div>
                                                <div class="col-md-5">
                                                    <textarea class="form-control address" id="txtAddress" ng-model="txtaddress"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-4">

                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group" style="padding-bottom:0;">
                                            <div class="row">
                                                <div class="col-md-4 lbl"><label class="lable-fond">Billing Currency</label></div>
                                                <div class="col-md-1">:</div>
                                                <div class="col-md-5">
                                                    <select class="txtbox form-control" id="ddlBillCurrency" ng-model="ddlBillCurrency" ng-options="item.CurrencyCode for item in InvCurrencyALL track by item.ID">
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <div class="col-md-12" style="margin-top:-40px;">
                                <div class="row">
                                    <div class="col-md-4">

                                    </div>
                                    <div class="col-md-4">

                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <div class="row">
                                                <div class="col-md-4 lbl"><label class="lable-fond">Bank Details</label></div>
                                                <div class="col-md-1">:</div>
                                                <div class="col-md-5">
                                                    <select class="txtbox form-control" id="ddlBank" ng-model="ddlBank" ng-options="item.Bank for item in InvBankALL track by item.ID">
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>


                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-group" style="padding-bottom:0;">
                                    <div class="row">
                                        <div class="col-md-4 lbl"><label class="lable-fond">DR.InvoiceNo</label></div>
                                        <div class="col-md-1">:</div>
                                        <div class="col-md-5">
                                            <select id="ddlInvoice" class="form-control my-select" ng-model="ddlInvoice" ng-options="item.InvoiceNo for item in BLInvoicefill track by item.ID">
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-group" style="padding-bottom:0;">
                                    <div class="row">
                                        <div class="col-md-4 lbl"><label class="lable-fond">Credit Note Type</label></div>
                                        <div class="col-md-1">:</div>
                                        <div class="col-md-5">
                                            <select id="ddlCreditNoteType" class="form-control my-select" ng-model="ddlCreditNoteType" ng-options="item.name for item in CreditTypesValues track by item.ID">
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-md-4 lbl"><label class="lable-fond">Tax Exemption</label></div>
                                        <div class="col-md-1">:</div>
                                        <div class="col-md-5">
                                            <input type="text" disabled ng-model="ExemptFromTax" id="ExemptFromTax" />
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-md-4 lbl"><label class="lable-fond">Security deposit</label></div>
                                        <div class="col-md-1">:</div>
                                        <div class="col-md-5">
                                            <input type="checkbox" id="CheckSecurityDeposit" ng-model="CheckSecurityDeposit" ng-true-value="1" ng-false-value="0" />
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="row invtbl">
                        <div class="col-md-12">
                            <div class="material-datatables">

                                <table class="table table-striped table-no-bordered table-hover" cellspacing="0" width="100%" style="width:100%">
                                    <thead>
                                        <tr>

                                            <th><input type="checkbox" ng-change="CheckBoxHeadChecked(InvHDCheck);" ng-true-value="1" ng-false-value="0" ng-model="InvHDCheck" id="InvHDCheck" />  </th>
                                            <th>PRINT NAME</th>
                                            <th>CHARGE</th>
                                            <th>CURRENCY</th>
                                            <th>ROE</th>
                                            <th>BASIC</th>
                                            <th>UNIT</th>
                                            <th>RATE PER UNIT</th>
                                            <th>QTY</th>
                                            <th>AMOUNT</th>
                                            <th>AMOUNT(LOCAL)</th>
                                            <th>TAX</th>
                                            <th>%</th>
                                            <th class="disabled-sorting text-right actwid">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-repeat=" gRow in BLChargeGridValueBind">

                                            <td class="chk">
                                                <input type="checkbox" ng-change="TaxCalculation();" ng-true-value="1" ng-checked="gRow.IsFinal == 1" ng-false-value="0" id="InvCheck" ng-model="gRow.IsFinal" />
                                                <input type="hidden" ng-model="gRow.BCID" />
                                                <input type="hidden" ng-model="gRow.IsInvFinal" />
                                                <input type="hidden" ng-model="gRow.IsMiscCharge" />

                                            </td>
                                            <td class="charge">
                                                <label id="lblChdesv" ng-bind="gRow.ChargeCodeDescEdit" ng-show="gRow.IsInvFinal == 1"></label>
                                                <input id="txtChdec" ng-model="gRow.ChargeCodeDescEdit" ng-hide="gRow.IsInvFinal == 1" class="form-control" />

                                            </td>
                                            <td class="charge">
                                                <label id="lblChdesAdd" ng-bind="gRow.ChargeCodeDesc" ng-show="gRow.IsMiscCharge == 1"></label>
                                                <select class="form-control" id="ddlchargeCode" ng-change="ChargeCodeValuedisplay(gRow);" ng-model="gRow.ChargeCodeID" ng-hide="gRow.IsMiscCharge == 1" ng-options="item.ChargeCode for item in ChargeCodeAllvalues track by item.ID"></select>
                                            </td>

                                            <td>
                                                <label id="lblcharange" ng-bind="gRow.Currency" ng-show="gRow.IsMiscCharge == 1"></label>
                                                <select id="ddlCurrency" class="form-control" ng-model="gRow.CurrencyID" ng-hide="gRow.IsMiscCharge == 1" ng-options="item.Currency for item in CurrencyValue track by item.ID">
                                                </select>
                                            </td>
                                            <td class="roe">
                                                <label id="lblROE" ng-bind="gRow.ROE" ng-show="gRow.IsInvFinal == 1"></label>
                                                <input id="txtROE" autocomplete="off" type="text" ng-change="OnClickChangeROE(gRow);" ng-hide="gRow.IsInvFinal == 1" ng-model="gRow.ROE" class="form-control" />
                                            </td>

                                            <td>
                                                <label id="lblBaisc" ng-bind="gRow.Basic" ng-show="gRow.IsMiscCharge == 1"></label>
                                                <select class="form-control" id="ddlBasicID" ng-model="gRow.BasicId" ng-hide="gRow.IsMiscCharge == 1" ng-change="OnchageGridCntrType(gRow)" ng-options="item.name for item in BasicBindValues track by item.ID"> </select>
                                            </td>
                                            <td>
                                                <label id="lblCntrTypes" ng-bind="gRow.CntrTypes" ng-show="gRow.IsMiscCharge == 1"></label>
                                                <select class="form-control" id="ddlCntrTypes" ng-hide="gRow.IsMiscCharge == 1" ng-model="gRow.CntrTypeID" ng-options="item.CntrTypes for item in CntrTypesvalues track by item.ID">
                                                </select>
                                            </td>
                                            <td class="peramt">
                                                @*<label id="lblPerAmount" ng-bind="gRow.PerUnitAmt" ng-show="gRow.IsMiscCharge == 1"></label>*@
                                                <input id="txtPerAmount" autocomplete="off" type="text" ng-change="onClickQtyRatecalcuation(gRow);" ng-model="gRow.PerUnitAmt" class="form-control" />
                                            </td>
                                            <td class="qty">
                                                <label id="lblQty" ng-bind="gRow.Qty" ng-show="gRow.IsMiscCharge == 1"></label>
                                                <input id="txtQty" autocomplete="off" type="text" ng-model="gRow.Qty" ng-change="onClickQtyRatecalcuation(gRow);" ng-hide="gRow.IsMiscCharge == 1" class="form-control" />
                                            </td>
                                            <td class="amount">
                                                <label id="lblAmt" ng-bind="gRow.Amount" ng-show="gRow.IsMiscCharge == 1"></label>
                                                <input id="txtAmount" autocomplete="off" type="text" ng-model="gRow.Amount" ng-hide="gRow.IsMiscCharge == 1" class="form-control" />
                                            </td>

                                            <td class="amountlocal">
                                                <label id="lblLocAmount" ng-bind="gRow.LocAmount" ng-show="gRow.IsMiscCharge == 1"></label>
                                                <input id="txtLocAmount" autocomplete="off" type="text" ng-model="gRow.LocAmount" ng-hide="gRow.IsMiscCharge == 1" class="form-control" />

                                            </td>
                                            <td>YES</td>
                                            <td> <label ng-bind="gRow.TaxPercentage"></label></td>
                                            <td class="td-actions text-right actwid">
                                                <button type="button" rel="tooltip" ng-if="$last" ng-click="gridRowAdd(gRow)" class="btn btn-primary btn-round" data-original-title="" title="">
                                                    <i class="material-icons">add</i>
                                                </button>
                                                <button type="button" rel="tooltip" ng-if="!$last" ng-click="Remove(DynamicGrid,$index)" class="btn btn-danger btn-round" data-original-title="" title="">
                                                    <i class="material-icons">delete</i>
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                           
                                        <textarea rows="5" cols="100" id="txtRemarks" ng-model="Remarks" ng-bind="Remarks" style="width:100%;"></textarea>
                                  
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <table class="table table-striped table-no-bordered table-hover" cellspacing="0" width="100%" style="width:100%">
                                <thead>
                                    <tr>
                                        <th>TAX</th>
                                        <th>SHORT NAME</th>
                                        <th>AMOUNT</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="gTax in InvTaxValueBind">
                                        <td> <label ng-bind="gTax.TaxDesc"></label></td>
                                        <td><label ng-bind="gTax.TaxCode"></label></td>
                                        <td><label ng-bind="gTax.Amount"></label></td>
                                    </tr>

                                </tbody>
                            </table>
                        </div>
                        <div class="col-md-6" style="text-align:right;">
                            <div class="col-md-12">
                                <table class="table">
                                    <tbody>
                                        <tr>
                                            <td style="width:0px; border:0; background-color:transparent; text-align:right;">TOTAL AMOUNT</td>

                                            <td style="width:1px; border:0; background-color:transparent; text-align:right;">:</td>
                                            <td style="width:1px; border:0; background-color:transparent; text-align:right;"><span style="color:red; font-size:15px; font-weight:bold;" ng-bind="TotalAmount"></span></td>
                                        </tr>
                                        <tr>
                                        </tr>
                                        <tr>
                                            <td style="width:0px; border:0; background-color:transparent; text-align:right;">TAX AMOUNT</td>

                                            <td style="width:1px; border:0; background-color:transparent; text-align:right;">:</td>
                                            <td style="width:1px; border:0; background-color:transparent; text-align:right;"><span style="color:red; font-size:15px; font-weight:bold;" ng-bind="TaxAmount"></span></td>
                                        </tr>
                                        <tr>
                                            <td style="width:0px; border:0; background-color:transparent; text-align:right;">INVOICE AMOUNT</td>

                                            <td style="width:1px; border:0; background-color:transparent; text-align:right;">:</td>
                                            <td style="width:1px; border:0; background-color:transparent; text-align:right;"><span style="color:red; font-size:15px; font-weight:bold;" ng-bind="InvoiceTotal"></span></td>
                                        </tr>
                                        <tr>

                                            <td style="width:0px; border:0; background-color:transparent; text-align:right;"> <span><input type="checkbox"></span> ROUND OFF</td>

                                            <td style="width:1px; border:0; background-color:transparent; text-align:right;">:</td>
                                            <td style="width:1px; border:0; background-color:transparent; text-align:right;"><span style="color:red; font-size:15px; font-weight:bold;">0.00</span></td>
                                        </tr>

                                    </tbody>
                                </table>
                            </div>
                        </div>

                      
                    </div>

                    <div class="row">
                        <div class="col-md-12" style="text-align:right;">
                            <input type="hidden" id="BLTypes" ng-model="BLTypes" />
                            <input type="hidden" id="RegId" ng-model="RegId" />
                            <input type="hidden" id="ModuleID" ng-model="ModuleID" />
                            <input type="hidden" id="HDInvID" ng-model="HDInvID" />
                            <input type="hidden" id="HDBLID" ng-model="HDBLID" />
                            <input type="hidden" id="HDRRID" ng-model="HDRRID" />
                            <input type="hidden" id="HDAgentLocID" ng-model="HDAgentLocID" />
                            <button type="submit" ng-click="Recordsave(BLChargeGridValueBind);" id="btnSave" class="btn btn-fill btn-success">
                                <i class="material-icons">save</i>
                                Save
                            </button>

                            <button type="submit" ng-click="btnPrint();" class="btn btn-fill btn-default">
                                <i class="material-icons">print</i>
                                Print
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {

        $('.datepicker').datetimepicker({
            format: 'DD/MM/YYYY',

        });
    });
</script>
