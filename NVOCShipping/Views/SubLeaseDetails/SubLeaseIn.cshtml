@model  NVOCShipping.Models.MasterModel

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.full.min.js"></script>


<script type="text/javascript">

    $(document).ready(function () {
        $('.my-select').select2({
            placeholder: "--Select--",
            allowClear: true,
            width: '100%'
        });

    });
    $(function () {
        var dtToday = new Date();

        var month = dtToday.getMonth() + 1;
        var day = dtToday.getDate();
        var year = dtToday.getFullYear();
        if (month < 10)
            month = '0' + month.toString();
        if (day < 10)
            day = '0' + day.toString();

        var minDate = year + '-' + month + '-' + day;

        $('#txtSLInDate').attr('max', minDate);
       // document.getElementById('txtSLInDate').value = new Date().toISOString().slice(0, 10);
      
    });

    LayoutApp.controller('MyController', function ($scope, $http, $timeout) {
        $scope.StatusValues = [
            { 'Name': 'Active', 'ID': 1 },
            { 'Name': 'Inactive', 'ID': 2 }
        ];


        $scope.getToday = function () {
            return new Date().toISOString().split('T')[0]

        }

        $scope.FullCntrSizeTypes = null;
        $scope.fillCntrSizeTypes = function () {
            $http({
                method: 'POST',
                url: '/api/ContainerApi/CntrTypeSize/',
                data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.FullCntrSizeTypes = result.data;

                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected. Please reconnect and try again.");
                }
            });

        };
        $scope.fillCntrSizeTypes();

        $scope.LeasingPartnerList = null;
        $scope.FilLeasingPartner = function () {
            $http({
                method: 'POST',
                url: '/api/ContainerApi/LeasingPartner/',
                data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.LeasingPartnerList = result.data;

                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected. Please reconnect and try again.");
                }
            });

        };
        $scope.FilLeasingPartner();

        $scope.LeaseTermList = null;
        $scope.FilLeaseTerm = function () {
            $http({
                method: 'POST',
                url: '/api/ContainerApi/LeaseTerm/',
                data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.LeaseTermList = result.data;

                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected. Please reconnect and try again.");
                }
            });

        };
        $scope.FilLeaseTerm();


        $scope.PickUpRefNoList = null;
        $scope.FilPickUpRefNo = function () {
            $http({
                method: 'POST',
                url: '/api/SubLeaseApi/SubLeasePickUpReference/',
                data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.PickUpRefNoList = result.data;

                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected. Please reconnect and try again.");
                }
            });

        };
        $scope.FilPickUpRefNo();

        $scope.DepotList = null;
        $scope.FilDepotList = function () {
            $http({
                method: 'POST',
                url: '/api/ContainerApi/DepotValues/',
                data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.DepotList = result.data;

                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected. Please reconnect and try again.");
                }
            });

        };
        $scope.FilDepotList();


        $scope.CntrTypesvalues = null;
        $scope.fillCntrTypeValues = function () {
            $http({
                method: 'POST',
                url: '/api/CommonAccessApi/CntrTypeValues/',
                data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.CntrTypesvalues = result.data;

                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
        };
        $scope.fillCntrTypeValues();

        $scope.CntrNoList = null;
        $scope.FillCntrNo = function () {
            $http({
                method: 'POST',
                url: '/api/ContainerApi/BindCntrNos/',
                data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.CntrNoList = result.data;

                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected. Please reconnect and try again.");
                }
            });

        };
        $scope.FillCntrNo();

        $scope.IsoCodeList = null;
        $scope.fillISOCodes = function () {
            $http({
                method: 'POST',
                url: '/api/ContainerApi/ISOCodes/',
                data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.IsoCodeList = result.data;

                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected. Please reconnect and try again.");
                }
            });

        };
        $scope.fillISOCodes();

        $scope.PortList = null;
        $scope.fillPortList = function () {
            $http({
                method: 'POST',
                url: '/api/CommonAccessApi/PortValues/',
                data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.PortList = result.data;

                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected. Please reconnect and try again.");
                }
            });

        };
        $scope.fillPortList();

        $scope.AgencyList = null;
        $scope.fillAgencyList = function () {
            $http({
                method: 'POST',
                url: '/api/CommonAccessApi/AgencyMaster/',
                data: {}
            }).then(function (result) {
                $timeout(function () {
                    $scope.AgencyList = result.data;

                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected. Please reconnect and try again.");
                }
            });

        };
        $scope.fillAgencyList();

        $("#ddlPickUpRefNo").change(function () {

            $scope.CntrSizeTypes = null;
            var Datavalue = {};
            Datavalue.LeaseContractID = $("#ddlPickUpRefNo").val();

            $http({
                method: 'POST',
                url: '/api/ContainerApi/CntrTypesFromPickUp/',
                data: JSON.stringify(Datavalue),
            }).then(function (result) {
                $timeout(function () {

                    $scope.ddlLeasePartner = { LeasingPartnerID: result.data[0].LeasingPartnerID };
                    $scope.ddlLeaseTerm = { LeaseTermID: result.data[0].LeaseTermID };

                    $scope.CntrSizeTypes = result.data;

                    console.log($scope.CntrSizeTypes);
                    // $scope.BindOffHireCntrValues(result.data[0].CntrID)
                    var cntrcount = result.data[0].Cntrcount
                    var qtypickup = result.data[0].Quantity;

                    //if (cntrcount >= qtypickup) {
                    //   // $scope.IsVisible = false;

                    //    //$scope.DisableSaveButtonIfApproved(queryString["LeaseID"].toString());
                    //    ShowPopup("Container Quantity Already Exceeded For This Reference");
                    //}
                    //else {

                    //    $scope.IsVisible = true;

                    //    //var qty = qtypickup - cntrcount - 1;
                    //    //for (var i = 0; i < qty; i++) {

                    //    //    $scope.DynamicGridContainerDtls.push({
                    //    //        'ID': "",
                    //    //        'CntrNo': "",
                    //    //        'CntrType': "",
                    //    //        'ISOCode': "",
                    //    //        'Grade': "",
                    //    //        'CubicCapacity': "",
                    //    //        'GrossWt': "",
                    //    //        'NetWt': "",
                    //    //        'TareWt': "",
                    //    //        'MFGDate': "",
                    //    //        'AppAt': "",
                    //    //        'OnHireDt': "",

                    //    //    });

                    //    //}


                    //    //$scope.AddCntrs = function (DynamicGridDropupDtls) {

                    //    //    //if (DynamicGridVoyDtls.PkUpLoc == "?") {
                    //    //    //    swal("Please Select ");
                    //    //    //    return;
                    //    //    //}
                    //    //    $scope.DynamicGridContainerDtls.push({
                    //    //        'ID': "",
                    //    //        'CntrNo': "",
                    //    //        'CntrType': "",
                    //    //        'ISOCode': "",
                    //    //        'Grade': "",
                    //    //        'CubicCapacity': "",
                    //    //        'GrossWt': "",
                    //    //        'NetWt': "",
                    //    //        'TareWt': "",
                    //    //        'MFGDate': "",
                    //    //        'AppAt': "",
                    //    //        'OnHireDt': "",

                    //    //    });

                    //    //}
                    //    //$scope.RemoveCntrs = function (DynamicGridContainerDtls, index) {
                    //    //    $scope.DynamicGridContainerDtls.splice(index, 1);
                    //    //}
                    //}

                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected. Please reconnect and try again.");
                }
            });

        });




        $(document).ready(function () {

            var queryString = new Array();
            if (window.location.search.split('?').length > 1) {
                var params = window.location.search.split('?')[1].split('&');
                for (var i = 0; i < params.length; i++) {
                    var key = params[i].split('=')[0];
                    var value = decodeURIComponent(params[i].split('=')[1]);
                    queryString[key] = value;
                }
            }
            if (queryString["ID"] != null) {

                $scope.HdSLINId = queryString["ID"].toString();
                $scope.BindSubLeaseInEdit(queryString["ID"].toString());
                $scope.BindSubLeaseInContainersEdit(queryString["ID"].toString());
                $scope.disabledSave = true;
            }
            else {
                $scope.disabledSave = false;
            }
        });

        $scope.BindSubLeaseInEdit = function (SLINID) {

            var Datavalue = {}
            var id = SLINID;

            if (id == "" || id == null)
                Datavalue.ID = 0;
            else
                Datavalue.ID = SLINID;
            //alert(Datavalue.ID);
            $http({
                method: 'POST',
                url: "/api/SubLeaseApi/SubLeaseInEdit",
                data: JSON.stringify(Datavalue),
            }).then(function (result) {
                $timeout(function () {
                    alert(result.data.length);
                    if (result.data[0].ID != "") {
                        $scope.txtRequestNo = result.data[0].RequestNo;
                        $scope.ddlPickUpRefNo = { ID: result.data[0].PickUpRefID };
                        $scope.ddlLeasePartner = { LeasingPartnerID: result.data[0].LeasingPartnerID };
                        $scope.ddlLeaseTerm = { LeaseTermID: result.data[0].LeasingTermID };
                        $scope.txtRemarks = result.data[0].Remarks;
                        $scope.ddlDepot = { ID: result.data[0].DepotID };
                        document.getElementById('txtSLInDate').value = result.data[0].SubLeaseDate;
                    }
                    else {
                        $scope.txtRequestNo = "";
                        $scope.ddlPickUpRefNo = "";
                        $scope.ddlLeasePartner = "";
                        $scope.ddlLeaseTerm = "";
                        $scope.txtRemarks = "";
                        $scope.ddlDepot = "";
                        $scope.txtSLInDate = "";
                    }
                });
            });

        }


        $scope.DynamicGridContainerDtls = [{ ID:"", CntrID: "", CntrType: "", ISOCode: "", LocationID: "", AgencyID: "", Remarks: "" }];

        $scope.BindSubLeaseInContainersEdit = function (SLINID) {
            var Datavalue = {};
            
            Datavalue.ID = SLINID;
            $http({
                method: 'POST',
                url: '/api/SubLeaseApi/SubLeaseInContainersEdit/',
                data: JSON.stringify(Datavalue),
            }).then(function (result) {
                $timeout(function () {



                    if (result.data[0].TypeID != "") {
                        $scope.DynamicGridContainerDtls.splice(0, 1);
                    }

                    angular.forEach(result.data, function (value, key) {
                        //alert(result.data[key].DtManufacture);
                        $scope.DynamicGridContainerDtls.push({
                            'ID': result.data[key].ID,
                            'CntrID': { ID: result.data[key].CntrID },
                            'CntrType': { TypeID: result.data[key].CntrTypeID },
                            'ISOCode': { ISOCodeID: result.data[key].ISOCodeID },
                            'LocationID': { ID: result.data[key].LocationID },
                            //'AgencyID': { ID: result.data[key].AgencyID },
                            'Remarks': result.data[key].Remarks,


                        });

                    });

                });
            }, function (result) {

                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected. Please reconnect and try again.");
                }
            });

        };


        $scope.SaveSubLeaseInRequest = function (data) {
            var validation = "";

            var ddlPickUpRefNo = $('#ddlPickUpRefNo').val();
            if (ddlPickUpRefNo == "?") {

                validation += "<span style='color:red;'>*</span> <span>Please Select Sub-Lease Reference</span></br>"
            }

            var ddlStatus = $('#ddlStatus').val();
            if (ddlStatus == "?") {

                validation += "<span style='color:red;'>*</span> <span>Please Select Status </span></br>"
            }
            var txtSLInDate = $('#txtSLInDate').val();
            if (txtSLInDate.length==0) {

                validation += "<span style='color:red;'>*</span> <span>Please Select Sub Lease In Date</span></br>"
            }
            var ddlDepot = $('#ddlDepot').val();
            if (ddlDepot == "?") {

                validation += "<span style='color:red;'>*</span> <span>Please Select Depot </span></br>"
            }
           // alert(data.length);
            //if (data.length == 0) {
            //    validation += "<span style='color:red;'>*</span> <span>Please Assign Containers </span></br>"
            //}
            var CntrNoV = "";
            var CntrTypev = "";
            var ISOCodeV = "";
            var LocationIDv = "";
            var AgencyIDv = "";

            angular.forEach(data, function (value, key) {
                CntrNoV = data[key].CntrID;
                CntrTypev = data[key].CntrType;
                ISOCodeV = data[key].ISOCode;
                LocationIDv = data[key].LocationID;
                AgencyIDv = data[key].AgencyID;
              

            });

            if (CntrNoV == "") {
                validation += "<span style='color:red;'>*</span> <span>Please Select Container No </span></br>"
            }

            if (CntrTypev == "") {
                validation += "<span style='color:red;'>*</span> <span>Please Select Container Type </span></br>"
            }
            if (ISOCodeV == "") {
                validation += "<span style='color:red;'>*</span> <span>Please Select ISOCode </span></br>"
            }
            if (LocationIDv == "") {
                validation += "<span style='color:red;'>*</span> <span>Please Select Location </span></br>"
            }
            if (AgencyIDv == "") {
                validation += "<span style='color:red;'>*</span> <span>Please Select Agency  </span></br>"
            }
            if (validation != "") {

                ShowPopup(validation);
                return false;
            }
            $('#overlay').fadeIn().delay(100).fadeOut();

            var BussData = {}
            var id = $scope.HdSLINId;

            if (id == "" || id == null)
                BussData.ID = 0;
            else
                BussData.ID = $scope.HdSLINId;

            var ItemsCntrIDsv = "";

            angular.forEach(data, function (value, key) {
                ItemsCntrIDsv += data[key].CntrID.ID + ","
            })
            ItemsCntrIDsv = ItemsCntrIDsv.substring(0, ItemsCntrIDsv.length - 1);

            BussData.ItemsCntrIDs = ItemsCntrIDsv;
            BussData.PickUpRefID = $("#ddlPickUpRefNo").val();
            BussData.RequestNo = $scope.txtRequestNo;
            BussData.LeasingPartnerID = $("#ddlLeasePartner").val();
            BussData.LeasingTermID = $("#ddlLeaseTerm").val();
            BussData.DepotID = $("#ddlDepot").val();
            BussData.SubLeaseDate = $("#txtSLInDate").val();
            BussData.Remarks = $scope.txtRemarks;
            BussData.SessionFinYear = localStorage.getItem("SessionFinYear");
            BussData.AgentCode = "NS";
            BussData.UserID = localStorage.getItem("UserID");
            BussData.AgencyID = localStorage.getItem("AgencyID");
            
            var ItemsCntrDtls = []

            angular.forEach(data, function (value, key) {
                var intSID = data[key].ID;
               
                if (typeof data[key].ID == "undefined") {
                    intSID = 0;
                }

                ItemsCntrDtls.push('Insert:' + intSID,data[key].CntrID.ID, data[key].CntrType.TypeID, data[key].ISOCode.ISOCodeID, data[key].LocationID.ID, data[key].Remarks, 0);

            });
            BussData.ItemsCntrs = ItemsCntrDtls.toString();
          

            $http({
                method: 'POST',
                url: "/api/SubLeaseApi/InsertSOContainers",
                data: JSON.stringify(BussData),

            }).then(function (result) {
                $timeout(function () {

                    ShowPopup(result.data[0].AlertMessage);
                    if (result.data[0].AlertMessageID == "1") {
                        setTimeout(function () { location.href = "/SubLeaseDetails/SubLeaseInView" }, 1500);
                    }
                    
                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {

                ShowPopup('There has been an error: ' + result);
            });

        }

        $scope.FetchSOContainers = function () {

            var validation = "";

            var ddlPickUpRefNo = $('#ddlPickUpRefNo').val();
            if (ddlPickUpRefNo == "?") {

                validation += "<span style='color:red;'>*</span> <span>Please Select Sub-Lease Reference</span></br>"
            }

            if (validation != "") {

                ShowPopup(validation);
                return false;
            }
            $scope.DynamicGridContainerDtls = [{ ID: "", CntrID: "", CntrType: "", ISOCode: "", LocationID: "", AgencyID: "", Remarks: "" }];
            
            $('#SubLeaseIn').modal('show');
            $("#overlay").show();
            var BussData = {};
           
            var CntrTypes = "";

            angular.forEach($scope.CntrSizeTypes, function (value, key) {
                CntrTypes += $scope.CntrSizeTypes[key].TypeID + ","
            })
            CntrTypes = CntrTypes.substring(0, CntrTypes.length - 1);

            BussData.CntrTypes = CntrTypes;
            BussData.CntrNo = $scope.txtConainer;
            BussData.TypeID = $("#ddlCntrTypes").val();
            BussData.LocationID = localStorage.getItem("GeoLocationID");
            BussData.CountryID = localStorage.getItem("CountryID");
            $http({
                method: 'POST',
                url: '/api/SubLeaseApi/BindSOContainers/',
                data: JSON.stringify(BussData),
            }).then(function (result) {
                $timeout(function () {

                    $scope.fillSOContainers = result.data;

                    $("#overlay").hide();

                });
            }, function (result) {
                if (result.status == 500) {
                    ShowPopup("Sorry no internet connectivity Application Error.");
                }
                else if (result.status == 404) {
                    ShowPopup("Sorry no internet connectivity page not found.");
                }
                if (result.status > 0) {
                    var errorMsg = result.status + ': ' + result.data;
                    ShowPopup("Sorry no internet connectivity detected.Please reconnect and try  again.");
                }
            }).catch(function (result) {
                ShowPopup('There has been an error: ' + result);
            });
            //$("#ddlCntrTypes").val(null).trigger("change");
            //$scope.txtConainer = "";
        }


        $scope.CntrMovmentToGrid = function (data) {
           
            var validation = "";
            var ddlLocation = $('#ddlLocation').val();
            if (ddlLocation == "?") {

                validation += "<span style='color:red;'>*</span> <span>Please Select Location </span></br>"
            }
            var IntRow = 0;
            for (var i = 0; i < data.length; i++) {

                if (data[i].IsTrue == 1) {
                    IntRow = true;
                    break;
                }
                else {

                    IntRow = false;
                }

            }
            if (IntRow == false) {
                validation += "<span style='color:red;'>*</span> <span>Please Check Any One </span></br>"
            }
            if (validation != "") {

                ShowPopup(validation);
                return false;
            }
            if (data[0].TypeID != "") {
                $scope.DynamicGridContainerDtls.splice(0, 1);
            }

                angular.forEach(data, function (value, key) {
                    if (data[key].IsTrue == 1) {
                        $scope.DynamicGridContainerDtls.push({
                            'CntrID': { ID: data[key].ID },
                            'CntrType': { TypeID: data[key].TypeID },
                            'ISOCode': { ISOCodeID: data[key].TypeID },
                            'LocationID': { ID: $("#ddlLocation").val() },
                            //'AgencyID': { ID: data[key].AgencyID },
                            'Remarks': "",

                        });
                    }
                });
            $('#SubLeaseIn').modal('hide');
           
        }


        $scope.back = function () {

            window.location = "/SubLeaseDetails/SubLeaseInView";
        }

    });


    function ShowPopup(message) {
        swal(message);
    };

</script>

<div ng-app="MyApp" ng-controller="MyController">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12 backbtn" style="text-align:right;">
                <button type="submit" ng-click="back();" class="btn btn-fill btn-success btn-round btntop">
                    <i class="material-icons">reply</i> Back

                </button>

            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="card ">
                    <div class="card-header card-header-primary card-header-text">
                        <div class="card-text">
                            <h4 class="card-title">Sub Lease-In</h4>
                        </div>
                    </div>
                    <div class="card-body ">
                        <div class="row" style="border-bottom:1px solid #ccc; margin-bottom:20px;">

                            <div class="col-md-3">
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <label>Sub-LeaseIn Request No</label>
                                            <input type="text" autocomplete="off" disabled id="txtRequestNo" ng-model="txtRequestNo" class="form-control">
                                        </div>

                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <label>Sub Lease Reference</label>
                                            <select class="form-control my-select" ng-model="ddlPickUpRefNo" id="ddlPickUpRefNo" ng-options="item.ContractRefNo for item in PickUpRefNoList track by item.ID" required>
                                            </select>

                                        </div>

                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <label>Leasing Partner </label>
                                            <select class="form-control my-select" disabled ng-model="ddlLeasePartner" id="ddlLeasePartner" ng-options="item.LeasingPartner for item in LeasingPartnerList track by item.LeasingPartnerID" required>
                                            </select>

                                        </div>

                                    </div>
                                </div>
                            </div>

                            <div class="col-md-3">
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <label>Leasing Term </label>
                                            <select class="form-control my-select" disabled ng-model="ddlLeaseTerm" id="ddlLeaseTerm" ng-options="item.LeaseTerm for item in LeaseTermList track by item.LeaseTermID" required>
                                            </select>

                                        </div>

                                    </div>
                                </div>
                            </div>


                            <div class="col-md-3">
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <label>Sub-Lease In Date   </label>
                                            <input type="date"  id="txtSLInDate" [max]="getToday()" ng-model="txtSLInDate" class="form-control">
                                        </div>

                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <label>Depot </label>
                                            <select class="form-control my-select" ng-model="ddlDepot" id="ddlDepot" ng-options="item.DepotName for item in DepotList track by item.ID" required>
                                            </select>

                                        </div>

                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <label>Remarks</label>
                                            <input type="text" id="txtRemarks" autocomplete="off" ng-model="txtRemarks" class="form-control">
                                        </div>

                                    </div>
                                </div>
                            </div>


                        </div>
                        <div class="col-md-12" style="margin-top:0; text-align:right;">
                            <button type="submit" id="btnFetchTariff" ng-click="FetchSOContainers();" class="btn btn-fill btn-danger btnfetch">
                                Container No's Assigning
                                <i class="material-icons"></i>
                            </button>
                        </div>
                        <div class="row" style="border-bottom:1px solid #ccc; padding-bottom:20px;">
                            <div class="col-md-12">
                                <div class="material-datatables" style="width:100%;overflow:scroll;height:400px;">
                                    <h5 class="cardtitle">Container Details</h5>
                                    <table class="table table-striped table-no-bordered table-hover" cellspacing="0" width="100%" style="width:100%">
                                        <thead>
                                            <tr>
                                                <th>S.No</th>
                                                <th>Container Number</th>
                                                <th>Container Type</th>
                                                <th>ISC Code </th>
                                                <th>Location</th>
                                                @*<th>Agency</th>*@
                                                <th>Remarks</th>

                                        </thead>
                                        <tbody>
                                            <tr ng-repeat="iRow in DynamicGridContainerDtls">
                                                @*ng-show="IsVisible"*@
                                                <td>{{$index+1}}</td>
                                                <td>
                                                    <select class="form-control my-select" disabled ng-model="iRow.CntrID"  id="ddlCntrNo" ng-options="item.CntrNo for item in CntrNoList track by item.ID">
                                                    </select>
                                                 <td>

                                                    <select class="form-control" id="ddlCntrType" disabled ng-model="iRow.CntrType" ng-options="item.Size for item in FullCntrSizeTypes track by item.TypeID" required>  </select>
                                                <td>
                                                    <select class="form-control" id="ddLISOCode" disabled ng-model="iRow.ISOCode" ng-options="item.ISOCode for item in IsoCodeList track by item.ISOCodeID">   </select>
                                                </td>
                                                <td>

                                                    <select class="form-control my-select" ng-model="iRow.LocationID" id="ddlLoc" ng-options="item.PortName for item in PortList track by item.ID" required>
                                                    </select>
                                                </td>
                                                @*<td>
                                                    <select class="form-control my-select" ng-model="iRow.AgencyID" id="ddlAgency" ng-options="item.AgencyName for item in AgencyList track by item.ID" required>
                                                    </select>
                                                </td>*@
                                                <td>
                                                    <input type="text" id="txtCntrRemarks" autocomplete="off" ng-model="iRow.Remarks" class="form-control">
                                                </td>

                                            </tr>
                                        </tbody>

                                    </table>
                                    @*<div id="notFoundDiv" ng-show="(CustomerRec|filter:CountryCode).length==0" style="color: red; font-weight: bold">No Records Found</div>*@
                                </div>
                            </div>
                        </div>
                        <div class="row" style="margin-top:15px;">
                            <div class="col-md-12" style="text-align:right;">
                                @*<button type="submit" class="btn btn-fill btn-success">

                                        Apply Correction
                                    </button>
                                    <button type="submit" class="btn btn-fill btn-rose" ng-click="Approve();">

                                        Approve
                                    </button>*@


                                <input type="hidden" id="HdSLINId" ng-model="HdSLINId" />
                                @*<button class="btn btn-fill btn-primary" ng-click="openModal()">Attachments</button>*@
                                <button type="submit" class="btn btn-fill btn-success" ng-disabled='disabledSave' ng-click="SaveSubLeaseInRequest(DynamicGridContainerDtls);">
                                    <i class="material-icons">save</i>
                                    Save
                                </button>
                            </div>

                            <div class="clearfix"></div>
                        </div>

                        <div class="modal" id="SubLeaseIn" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content" style="margin:0 auto; width:1000px;">

                                    <!-- Modal Header -->
                                    <div class="modal-header">
                                        <h4 class="modal-title">Select Container</h4>
                                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                                    </div>

                                    <!-- Modal body -->
                                    <div class="modal-body" style="padding-bottom:0;border-bottom: 1px solid #ccc;margin-bottom:6px;">
                                        <div class="row">
                                            <div class="col-md-3"><h5 style="margin-top:10px;">Available Container</h5></div>
                                            <div class="col-md-9">
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="col-md-2">
                                                            <label>Search Type</label>
                                                        </div>
                                                        <div class="col-md-2 padlr0">
                                                            <select class="form-control" id="ddlCntrTypes" ng-model="ddlCntrTypes" ng-options="item.Size for item in CntrSizeTypes track by item.TypeID">
                                                            </select>
                                                        </div>
                                                        <div class="col-md-7">
                                                            <input type="text" id="txtConainer" style="width:100%;" class="form-control" ng-model="txtConainer" />
                                                        </div>
                                                        <div class="col-md-1">
                                                            <a href="#" ng-click="FetchSOContainers();"> <i class="material-icons">search</i></a>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                        <div class="row pickupdiv">
                                            <div class="col-md-12">
                                                <div class="material-datatables" style="overflow:auto;height:200px;">
                                                    <table class="table table-striped table-no-bordered table-hover" style="margin-bottom:-2px;">

                                                        <thead>
                                                            <tr>
                                                                <th>#</th>
                                                                <th>Container #</th>
                                                                <th>Size Type</th>
                                                                <th>Location</th>
                                                                <th>DtMovement</th>
                                                                <th>Agent</th>
                                                                <th>Current Depot</th>
                                                                <th>Status</th>

                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr ng-repeat="gRow in fillSOContainers">
                                                                <td>
                                                                    <input type="checkbox" ng-true-value="1" ng-click="CntrNoCountValidation(fillCntrNoPickup);" ng-checked="gRow.IsTrue" ng-false-value="0" id="InvCheck" ng-model="gRow.IsTrue" />
                                                                </td>
                                                                <td>{{gRow.CntrNo}}</td>
                                                                <td>{{gRow.Size}}</td>
                                                                <td>{{gRow.Location}}</td>
                                                                <td>{{gRow.DtMovement}}</td>
                                                                <td>
                                                                    {{gRow.AgentName}}
                                                                </td>
                                                                <td>{{gRow.CntrDepo}}</td>
                                                                <td>{{gRow.StatusCode}}</td>

                                                            </tr>
                                                        </tbody>
                                                    </table>


                                                </div>
                                                @*<div class="material-datatables" style="overflow-y:scroll; height:250px;">


                </div>*@
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-5" style="text-align:right;"><h5 style="margin-top:10px;">Location</h5></div>
                                            <div class="col-md-5">
                                                
                                                       
                                                <div class="col-md-8 padlr0" style="margin-top:9px!important;">
                                                    <select class="form-control my-select" ng-model="iRow.LocationID" id="ddlLocation" ng-options="item.PortName for item in PortList track by item.ID" required>
                                                    </select>

                                                </div>

                                                </div>
                                            </div>
                                        </div>
                                        <div class="row" style="margin-top:3px;">
                                            <div class="col-md-10" style="text-align:right;">
                                                <a href="#" class="btn btn-success" style="padding: 7px 25px;margin-top:-2px;" ng-click="CntrMovmentToGrid(fillSOContainers);"><i></i> Save</a>

                                            </div>
                                        </div>
                                    </div>


                                </div>



                            </div>
                        </div>
                    </div>

                </div>

            </div>
        </div>
    </div>



